<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°æ®åˆ†æ - å·¥å•†å‚¨èƒ½ç®¡ç†ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.5;
            color: #1e293b;
            background: #f8fafc;
            min-height: 100vh;
        }

        /* ä¾§è¾¹æ æ ·å¼ */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 240px;
            height: 100vh;
            background: white;
            border-right: 1px solid #e2e8f0;
            display: flex;
            flex-direction: column;
            transition: all 300ms ease;
            z-index: 100;
        }

        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e2e8f0;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.125rem;
            font-weight: 600;
            color: #1e293b;
        }

        .logo img {
            width: 32px;
            height: 32px;
            object-fit: contain;
        }

        .sidebar-menu {
            flex: 1;
            padding: 1rem 0;
            overflow-y: auto;
        }

        .menu-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1.5rem;
            color: #64748b;
            text-decoration: none;
            transition: all 150ms ease;
            position: relative;
        }

        .menu-item:hover {
            background: #f1f5f9;
            color: #1e293b;
        }

        .menu-item.active {
            background: #eff6ff;
            color: #2563eb;
        }

        .menu-item.active::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            width: 3px;
            height: 100%;
            background: #2563eb;
        }

        /* ä¸»å†…å®¹åŒºåŸŸ */
        .main-content {
            margin-left: 240px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* é¡¶éƒ¨å¯¼èˆªæ  */
        .navbar {
            background: white;
            border-bottom: 1px solid #e2e8f0;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 50;
        }

        .navbar-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .page-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1e293b;
        }

        .navbar-right {
            display: flex;
            gap: 0.5rem;
        }

        .nav-button {
            padding: 0.5rem 1rem;
            border: none;
            background: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            border-radius: 8px;
            transition: all 150ms ease;
            color: #475569;
        }

        .nav-button:hover {
            background: #f1f5f9;
            color: #1e293b;
        }

        /* å†…å®¹åŒºåŸŸ */
        .content {
            flex: 1;
            padding: 2rem;
        }

        /* åˆ†æé€‰é¡¹å¡ */
        .analysis-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: -2px;
        }

        .tab-button {
            padding: 0.75rem 1.5rem;
            border: none;
            background: none;
            cursor: pointer;
            color: #64748b;
            font-weight: 500;
            transition: all 150ms ease;
            position: relative;
            border-bottom: 2px solid transparent;
            margin-bottom: -2px;
        }

        .tab-button:hover {
            color: #1e293b;
        }

        .tab-button.active {
            color: #2563eb;
            border-bottom-color: #2563eb;
        }

        /* æ—¥æœŸé€‰æ‹©å™¨ */
        .date-selector {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .date-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .date-input {
            padding: 0.5rem 1rem;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 0.875rem;
            transition: all 150ms ease;
        }

        .date-input:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .quick-select {
            display: flex;
            gap: 0.5rem;
        }

        .quick-button {
            padding: 0.5rem 1rem;
            border: 1px solid #e2e8f0;
            background: white;
            border-radius: 8px;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 150ms ease;
        }

        .quick-button:hover {
            border-color: #2563eb;
            color: #2563eb;
        }

        .quick-button.active {
            background: #2563eb;
            color: white;
            border-color: #2563eb;
        }

        /* ç»Ÿè®¡å¡ç‰‡ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .stat-title {
            font-size: 0.875rem;
            color: #64748b;
        }

        .stat-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }

        .stat-icon.green {
            background: #d1fae5;
            color: #059669;
        }

        .stat-icon.blue {
            background: #dbeafe;
            color: #2563eb;
        }

        .stat-icon.yellow {
            background: #fef3c7;
            color: #d97706;
        }

        .stat-icon.purple {
            background: #ede9fe;
            color: #7c3aed;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 0.5rem;
        }

        .stat-unit {
            font-size: 0.875rem;
            color: #64748b;
            font-weight: 400;
        }

        .stat-trend {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
        }

        .trend-up {
            color: #10b981;
        }

        .trend-down {
            color: #ef4444;
        }

        /* å›¾è¡¨åŒºåŸŸ */
        .charts-container {
            display: grid;
            gap: 1.5rem;
        }

        .chart-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .chart-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #1e293b;
        }

        .chart-actions {
            display: flex;
            gap: 0.5rem;
        }

        .chart-button {
            padding: 0.5rem 1rem;
            border: 1px solid #e2e8f0;
            background: white;
            border-radius: 6px;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 150ms ease;
        }

        .chart-button:hover {
            border-color: #2563eb;
            color: #2563eb;
        }

        .chart-container {
            height: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8fafc;
            border-radius: 8px;
            position: relative;
        }

        /* ä¸¤åˆ—å¸ƒå±€ */
        .two-column-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
        }

        /* æ•°æ®è¡¨æ ¼ */
        .table-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .table-wrapper {
            overflow-x: auto;
            margin-top: 1rem;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th {
            text-align: left;
            padding: 0.75rem;
            border-bottom: 2px solid #e2e8f0;
            font-weight: 600;
            color: #475569;
            font-size: 0.875rem;
            white-space: nowrap;
        }

        .data-table td {
            padding: 0.75rem;
            border-bottom: 1px solid #f1f5f9;
            color: #1e293b;
            font-size: 0.875rem;
        }

        .data-table tr:hover {
            background: #f8fafc;
        }

        /* æ·±è‰²ä¸»é¢˜ */
        [data-theme="dark"] body {
            background: #0f172a;
            color: #e2e8f0;
        }

        [data-theme="dark"] .sidebar,
        [data-theme="dark"] .navbar,
        [data-theme="dark"] .stat-card,
        [data-theme="dark"] .chart-card,
        [data-theme="dark"] .table-card {
            background: #1e293b;
            border-color: #334155;
        }

        [data-theme="dark"] .date-input,
        [data-theme="dark"] .quick-button,
        [data-theme="dark"] .chart-button {
            background: #1e293b;
            border-color: #334155;
            color: #e2e8f0;
        }

        [data-theme="dark"] .chart-container {
            background: #0f172a;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1200px) {
            .two-column-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .content {
                padding: 1rem;
            }

            .analysis-tabs {
                overflow-x: auto;
                flex-wrap: nowrap;
            }

            .date-selector {
                flex-direction: column;
                align-items: stretch;
            }
        }
    </style>
</head>
<body>
    <!-- ä¾§è¾¹æ  -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <img src="../logo.png" alt="Logo">
                <span>èƒ½æºç®¡ç†ç³»ç»Ÿ</span>
            </div>
        </div>
        <nav class="sidebar-menu">
            <a href="./station-management.html" class="menu-item">
                <span class="menu-icon">âš¡</span>
                <span>ç”µç«™ç®¡ç†</span>
            </a>
            <a href="#" class="menu-item active">
                <span class="menu-icon">ğŸ“ˆ</span>
                <span>æ•°æ®åˆ†æ</span>
            </a>
            <a href="#" class="menu-item">
                <span class="menu-icon">ğŸ””</span>
                <span>å‘Šè­¦ç®¡ç†</span>
            </a>
            <a href="#" class="menu-item">
                <span class="menu-icon">ğŸ”§</span>
                <span>è®¾å¤‡ç®¡ç†</span>
            </a>
            <a href="#" class="menu-item">
                <span class="menu-icon">ğŸ‘¥</span>
                <span>ç”¨æˆ·ç®¡ç†</span>
            </a>
            <a href="#" class="menu-item">
                <span class="menu-icon">ğŸ“„</span>
                <span>æŠ¥è¡¨ä¸­å¿ƒ</span>
            </a>
            <a href="#" class="menu-item">
                <span class="menu-icon">âš™ï¸</span>
                <span>ç³»ç»Ÿè®¾ç½®</span>
            </a>
        </nav>
    </aside>

    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <main class="main-content">
        <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
        <nav class="navbar">
            <div class="navbar-left">
                <button class="nav-button" onclick="toggleSidebar()">
                    <span>â˜°</span>
                </button>
                <button class="nav-button" onclick="goBack()" title="è¿”å›åœºæ™¯é€‰æ‹©">
                    <span>â†</span>
                </button>
                <h1 class="page-title">æ•°æ®åˆ†æ</h1>
            </div>
            <div class="navbar-right">
                <button class="nav-button" onclick="exportData()">
                    <span>ğŸ“¥</span>
                    <span>å¯¼å‡º</span>
                </button>
                <button class="nav-button" onclick="toggleLanguage()">
                    <span>ğŸŒ</span>
                    <span id="lang-text">ä¸­æ–‡</span>
                </button>
                <button class="nav-button" onclick="toggleTheme()">
                    <span id="theme-icon">ğŸŒ™</span>
                </button>
            </div>
        </nav>

        <!-- å†…å®¹åŒºåŸŸ -->
        <div class="content">
            <!-- åˆ†æé€‰é¡¹å¡ -->
            <div class="analysis-tabs">
                <button class="tab-button active" onclick="switchTab('energy')">èƒ½è€—åˆ†æ</button>
                <button class="tab-button" onclick="switchTab('revenue')">æ”¶ç›Šåˆ†æ</button>
                <button class="tab-button" onclick="switchTab('operation')">è¿è¡Œåˆ†æ</button>
                <button class="tab-button" onclick="switchTab('efficiency')">æ•ˆç‡åˆ†æ</button>
                <button class="tab-button" onclick="switchTab('comparison')">å¯¹æ¯”åˆ†æ</button>
            </div>

            <!-- æ—¥æœŸé€‰æ‹©å™¨ -->
            <div class="date-selector">
                <div class="date-group">
                    <label>æ—¶é—´èŒƒå›´ï¼š</label>
                    <input type="date" class="date-input" id="start-date" value="2024-01-01">
                    <span>è‡³</span>
                    <input type="date" class="date-input" id="end-date" value="2024-01-31">
                </div>
                <div class="quick-select">
                    <button class="quick-button" onclick="selectDateRange('today')">ä»Šæ—¥</button>
                    <button class="quick-button" onclick="selectDateRange('week')">æœ¬å‘¨</button>
                    <button class="quick-button active" onclick="selectDateRange('month')">æœ¬æœˆ</button>
                    <button class="quick-button" onclick="selectDateRange('year')">æœ¬å¹´</button>
                </div>
            </div>

            <!-- èƒ½è€—åˆ†æå†…å®¹ -->
            <div id="energy-content" class="tab-content">
                <!-- ç»Ÿè®¡å¡ç‰‡ -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <span class="stat-title">æ€»å‘ç”µé‡</span>
                            <div class="stat-icon green">âš¡</div>
                        </div>
                        <div class="stat-value">
                            386.5 <span class="stat-unit">MWh</span>
                        </div>
                        <div class="stat-trend trend-up">
                            <span>â–² 12.5%</span>
                            <span>ç¯æ¯”ä¸Šæœˆ</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <span class="stat-title">æ€»ç”¨ç”µé‡</span>
                            <div class="stat-icon blue">ğŸ“Š</div>
                        </div>
                        <div class="stat-value">
                            425.8 <span class="stat-unit">MWh</span>
                        </div>
                        <div class="stat-trend trend-up">
                            <span>â–² 8.3%</span>
                            <span>ç¯æ¯”ä¸Šæœˆ</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <span class="stat-title">è‡ªç”¨ç‡</span>
                            <div class="stat-icon yellow">ğŸ”„</div>
                        </div>
                        <div class="stat-value">
                            68.5 <span class="stat-unit">%</span>
                        </div>
                        <div class="stat-trend trend-up">
                            <span>â–² 5.2%</span>
                            <span>ç¯æ¯”ä¸Šæœˆ</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <span class="stat-title">å³°è°·å·®ä»·å¥—åˆ©</span>
                            <div class="stat-icon purple">ğŸ’°</div>
                        </div>
                        <div class="stat-value">
                            15.6 <span class="stat-unit">ä¸‡å…ƒ</span>
                        </div>
                        <div class="stat-trend trend-up">
                            <span>â–² 18.6%</span>
                            <span>ç¯æ¯”ä¸Šæœˆ</span>
                        </div>
                    </div>
                </div>

                <!-- å›¾è¡¨åŒºåŸŸ -->
                <div class="charts-container">
                    <!-- æ—¥å‘ç”µé‡è¶‹åŠ¿ -->
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">æ—¥å‘ç”µé‡è¶‹åŠ¿</h3>
                            <div class="chart-actions">
                                <button class="chart-button">æŸ±çŠ¶å›¾</button>
                                <button class="chart-button">æŠ˜çº¿å›¾</button>
                            </div>
                        </div>
                        <div class="chart-container" id="daily-generation-chart">
                            <canvas id="dailyGenerationCanvas" style="width: 100%; height: 100%;"></canvas>
                        </div>
                    </div>

                    <!-- å……æ”¾ç”µåˆ†æ -->
                    <div class="two-column-grid">
                        <div class="chart-card">
                            <div class="chart-header">
                                <h3 class="chart-title">å……æ”¾ç”µæ—¶æ®µåˆ†å¸ƒ</h3>
                            </div>
                            <div class="chart-container" style="height: 300px;">
                                <canvas id="chargeTimeCanvas" style="width: 100%; height: 100%;"></canvas>
                            </div>
                        </div>
                        <div class="chart-card">
                            <div class="chart-header">
                                <h3 class="chart-title">å³°å¹³è°·ç”µé‡åˆ†å¸ƒ</h3>
                            </div>
                            <div class="chart-container" style="height: 300px;">
                                <canvas id="peakDistributionCanvas" style="width: 100%; height: 100%;"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- èƒ½è€—å¯¹æ¯”è¡¨ -->
                    <div class="table-card">
                        <div class="chart-header">
                            <h3 class="chart-title">æœˆåº¦èƒ½è€—å¯¹æ¯”</h3>
                            <button class="chart-button" onclick="exportTable()">å¯¼å‡ºè¡¨æ ¼</button>
                        </div>
                        <div class="table-wrapper">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>æœˆä»½</th>
                                        <th>å‘ç”µé‡(MWh)</th>
                                        <th>ç”¨ç”µé‡(MWh)</th>
                                        <th>ä¸Šç½‘ç”µé‡(MWh)</th>
                                        <th>è‡ªç”¨ç‡(%)</th>
                                        <th>å……ç”µæ•ˆç‡(%)</th>
                                        <th>æ”¾ç”µæ•ˆç‡(%)</th>
                                        <th>ç»¼åˆæ•ˆç‡(%)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>2024-01</td>
                                        <td>386.5</td>
                                        <td>425.8</td>
                                        <td>120.3</td>
                                        <td>68.5</td>
                                        <td>95.2</td>
                                        <td>94.8</td>
                                        <td>90.2</td>
                                    </tr>
                                    <tr>
                                        <td>2023-12</td>
                                        <td>343.2</td>
                                        <td>392.5</td>
                                        <td>105.6</td>
                                        <td>65.2</td>
                                        <td>94.8</td>
                                        <td>94.5</td>
                                        <td>89.6</td>
                                    </tr>
                                    <tr>
                                        <td>2023-11</td>
                                        <td>312.8</td>
                                        <td>368.9</td>
                                        <td>98.5</td>
                                        <td>62.8</td>
                                        <td>94.5</td>
                                        <td>94.2</td>
                                        <td>89.0</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å…¶ä»–åˆ†æå†…å®¹ï¼ˆé»˜è®¤éšè—ï¼‰ -->
            <div id="revenue-content" class="tab-content" style="display: none;">
                <!-- æ”¶ç›Šåˆ†æå†…å®¹ -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <span class="stat-title">æœ¬æœˆæ€»æ”¶ç›Š</span>
                            <div class="stat-icon green">ğŸ’°</div>
                        </div>
                        <div class="stat-value">
                            26.8 <span class="stat-unit">ä¸‡å…ƒ</span>
                        </div>
                        <div class="stat-trend trend-up">
                            <span>â–² 15.3%</span>
                            <span>ç¯æ¯”ä¸Šæœˆ</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <span class="stat-title">å³°è°·å¥—åˆ©æ”¶ç›Š</span>
                            <div class="stat-icon blue">ğŸ“ˆ</div>
                        </div>
                        <div class="stat-value">
                            15.6 <span class="stat-unit">ä¸‡å…ƒ</span>
                        </div>
                        <div class="stat-trend trend-up">
                            <span>â–² 18.6%</span>
                            <span>ç¯æ¯”ä¸Šæœˆ</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <span class="stat-title">éœ€é‡ç®¡ç†æ”¶ç›Š</span>
                            <div class="stat-icon yellow">âš¡</div>
                        </div>
                        <div class="stat-value">
                            8.2 <span class="stat-unit">ä¸‡å…ƒ</span>
                        </div>
                        <div class="stat-trend trend-up">
                            <span>â–² 12.5%</span>
                            <span>ç¯æ¯”ä¸Šæœˆ</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <span class="stat-title">è¾…åŠ©æœåŠ¡æ”¶ç›Š</span>
                            <div class="stat-icon purple">ğŸ”‹</div>
                        </div>
                        <div class="stat-value">
                            3.0 <span class="stat-unit">ä¸‡å…ƒ</span>
                        </div>
                        <div class="stat-trend trend-down">
                            <span>â–¼ 5.2%</span>
                            <span>ç¯æ¯”ä¸Šæœˆ</span>
                        </div>
                    </div>
                </div>
            </div>

            <div id="operation-content" class="tab-content" style="display: none;">
                <!-- è¿è¡Œåˆ†æå†…å®¹ -->
            </div>

            <div id="efficiency-content" class="tab-content" style="display: none;">
                <!-- æ•ˆç‡åˆ†æå†…å®¹ -->
            </div>

            <div id="comparison-content" class="tab-content" style="display: none;">
                <!-- å¯¹æ¯”åˆ†æå†…å®¹ -->
            </div>
        </div>
    </main>

    <script>
        // å¤šè¯­è¨€é…ç½®
        const i18n = {
            zh: {
                'page.title': 'æ•°æ®åˆ†æ',
                'system.name': 'èƒ½æºç®¡ç†ç³»ç»Ÿ',
                'menu.station': 'ç”µç«™ç®¡ç†',
                'menu.analysis': 'æ•°æ®åˆ†æ',
                'menu.alarm': 'å‘Šè­¦ç®¡ç†',
                'menu.device': 'è®¾å¤‡ç®¡ç†',
                'menu.user': 'ç”¨æˆ·ç®¡ç†',
                'menu.report': 'æŠ¥è¡¨ä¸­å¿ƒ',
                'menu.setting': 'ç³»ç»Ÿè®¾ç½®',
                'nav.export': 'å¯¼å‡º',
                'tab.energy': 'èƒ½è€—åˆ†æ',
                'tab.revenue': 'æ”¶ç›Šåˆ†æ',
                'tab.operation': 'è¿è¡Œåˆ†æ',
                'tab.efficiency': 'æ•ˆç‡åˆ†æ',
                'tab.comparison': 'å¯¹æ¯”åˆ†æ',
                'date.range': 'æ—¶é—´èŒƒå›´ï¼š',
                'date.to': 'è‡³',
                'date.today': 'ä»Šæ—¥',
                'date.week': 'æœ¬å‘¨',
                'date.month': 'æœ¬æœˆ',
                'date.year': 'æœ¬å¹´',
                'stat.totalGeneration': 'æ€»å‘ç”µé‡',
                'stat.totalConsumption': 'æ€»ç”¨ç”µé‡',
                'stat.selfUseRate': 'è‡ªç”¨ç‡',
                'stat.peakValleyArbitrage': 'å³°è°·å·®ä»·å¥—åˆ©',
                'stat.monthlyRevenue': 'æœ¬æœˆæ€»æ”¶ç›Š',
                'stat.peakValleyRevenue': 'å³°è°·å¥—åˆ©æ”¶ç›Š',
                'stat.demandRevenue': 'éœ€é‡ç®¡ç†æ”¶ç›Š',
                'stat.ancillaryRevenue': 'è¾…åŠ©æœåŠ¡æ”¶ç›Š',
                'trend.mom': 'ç¯æ¯”ä¸Šæœˆ',
                'chart.dailyGeneration': 'æ—¥å‘ç”µé‡è¶‹åŠ¿',
                'chart.chargeTimeDistribution': 'å……æ”¾ç”µæ—¶æ®µåˆ†å¸ƒ',
                'chart.peakDistribution': 'å³°å¹³è°·ç”µé‡åˆ†å¸ƒ',
                'chart.monthlyComparison': 'æœˆåº¦èƒ½è€—å¯¹æ¯”',
                'chart.bar': 'æŸ±çŠ¶å›¾',
                'chart.line': 'æŠ˜çº¿å›¾',
                'table.export': 'å¯¼å‡ºè¡¨æ ¼',
                'table.month': 'æœˆä»½',
                'table.generation': 'å‘ç”µé‡(MWh)',
                'table.consumption': 'ç”¨ç”µé‡(MWh)',
                'table.gridFeed': 'ä¸Šç½‘ç”µé‡(MWh)',
                'table.selfUseRate': 'è‡ªç”¨ç‡(%)',
                'table.chargeEfficiency': 'å……ç”µæ•ˆç‡(%)',
                'table.dischargeEfficiency': 'æ”¾ç”µæ•ˆç‡(%)',
                'table.overallEfficiency': 'ç»¼åˆæ•ˆç‡(%)'
            },
            en: {
                'page.title': 'Data Analysis',
                'system.name': 'Energy Management System',
                'menu.station': 'Station Management',
                'menu.analysis': 'Data Analysis',
                'menu.alarm': 'Alarm Management',
                'menu.device': 'Device Management',
                'menu.user': 'User Management',
                'menu.report': 'Report Center',
                'menu.setting': 'System Settings',
                'nav.export': 'Export',
                'tab.energy': 'Energy Analysis',
                'tab.revenue': 'Revenue Analysis',
                'tab.operation': 'Operation Analysis',
                'tab.efficiency': 'Efficiency Analysis',
                'tab.comparison': 'Comparison Analysis',
                'date.range': 'Date Range:',
                'date.to': 'to',
                'date.today': 'Today',
                'date.week': 'This Week',
                'date.month': 'This Month',
                'date.year': 'This Year',
                'stat.totalGeneration': 'Total Generation',
                'stat.totalConsumption': 'Total Consumption',
                'stat.selfUseRate': 'Self-use Rate',
                'stat.peakValleyArbitrage': 'Peak-Valley Arbitrage',
                'stat.monthlyRevenue': 'Monthly Revenue',
                'stat.peakValleyRevenue': 'Peak-Valley Revenue',
                'stat.demandRevenue': 'Demand Revenue',
                'stat.ancillaryRevenue': 'Ancillary Revenue',
                'trend.mom': 'vs Last Month',
                'chart.dailyGeneration': 'Daily Generation Trend',
                'chart.chargeTimeDistribution': 'Charge/Discharge Time Distribution',
                'chart.peakDistribution': 'Peak/Flat/Valley Distribution',
                'chart.monthlyComparison': 'Monthly Energy Comparison',
                'chart.bar': 'Bar Chart',
                'chart.line': 'Line Chart',
                'table.export': 'Export Table',
                'table.month': 'Month',
                'table.generation': 'Generation(MWh)',
                'table.consumption': 'Consumption(MWh)',
                'table.gridFeed': 'Grid Feed(MWh)',
                'table.selfUseRate': 'Self-use Rate(%)',
                'table.chargeEfficiency': 'Charge Efficiency(%)',
                'table.dischargeEfficiency': 'Discharge Efficiency(%)',
                'table.overallEfficiency': 'Overall Efficiency(%)'
            }
        };

        // å½“å‰è¯­è¨€
        let currentLang = localStorage.getItem('ess_language') || 'zh';

        // ç¿»è¯‘å‡½æ•°
        function t(key) {
            return i18n[currentLang][key] || key;
        }

        // åˆ‡æ¢è¯­è¨€
        function toggleLanguage() {
            currentLang = currentLang === 'zh' ? 'en' : 'zh';
            localStorage.setItem('ess_language', currentLang);
            document.getElementById('lang-text').textContent = currentLang === 'zh' ? 'ä¸­æ–‡' : 'English';
            applyLanguage();
        }

        // åº”ç”¨è¯­è¨€
        function applyLanguage() {
            // æ›´æ–°é¡µé¢æ ‡é¢˜
            document.title = `${t('page.title')} - ${t('system.name')}`;
            
            // æ›´æ–°å¯¼èˆªæ 
            document.querySelector('.page-title').textContent = t('page.title');
            document.querySelector('.logo span').textContent = t('system.name');
            
            // æ›´æ–°èœå•
            const menuItems = document.querySelectorAll('.menu-item span:last-child');
            const menuKeys = ['station', 'analysis', 'alarm', 'device', 'user', 'report', 'setting'];
            menuItems.forEach((item, index) => {
                if (menuKeys[index]) {
                    item.textContent = t(`menu.${menuKeys[index]}`);
                }
            });
            
            // æ›´æ–°é€‰é¡¹å¡
            const tabs = document.querySelectorAll('.tab-button');
            const tabKeys = ['energy', 'revenue', 'operation', 'efficiency', 'comparison'];
            tabs.forEach((tab, index) => {
                if (tabKeys[index]) {
                    tab.textContent = t(`tab.${tabKeys[index]}`);
                }
            });
            
            // æ›´æ–°å…¶ä»–ç•Œé¢å…ƒç´ 
            updateUITexts();
        }

        // æ›´æ–°ç•Œé¢æ–‡æœ¬
        function updateUITexts() {
            // æ›´æ–°ç»Ÿè®¡å¡ç‰‡æ ‡é¢˜
            document.querySelectorAll('.stat-title').forEach((el, index) => {
                const activeTab = document.querySelector('.tab-button.active').getAttribute('onclick').match(/'(\w+)'/)[1];
                if (activeTab === 'energy') {
                    const keys = ['totalGeneration', 'totalConsumption', 'selfUseRate', 'peakValleyArbitrage'];
                    if (keys[index]) el.textContent = t(`stat.${keys[index]}`);
                } else if (activeTab === 'revenue') {
                    const keys = ['monthlyRevenue', 'peakValleyRevenue', 'demandRevenue', 'ancillaryRevenue'];
                    if (keys[index]) el.textContent = t(`stat.${keys[index]}`);
                }
            });
            
            // æ›´æ–°è¶‹åŠ¿æ–‡æœ¬
            document.querySelectorAll('.stat-trend span:last-child').forEach(el => {
                if (el.textContent.includes('ç¯æ¯”') || el.textContent.includes('Last Month')) {
                    el.textContent = t('trend.mom');
                }
            });
        }

        // åˆ‡æ¢ä¸»é¢˜
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('ess_theme', newTheme);
            document.getElementById('theme-icon').textContent = newTheme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
            
            // é‡ç»˜å›¾è¡¨ä»¥é€‚åº”æ–°ä¸»é¢˜
            initCharts();
        }

        // åˆ‡æ¢ä¾§è¾¹æ 
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
        }

        // è¿”å›
        function goBack() {
            window.location.href = '../scenario-selection.html';
        }

        // åˆ‡æ¢é€‰é¡¹å¡
        function switchTab(tabName) {
            // æ›´æ–°é€‰é¡¹å¡çŠ¶æ€
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // éšè—æ‰€æœ‰å†…å®¹
            document.querySelectorAll('.tab-content').forEach(content => {
                content.style.display = 'none';
            });
            
            // æ˜¾ç¤ºå¯¹åº”å†…å®¹
            const contentId = `${tabName}-content`;
            const content = document.getElementById(contentId);
            if (content) {
                content.style.display = 'block';
                // é‡æ–°åˆå§‹åŒ–è¯¥é€‰é¡¹å¡çš„å›¾è¡¨
                if (tabName === 'energy') {
                    setTimeout(initEnergyCharts, 100);
                }
            }
            
            // æ›´æ–°ç•Œé¢æ–‡æœ¬
            updateUITexts();
        }

        // é€‰æ‹©æ—¥æœŸèŒƒå›´
        function selectDateRange(range) {
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.quick-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // è®¾ç½®æ—¥æœŸ
            const today = new Date();
            let startDate = new Date();
            let endDate = new Date();
            
            switch(range) {
                case 'today':
                    startDate = today;
                    endDate = today;
                    break;
                case 'week':
                    startDate.setDate(today.getDate() - today.getDay());
                    endDate = today;
                    break;
                case 'month':
                    startDate.setDate(1);
                    endDate = today;
                    break;
                case 'year':
                    startDate = new Date(today.getFullYear(), 0, 1);
                    endDate = today;
                    break;
            }
            
            document.getElementById('start-date').value = formatDate(startDate);
            document.getElementById('end-date').value = formatDate(endDate);
            
            // åˆ·æ–°æ•°æ®
            refreshData();
        }

        // æ ¼å¼åŒ–æ—¥æœŸ
        function formatDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // å¯¼å‡ºæ•°æ®
        function exportData() {
            console.log('å¯¼å‡ºæ•°æ®');
            // è¿™é‡Œå¯ä»¥å®ç°æ•°æ®å¯¼å‡ºåŠŸèƒ½
        }

        // å¯¼å‡ºè¡¨æ ¼
        function exportTable() {
            console.log('å¯¼å‡ºè¡¨æ ¼');
            // è¿™é‡Œå¯ä»¥å®ç°è¡¨æ ¼å¯¼å‡ºåŠŸèƒ½
        }

        // åˆ·æ–°æ•°æ®
        function refreshData() {
            console.log('åˆ·æ–°æ•°æ®');
            // è¿™é‡Œå¯ä»¥å®ç°æ•°æ®åˆ·æ–°åŠŸèƒ½
            initCharts();
        }

        // ç»˜åˆ¶æ—¥å‘ç”µé‡å›¾è¡¨
        function drawDailyGenerationChart() {
            const canvas = document.getElementById('dailyGenerationCanvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = rect.height;
            
            // æ¸…é™¤ç”»å¸ƒ
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // æ¨¡æ‹Ÿæ—¥å‘ç”µé‡æ•°æ®
            const days = 31;
            const data = [];
            for (let i = 1; i <= days; i++) {
                data.push(Math.random() * 15 + 10); // 10-25 MWh
            }
            
            const padding = 60;
            const chartWidth = canvas.width - padding * 2;
            const chartHeight = canvas.height - padding * 2;
            const barWidth = chartWidth / days - 2;
            
            // ç»˜åˆ¶åæ ‡è½´
            ctx.strokeStyle = '#e2e8f0';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, canvas.height - padding);
            ctx.lineTo(canvas.width - padding, canvas.height - padding);
            ctx.stroke();
            
            // ç»˜åˆ¶æŸ±çŠ¶å›¾
            const maxValue = Math.max(...data);
            ctx.fillStyle = '#2563eb';
            
            data.forEach((value, index) => {
                const x = padding + index * (chartWidth / days) + 1;
                const barHeight = (value / maxValue) * chartHeight;
                const y = canvas.height - padding - barHeight;
                
                ctx.fillRect(x, y, barWidth, barHeight);
            });
            
            // ç»˜åˆ¶Yè½´æ ‡ç­¾
            ctx.fillStyle = '#64748b';
            ctx.font = '12px sans-serif';
            ctx.textAlign = 'right';
            
            for (let i = 0; i <= 5; i++) {
                const value = (maxValue * i / 5).toFixed(1);
                const y = canvas.height - padding - (chartHeight * i / 5);
                ctx.fillText(`${value}`, padding - 10, y + 3);
            }
            
            // ç»˜åˆ¶Xè½´æ ‡ç­¾
            ctx.textAlign = 'center';
            for (let i = 0; i < days; i += 5) {
                const x = padding + i * (chartWidth / days) + barWidth / 2;
                ctx.fillText(`${i + 1}æ—¥`, x, canvas.height - padding + 20);
            }
        }

        // ç»˜åˆ¶å……æ”¾ç”µæ—¶æ®µåˆ†å¸ƒ
        function drawChargeTimeChart() {
            const canvas = document.getElementById('chargeTimeCanvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = rect.height;
            
            // æ¨¡æ‹Ÿ24å°æ—¶å……æ”¾ç”µæ•°æ®
            const hours = 24;
            const chargeData = [];
            const dischargeData = [];
            
            for (let i = 0; i < hours; i++) {
                if (i >= 0 && i < 8) {
                    // å¤œé—´å……ç”µ
                    chargeData.push(Math.random() * 50 + 50);
                    dischargeData.push(0);
                } else if (i >= 10 && i < 12) {
                    // ä¸Šåˆæ”¾ç”µ
                    chargeData.push(0);
                    dischargeData.push(Math.random() * 80 + 70);
                } else if (i >= 18 && i < 22) {
                    // æ™šé«˜å³°æ”¾ç”µ
                    chargeData.push(0);
                    dischargeData.push(Math.random() * 90 + 80);
                } else {
                    chargeData.push(Math.random() * 10);
                    dischargeData.push(Math.random() * 10);
                }
            }
            
            const padding = 40;
            const chartWidth = canvas.width - padding * 2;
            const chartHeight = canvas.height - padding * 2;
            const barWidth = chartWidth / hours / 2 - 1;
            
            // ç»˜åˆ¶å……ç”µæŸ±
            ctx.fillStyle = '#10b981';
            chargeData.forEach((value, index) => {
                if (value > 0) {
                    const x = padding + index * (chartWidth / hours);
                    const barHeight = (value / 100) * chartHeight;
                    const y = canvas.height - padding - barHeight;
                    ctx.fillRect(x, y, barWidth, barHeight);
                }
            });
            
            // ç»˜åˆ¶æ”¾ç”µæŸ±
            ctx.fillStyle = '#f59e0b';
            dischargeData.forEach((value, index) => {
                if (value > 0) {
                    const x = padding + index * (chartWidth / hours) + barWidth + 1;
                    const barHeight = (value / 100) * chartHeight;
                    const y = canvas.height - padding - barHeight;
                    ctx.fillRect(x, y, barWidth, barHeight);
                }
            });
            
            // ç»˜åˆ¶å›¾ä¾‹
            ctx.font = '12px sans-serif';
            ctx.fillStyle = '#10b981';
            ctx.fillRect(canvas.width - 120, 20, 15, 15);
            ctx.fillStyle = '#64748b';
            ctx.fillText('å……ç”µ', canvas.width - 100, 32);
            
            ctx.fillStyle = '#f59e0b';
            ctx.fillRect(canvas.width - 60, 20, 15, 15);
            ctx.fillStyle = '#64748b';
            ctx.fillText('æ”¾ç”µ', canvas.width - 40, 32);
        }

        // ç»˜åˆ¶å³°å¹³è°·åˆ†å¸ƒ
        function drawPeakDistributionChart() {
            const canvas = document.getElementById('peakDistributionCanvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = rect.height;
            
            // æ¨¡æ‹Ÿå³°å¹³è°·æ•°æ®
            const peakData = 35;
            const flatData = 45;
            const valleyData = 20;
            const total = peakData + flatData + valleyData;
            
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = Math.min(canvas.width, canvas.height) / 3;
            
            let currentAngle = -Math.PI / 2;
            
            // ç»˜åˆ¶å³°æ—¶æ®µ
            ctx.beginPath();
            const peakAngle = (peakData / total) * 2 * Math.PI;
            ctx.arc(centerX, centerY, radius, currentAngle, currentAngle + peakAngle);
            ctx.lineTo(centerX, centerY);
            ctx.fillStyle = '#ef4444';
            ctx.fill();
            currentAngle += peakAngle;
            
            // ç»˜åˆ¶å¹³æ—¶æ®µ
            ctx.beginPath();
            const flatAngle = (flatData / total) * 2 * Math.PI;
            ctx.arc(centerX, centerY, radius, currentAngle, currentAngle + flatAngle);
            ctx.lineTo(centerX, centerY);
            ctx.fillStyle = '#f59e0b';
            ctx.fill();
            currentAngle += flatAngle;
            
            // ç»˜åˆ¶è°·æ—¶æ®µ
            ctx.beginPath();
            const valleyAngle = (valleyData / total) * 2 * Math.PI;
            ctx.arc(centerX, centerY, radius, currentAngle, currentAngle + valleyAngle);
            ctx.lineTo(centerX, centerY);
            ctx.fillStyle = '#10b981';
            ctx.fill();
            
            // ç»˜åˆ¶å›¾ä¾‹
            const legendY = centerY + radius + 30;
            ctx.font = '12px sans-serif';
            
            ctx.fillStyle = '#ef4444';
            ctx.fillRect(centerX - 100, legendY, 15, 15);
            ctx.fillStyle = '#64748b';
            ctx.fillText(`å³°æ—¶: ${peakData}%`, centerX - 80, legendY + 12);
            
            ctx.fillStyle = '#f59e0b';
            ctx.fillRect(centerX - 20, legendY, 15, 15);
            ctx.fillStyle = '#64748b';
            ctx.fillText(`å¹³æ—¶: ${flatData}%`, centerX, legendY + 12);
            
            ctx.fillStyle = '#10b981';
            ctx.fillRect(centerX + 60, legendY, 15, 15);
            ctx.fillStyle = '#64748b';
            ctx.fillText(`è°·æ—¶: ${valleyData}%`, centerX + 80, legendY + 12);
        }

        // åˆå§‹åŒ–èƒ½è€—åˆ†æå›¾è¡¨
        function initEnergyCharts() {
            drawDailyGenerationChart();
            drawChargeTimeChart();
            drawPeakDistributionChart();
        }

        // åˆå§‹åŒ–æ‰€æœ‰å›¾è¡¨
        function initCharts() {
            const activeTab = document.querySelector('.tab-button.active');
            if (activeTab) {
                const tabName = activeTab.getAttribute('onclick').match(/'(\w+)'/)[1];
                if (tabName === 'energy') {
                    initEnergyCharts();
                }
                // å…¶ä»–é€‰é¡¹å¡çš„å›¾è¡¨åˆå§‹åŒ–
            }
        }

        // çª—å£å¤§å°æ”¹å˜æ—¶é‡ç»˜å›¾è¡¨
        window.addEventListener('resize', () => {
            initCharts();
        });

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            // åº”ç”¨ä¿å­˜çš„ä¸»é¢˜
            const savedTheme = localStorage.getItem('ess_theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            document.getElementById('theme-icon').textContent = savedTheme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
            
            // åº”ç”¨è¯­è¨€
            applyLanguage();
            
            // åˆå§‹åŒ–å›¾è¡¨
            setTimeout(initCharts, 100);
            
            // è®¾ç½®é»˜è®¤æ—¥æœŸ
            const today = new Date();
            const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
            document.getElementById('start-date').value = formatDate(firstDay);
            document.getElementById('end-date').value = formatDate(today);
        });
    </script>
</body>
</html>