<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>告警规则 - 工商储能管理系统</title>
    <link rel="stylesheet" href="../sidebar.css">
    <link rel="stylesheet" href="../navbar.css">
    <link rel="stylesheet" href="../responsive.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f3f4f6;
            color: #1f2937;
        }

        .content {
            padding: 2rem;
        }

        /* 查询区域卡片 */
        .search-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 1rem;
        }
        
        /* 内容区域卡片 */
        .content-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .table-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* 表格容器 */
        .table-container {
            padding: 1rem 1.5rem 1.5rem;
        }
        
        .rules-table {
            width: 100%;
            border-collapse: collapse;
        }

        .rules-table th,
        .rules-table td {
            padding: 0.75rem 1rem;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
            font-size: 0.875rem;
            white-space: nowrap;
        }
        
        /* 调整特定列的宽度 */
        .rules-table th:first-child,
        .rules-table td:first-child {
            width: 20%;
        }
        
        .rules-table th:nth-child(2),
        .rules-table td:nth-child(2) {
            width: 12%;
        }
        
        .rules-table th:nth-child(3),
        .rules-table td:nth-child(3) {
            width: 18%;
        }
        
        .rules-table th:nth-child(4),
        .rules-table td:nth-child(4) {
            width: 8%;
        }
        
        .rules-table th:nth-child(5),
        .rules-table td:nth-child(5) {
            width: 8%;
        }
        
        .rules-table th:nth-child(6),
        .rules-table td:nth-child(6) {
            width: 8%;
        }
        
        .rules-table th:nth-child(7),
        .rules-table td:nth-child(7) {
            width: 12%;
        }
        
        .rules-table th:last-child,
        .rules-table td:last-child {
            width: 14%;
        }

        .rules-table th {
            background: #f9fafb;
            font-weight: 600;
            color: #374151;
        }

        .rules-table tr:hover {
            background: #f9fafb;
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-badge.active {
            background: #d1fae5;
            color: #059669;
        }

        .status-badge.inactive {
            background: #fee2e2;
            color: #dc2626;
        }

        .severity-badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .severity-critical {
            background: #fee2e2;
            color: #dc2626;
        }

        .severity-major {
            background: #fef3c7;
            color: #d97706;
        }

        .severity-minor {
            background: #dbeafe;
            color: #1d4ed8;
        }

        .severity-warning {
            background: #f3f4f6;
            color: #374151;
        }

        .action-buttons {
            display: flex;
            gap: 0.25rem;
            justify-content: center;
        }

        .btn-action {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.375rem;
            border-radius: 0.25rem;
            color: #374151;
            transition: all 0.15s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .btn-action:hover {
            background: #f3f4f6;
            color: #111827;
        }

        .btn-action svg {
            width: 1rem;
            height: 1rem;
        }

        .btn {
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            border: 1px solid transparent;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: #3562E3;
            color: white;
            border-color: #3562E3;
        }
        
        .btn-primary:hover {
            background: #2951d3;
            border-color: #2951d3;
        }

        .btn-secondary {
            background: white;
            color: #64748b;
            border: 1px solid #e2e8f0;
        }
        
        .btn-secondary:hover {
            background: #f8fafc;
            border-color: #cbd5e1;
            color: #1e293b;
        }
        
        .btn span {
            font-size: 1rem;
            line-height: 1;
        }
        
        /* 设备类型分类样式 */
        .device-type-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            padding: 0;
            background: transparent;
        }
        
        .device-type-tab {
            padding: 1rem 1.5rem;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 0.875rem;
            color: #6b7280;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
            position: relative;
        }
        
        .device-type-tab:hover {
            color: #374151;
        }
        
        .device-type-tab.active {
            color: #3b82f6;
            border-bottom-color: #3b82f6;
        }
        
        .device-type-tab .count {
            background: #e5e7eb;
            color: #374151;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            margin-left: 0.5rem;
        }
        
        .device-type-tab.active .count {
            background: #dbeafe;
            color: #3b82f6;
        }
        
        /* 筛选区域 */
        .filter-section {
            padding: 1rem 1.5rem;
        }
        
        .filter-row {
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
            justify-content: space-between;
        }
        
        .filter-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .filter-label {
            font-size: 0.875rem;
            color: #6b7280;
        }
        
        .filter-select {
            padding: 0.5rem 1rem;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            font-size: 0.875rem;
            background: white;
            color: #374151;
            min-width: 150px;
        }
        
        .filter-buttons {
            display: flex;
            gap: 0.5rem;
            margin-left: auto;
        }
        
        /* 操作按钮区域 */
        .action-bar {
            padding: 1rem 1.5rem 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .action-buttons-left {
            display: flex;
            gap: 0.5rem;
        }
        
        /* 空状态 */
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #6b7280;
        }
        
        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.3;
        }
        
        /* 规则编辑弹窗 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h3 {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1f2937;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #6b7280;
            cursor: pointer;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            transition: all 0.2s;
        }
        
        .modal-close:hover {
            background: #f3f4f6;
            color: #1f2937;
        }
        
        .modal-body {
            padding: 0;
        }

        /* Tab样式 */
        .modal-tabs {
            display: flex;
            border-bottom: 1px solid #e5e7eb;
            background: #f9fafb;
        }

        .modal-tab {
            padding: 1rem 1.5rem;
            background: none;
            border: none;
            font-size: 0.875rem;
            font-weight: 500;
            color: #6b7280;
            cursor: pointer;
            position: relative;
            transition: all 150ms ease;
            flex: 1;
        }

        .modal-tab:hover {
            color: #374151;
            background: #f3f4f6;
        }

        .modal-tab.active {
            color: #3b82f6;
            background: white;
        }

        .modal-tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 2px;
            background: #3b82f6;
        }

        .modal-tab-content {
            padding: 1.5rem;
            display: none;
        }

        .modal-tab-content.active {
            display: block;
        }

        /* 删除确认弹窗样式 */
        .confirm-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1100;
            align-items: center;
            justify-content: center;
        }

        .confirm-content {
            background: white;
            border-radius: 12px;
            width: 400px;
            max-width: 90%;
            padding: 2rem;
            text-align: center;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        .confirm-icon {
            width: 48px;
            height: 48px;
            background: #fee2e2;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            color: #dc2626;
            font-size: 1.5rem;
        }

        .confirm-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }

        .confirm-message {
            font-size: 0.875rem;
            color: #6b7280;
            margin-bottom: 1.5rem;
        }

        .confirm-buttons {
            display: flex;
            gap: 0.75rem;
            justify-content: center;
        }

        /* 条件行样式 */
        .condition-item {
            margin-bottom: 0.75rem;
        }

        .condition-row {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .condition-select {
            flex: 1;
            padding: 0.625rem 0.875rem;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 0.875rem;
            color: #1f2937;
            background: white;
        }

        .condition-input {
            flex: 1;
            padding: 0.625rem 0.875rem;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 0.875rem;
            color: #1f2937;
            background: white;
        }

        .btn-remove-condition {
            background: #fee2e2;
            border: none;
            border-radius: 6px;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: #dc2626;
            transition: all 150ms ease;
        }

        .btn-remove-condition:hover {
            background: #fecaca;
        }

        .btn-add-condition {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.875rem;
            color: #64748b;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 150ms ease;
        }

        .btn-add-condition:hover {
            background: #f1f5f9;
            border-color: #cbd5e1;
            color: #1e293b;
        }

        /* 开关样式 */
        .switch {
            position: relative;
            display: inline-block;
            width: 48px;
            height: 24px;
        }
        
        .table-switch {
            position: relative;
            display: inline-block;
            width: 40px;
            height: 20px;
        }
        
        .table-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .table-switch .switch-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #cbd5e1;
            transition: all 0.3s ease;
            border-radius: 20px;
        }
        
        .table-switch .switch-slider:before {
            position: absolute;
            content: "";
            height: 14px;
            width: 14px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: all 0.3s ease;
            border-radius: 50%;
        }
        
        .table-switch input:checked + .switch-slider {
            background-color: #3b82f6;
        }
        
        .table-switch input:checked + .switch-slider:before {
            transform: translateX(20px);
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .switch-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #cbd5e1;
            transition: all 0.3s ease;
            border-radius: 24px;
        }

        .switch-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: all 0.3s ease;
            border-radius: 50%;
        }

        .switch input:checked + .switch-slider {
            background-color: #3b82f6;
        }

        .switch input:checked + .switch-slider:before {
            transform: translateX(24px);
        }

        .switch-wrapper {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .switch-label {
            font-size: 0.875rem;
            color: #374151;
        }
        
        .form-section {
            margin-bottom: 2rem;
        }
        
        .form-section h4 {
            font-size: 1rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 1rem;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: #374151;
            margin-bottom: 0.5rem;
        }
        
        .form-input {
            width: 100%;
            padding: 0.625rem 0.875rem;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 0.875rem;
            color: #1f2937;
            background: white;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }
        
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-top: 0.5rem;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .checkbox-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .checkbox-item label {
            font-size: 0.875rem;
            color: #374151;
            cursor: pointer;
            margin: 0;
        }
        
        .station-select-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 0.75rem;
            max-height: 200px;
            overflow-y: auto;
            padding: 0.5rem;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            background: #f9fafb;
        }
        
        .modal-footer {
            padding: 1.5rem;
            border-top: 1px solid #e5e7eb;
            display: flex;
            justify-content: flex-end;
            gap: 0.75rem;
        }
        
        .btn-cancel {
            padding: 0.625rem 1.25rem;
            background: white;
            color: #374151;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
        }
        
        .btn-save {
            padding: 0.625rem 1.25rem;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
        }
        
        /* Toast提示 */
        .toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: #1f2937;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-size: 0.875rem;
            z-index: 1100;
            opacity: 0;
            transition: all 0.3s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }
    </style>
</head>
<body>
    <!-- 侧边栏容器 -->
    <div id="sidebar-container"></div>
<div class="main-content">

                <!-- 顶部导航栏 -->
        <nav class="navbar">
            <div class="navbar-left">
                <button class="nav-button" onclick="toggleSidebar()">
                    <span>☰</span>
                </button>
                <button class="nav-button" onclick="goBack()" title="返回场景选择">
                    <span>←</span>
                </button>
                <h1 class="page-title">告警规则</h1>
            </div>
            <div class="navbar-right">
                <button class="nav-button" onclick="toggleLanguage()">
                    <span>🌐</span>
                    <span id="lang-text">中文</span>
                </button>
                <button class="nav-button" onclick="toggleTheme()">
                    <span id="theme-icon">🌙</span>
                </button>
                <button class="nav-button">
                    <span>👤</span>
                    <span>管理员</span>
                </button>
            </div>
        </nav>

<div class="content">
            <div class="page-content">
                <!-- 设备类型分类标签 -->
                <div class="device-type-tabs">
                    <button class="device-type-tab active" onclick="filterByDeviceType('battery', event)">
                        储能电池<span class="count">8</span>
                    </button>
                    <button class="device-type-tab" onclick="filterByDeviceType('pcs', event)">
                        PCS变流器<span class="count">6</span>
                    </button>
                    <button class="device-type-tab" onclick="filterByDeviceType('bms', event)">
                        BMS系统<span class="count">4</span>
                    </button>
                    <button class="device-type-tab" onclick="filterByDeviceType('ems', event)">
                        EMS系统<span class="count">5</span>
                    </button>
                    <button class="device-type-tab" onclick="filterByDeviceType('hvac', event)">
                        温控系统<span class="count">3</span>
                    </button>
                    <button class="device-type-tab" onclick="filterByDeviceType('fire', event)">
                        消防系统<span class="count">3</span>
                    </button>
                </div>
                
                <!-- 查询区域卡片 -->
                <div class="search-card">
                    <!-- 筛选区域 -->
                    <div class="filter-section">
                        <div class="filter-row">
                            <div class="filter-group">
                                <span class="filter-label">严重程度：</span>
                                <select class="filter-select" id="severityFilter">
                                    <option value="">全部</option>
                                    <option value="critical">严重</option>
                                    <option value="major">重要</option>
                                    <option value="minor">次要</option>
                                    <option value="warning">警告</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <span class="filter-label">状态：</span>
                                <select class="filter-select" id="statusFilter">
                                    <option value="">全部</option>
                                    <option value="active">启用</option>
                                    <option value="inactive">禁用</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <span class="filter-label">电站：</span>
                                <select class="filter-select" id="stationFilter">
                                    <option value="">全部电站</option>
                                    <option value="ST001">上海工业园储能站</option>
                                    <option value="ST002">北京科技园储能站</option>
                                    <option value="ST003">深圳产业园储能站</option>
                                </select>
                            </div>
                            <div class="filter-buttons">
                                <button class="btn btn-primary" onclick="searchRules()">查询</button>
                                <button class="btn btn-secondary" onclick="resetFilters()">重置</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 内容区域卡片 -->
                <div class="content-card">
                    <!-- 操作按钮区域 -->
                    <div class="action-bar">
                        <div class="action-buttons-left">
                            <button class="btn btn-primary" onclick="createRule()">
                                <span>+</span> 新建规则
                            </button>
                            <button class="btn btn-secondary" onclick="importRules()">
                                <span>↓</span> 导入
                            </button>
                        </div>
                    </div>

                    <div class="table-container">
                        <table class="rules-table">
                        <thead>
                            <tr>
                                <th>规则名称</th>
                                <th>条件</th>
                                <th>严重程度</th>
                                <th>状态</th>
                                <th>设备数量</th>
                                <th>触发次数</th>
                                <th>最后触发</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr data-device-type="battery">
                                <td>电池温度过高告警</td>
                                <td>温度 > 45°C</td>
                                <td><span class="severity-badge severity-critical">严重</span></td>
                                <td>
                                    <label class="table-switch">
                                        <input type="checkbox" checked onchange="toggleRuleStatus(this, 'rule1')">
                                        <span class="switch-slider"></span>
                                    </label>
                                </td>
                                <td>8</td>
                                <td>3</td>
                                <td>2024-01-24 14:30</td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn-action" onclick="editRule('rule1')" title="编辑">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                            </svg>
                                        </button>
                                        <button class="btn-action" onclick="copyRule('rule1')" title="复制">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                            </svg>
                                        </button>
                                        <button class="btn-action" onclick="deleteRule('rule1')" title="删除">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M3 6h18"></path>
                                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"></path>
                                                <path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                                <line x1="10" y1="11" x2="10" y2="17"></line>
                                                <line x1="14" y1="11" x2="14" y2="17"></line>
                                            </svg>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            <tr data-device-type="pcs">
                                <td>PCS电流异常</td>
                                <td>电流 > 500A</td>
                                <td><span class="severity-badge severity-major">重要</span></td>
                                <td>
                                    <label class="table-switch">
                                        <input type="checkbox" checked onchange="toggleRuleStatus(this, 'rule2')">
                                        <span class="switch-slider"></span>
                                    </label>
                                </td>
                                <td>6</td>
                                <td>1</td>
                                <td>2024-01-23 09:15</td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn-action" onclick="editRule('rule2')" title="编辑">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                            </svg>
                                        </button>
                                        <button class="btn-action" onclick="copyRule('rule2')" title="复制">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                            </svg>
                                        </button>
                                        <button class="btn-action" onclick="deleteRule('rule2')" title="删除">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M3 6h18"></path>
                                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"></path>
                                                <path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                                <line x1="10" y1="11" x2="10" y2="17"></line>
                                                <line x1="14" y1="11" x2="14" y2="17"></line>
                                            </svg>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            <tr data-device-type="all">
                                <td>通信故障检测</td>
                                <td>通信中断 > 5分钟</td>
                                <td><span class="severity-badge severity-major">重要</span></td>
                                <td>
                                    <label class="table-switch">
                                        <input type="checkbox" checked onchange="toggleRuleStatus(this, 'rule3')">
                                        <span class="switch-slider"></span>
                                    </label>
                                </td>
                                <td>29</td>
                                <td>8</td>
                                <td>2024-01-22 16:45</td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn-action" onclick="editRule('rule3')" title="编辑">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                            </svg>
                                        </button>
                                        <button class="btn-action" onclick="copyRule('rule3')" title="复制">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                            </svg>
                                        </button>
                                        <button class="btn-action" onclick="deleteRule('rule3')" title="删除">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M3 6h18"></path>
                                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"></path>
                                                <path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                                <line x1="10" y1="11" x2="10" y2="17"></line>
                                                <line x1="14" y1="11" x2="14" y2="17"></line>
                                            </svg>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            <tr data-device-type="battery">
                                <td>SOC过低警告</td>
                                <td>SOC < 10%</td>
                                <td><span class="severity-badge severity-minor">次要</span></td>
                                <td>
                                    <label class="table-switch">
                                        <input type="checkbox" onchange="toggleRuleStatus(this, 'rule4')">
                                        <span class="switch-slider"></span>
                                    </label>
                                </td>
                                <td>8</td>
                                <td>0</td>
                                <td>-</td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn-action" onclick="editRule('rule4')" title="编辑">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                            </svg>
                                        </button>
                                        <button class="btn-action" onclick="copyRule('rule4')" title="复制">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                            </svg>
                                        </button>
                                        <button class="btn-action" onclick="deleteRule('rule4')" title="删除">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M3 6h18"></path>
                                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"></path>
                                                <path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                                <line x1="10" y1="11" x2="10" y2="17"></line>
                                                <line x1="14" y1="11" x2="14" y2="17"></line>
                                            </svg>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            <tr data-device-type="hvac">
                                <td>空调温度告警</td>
                                <td>环境温度 > 35°C</td>
                                <td><span class="severity-badge severity-warning">警告</span></td>
                                <td>
                                    <label class="table-switch">
                                        <input type="checkbox" checked onchange="toggleRuleStatus(this, 'rule5')">
                                        <span class="switch-slider"></span>
                                    </label>
                                </td>
                                <td>3</td>
                                <td>15</td>
                                <td>2024-01-24 13:20</td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn-action" onclick="editRule('rule5')" title="编辑">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                            </svg>
                                        </button>
                                        <button class="btn-action" onclick="copyRule('rule5')" title="复制">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                            </svg>
                                        </button>
                                        <button class="btn-action" onclick="deleteRule('rule5')" title="删除">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M3 6h18"></path>
                                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"></path>
                                                <path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                                <line x1="10" y1="11" x2="10" y2="17"></line>
                                                <line x1="14" y1="11" x2="14" y2="17"></line>
                                            </svg>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            <tr data-device-type="bms">
                                <td>BMS通信异常</td>
                                <td>数据更新频率 < 1Hz</td>
                                <td><span class="severity-badge severity-major">重要</span></td>
                                <td>
                                    <label class="table-switch">
                                        <input type="checkbox" checked onchange="toggleRuleStatus(this, 'rule6')">
                                        <span class="switch-slider"></span>
                                    </label>
                                </td>
                                <td>4</td>
                                <td>2</td>
                                <td>2024-01-24 10:15</td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn-action" onclick="editRule('rule6')" title="编辑">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                            </svg>
                                        </button>
                                        <button class="btn-action" onclick="copyRule('rule6')" title="复制">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                            </svg>
                                        </button>
                                        <button class="btn-action" onclick="deleteRule('rule6')" title="删除">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M3 6h18"></path>
                                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"></path>
                                                <path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                                <line x1="10" y1="11" x2="10" y2="17"></line>
                                                <line x1="14" y1="11" x2="14" y2="17"></line>
                                            </svg>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            <tr data-device-type="fire">
                                <td>烟雾浓度超标</td>
                                <td>烟雾浓度 > 300ppm</td>
                                <td><span class="severity-badge severity-critical">严重</span></td>
                                <td>
                                    <label class="table-switch">
                                        <input type="checkbox" checked onchange="toggleRuleStatus(this, 'rule7')">
                                        <span class="switch-slider"></span>
                                    </label>
                                </td>
                                <td>3</td>
                                <td>0</td>
                                <td>-</td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn-action" onclick="editRule('rule7')" title="编辑">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                            </svg>
                                        </button>
                                        <button class="btn-action" onclick="copyRule('rule7')" title="复制">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                            </svg>
                                        </button>
                                        <button class="btn-action" onclick="deleteRule('rule7')" title="删除">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M3 6h18"></path>
                                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"></path>
                                                <path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                                <line x1="10" y1="11" x2="10" y2="17"></line>
                                                <line x1="14" y1="11" x2="14" y2="17"></line>
                                            </svg>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            <tr data-device-type="ems">
                                <td>充放电效率异常</td>
                                <td>充放电效率 < 85%</td>
                                <td><span class="severity-badge severity-major">重要</span></td>
                                <td>
                                    <label class="table-switch">
                                        <input type="checkbox" checked onchange="toggleRuleStatus(this, 'rule8')">
                                        <span class="switch-slider"></span>
                                    </label>
                                </td>
                                <td>5</td>
                                <td>5</td>
                                <td>2024-01-24 11:45</td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn-action" onclick="editRule('rule8')" title="编辑">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                            </svg>
                                        </button>
                                        <button class="btn-action" onclick="copyRule('rule8')" title="复制">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                            </svg>
                                        </button>
                                        <button class="btn-action" onclick="deleteRule('rule8')" title="删除">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M3 6h18"></path>
                                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"></path>
                                                <path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                                <line x1="10" y1="11" x2="10" y2="17"></line>
                                                <line x1="14" y1="11" x2="14" y2="17"></line>
                                            </svg>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            <tr data-device-type="ems">
                                <td>功率调度异常</td>
                                <td>实际功率偏差 > 10%</td>
                                <td><span class="severity-badge severity-major">重要</span></td>
                                <td>
                                    <label class="table-switch">
                                        <input type="checkbox" checked onchange="toggleRuleStatus(this, 'rule9')">
                                        <span class="switch-slider"></span>
                                    </label>
                                </td>
                                <td>5</td>
                                <td>2</td>
                                <td>2024-01-23 15:20</td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn-action" onclick="editRule('rule9')" title="编辑">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                            </svg>
                                        </button>
                                        <button class="btn-action" onclick="copyRule('rule9')" title="复制">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                            </svg>
                                        </button>
                                        <button class="btn-action" onclick="deleteRule('rule9')" title="删除">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M3 6h18"></path>
                                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"></path>
                                                <path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                                <line x1="10" y1="11" x2="10" y2="17"></line>
                                                <line x1="14" y1="11" x2="14" y2="17"></line>
                                            </svg>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            <tr data-device-type="ems">
                                <td>能量调度策略异常</td>
                                <td>策略执行失败次数 > 3</td>
                                <td><span class="severity-badge severity-minor">次要</span></td>
                                <td>
                                    <label class="table-switch">
                                        <input type="checkbox" checked onchange="toggleRuleStatus(this, 'rule10')">
                                        <span class="switch-slider"></span>
                                    </label>
                                </td>
                                <td>5</td>
                                <td>1</td>
                                <td>2024-01-24 09:30</td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn-action" onclick="editRule('rule10')" title="编辑">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                            </svg>
                                        </button>
                                        <button class="btn-action" onclick="copyRule('rule10')" title="复制">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                            </svg>
                                        </button>
                                        <button class="btn-action" onclick="deleteRule('rule10')" title="删除">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M3 6h18"></path>
                                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"></path>
                                                <path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                                <line x1="10" y1="11" x2="10" y2="17"></line>
                                                <line x1="14" y1="11" x2="14" y2="17"></line>
                                            </svg>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 规则编辑弹窗 -->
    <div class="modal" id="ruleModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">新建告警规则</h3>
                <button class="modal-close" onclick="closeModal()">×</button>
            </div>
            <div class="modal-body">
                <!-- Tab导航 -->
                <div class="modal-tabs">
                    <button class="modal-tab active" onclick="switchModalTab('basic')">基础信息</button>
                    <button class="modal-tab" onclick="switchModalTab('scope')">应用范围</button>
                    <button class="modal-tab" onclick="switchModalTab('notification')">通知方式</button>
                </div>
                
                <form id="ruleForm">
                    <!-- 基础信息标签页 -->
                    <div class="modal-tab-content active" id="basicTab">
                        <div class="form-section">
                            <h4>基本信息</h4>
                        <div class="form-group">
                            <label>规则名称 <span style="color: #ef4444;">*</span></label>
                            <input type="text" class="form-input" id="ruleName" placeholder="请输入规则名称">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>设备类型 <span style="color: #ef4444;">*</span></label>
                                <select class="form-input" id="deviceType">
                                    <option value="">请选择设备类型</option>
                                    <option value="battery">储能电池</option>
                                    <option value="pcs">PCS变流器</option>
                                    <option value="bms">BMS系统</option>
                                    <option value="ems">EMS系统</option>
                                    <option value="hvac">温控系统</option>
                                    <option value="fire">消防系统</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>严重程度 <span style="color: #ef4444;">*</span></label>
                                <select class="form-input" id="severity">
                                    <option value="">请选择严重程度</option>
                                    <option value="critical">严重</option>
                                    <option value="major">重要</option>
                                    <option value="minor">次要</option>
                                    <option value="warning">警告</option>
                                </select>
                            </div>
                        </div>
                        </div>
                        
                        <!-- 触发条件 -->
                        <div class="form-section">
                            <h4>触发条件</h4>
                            <div id="conditionsList">
                                <div class="condition-item">
                                    <div class="condition-row">
                                        <select class="condition-select" id="parameter1">
                                            <option value="">监控参数</option>
                                            <option value="temperature">温度</option>
                                            <option value="current">电流</option>
                                            <option value="voltage">电压</option>
                                            <option value="soc">SOC</option>
                                            <option value="power">功率</option>
                                            <option value="communication">通信状态</option>
                                            <option value="smoke">烟雾浓度</option>
                                        </select>
                                        <select class="condition-select" id="condition1">
                                            <option value="">判断条件</option>
                                            <option value="greater">大于</option>
                                            <option value="less">小于</option>
                                            <option value="equal">等于</option>
                                            <option value="notEqual">不等于</option>
                                            <option value="between">区间内</option>
                                            <option value="notBetween">区间外</option>
                                        </select>
                                        <input type="text" class="condition-input" id="threshold1" placeholder="阈值">
                                        <button type="button" class="btn-remove-condition" onclick="removeCondition(this)" style="display: none;">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                                                <line x1="18" y1="6" x2="6" y2="18"></line>
                                                <line x1="6" y1="6" x2="18" y2="18"></line>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <button type="button" class="btn-add-condition" onclick="addCondition()">
                                <span>+</span> 添加条件
                            </button>
                        </div>
                    </div>
                    
                    <!-- 应用范围标签页 -->
                    <div class="modal-tab-content" id="scopeTab">
                        <div class="form-section">
                            <h4>监测范围</h4>
                        <div class="form-group">
                            <label>选择电站 <span style="color: #ef4444;">*</span></label>
                            <div class="station-select-grid">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="allStations" onchange="toggleAllStations(this.checked)">
                                    <label for="allStations">全部电站</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="station1" class="station-checkbox">
                                    <label for="station1">上海工业园储能站</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="station2" class="station-checkbox">
                                    <label for="station2">北京科技园储能站</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="station3" class="station-checkbox">
                                    <label for="station3">深圳产业园储能站</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="station4" class="station-checkbox">
                                    <label for="station4">广州智慧园储能站</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="station5" class="station-checkbox">
                                    <label for="station5">杭州科创园储能站</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>设备选择</label>
                            <select class="form-input" id="deviceScope">
                                <option value="all">该类型全部设备</option>
                                <option value="specific">指定设备</option>
                            </select>
                        </div>
                        </div>
                    </div>
                    
                    <!-- 通知方式标签页 -->
                    <div class="modal-tab-content" id="notificationTab">
                        <div class="form-section">
                            <h4>通知设置</h4>
                        <div class="form-group">
                            <label>通知方式</label>
                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="notifySystem" checked>
                                    <label for="notifySystem">系统通知</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="notifySMS">
                                    <label for="notifySMS">短信通知</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="notifyEmail">
                                    <label for="notifyEmail">邮件通知</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="notifyApp">
                                    <label for="notifyApp">APP推送</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>通知人员</label>
                            <input type="text" class="form-input" id="notifyUsers" placeholder="请输入通知人员，多个用逗号分隔">
                        </div>
                        <div class="form-group">
                            <label>启用状态</label>
                            <div class="switch-wrapper">
                                <label class="switch">
                                    <input type="checkbox" id="ruleStatus" checked>
                                    <span class="switch-slider"></span>
                                </label>
                                <span class="switch-label" id="statusLabel">立即启用</span>
                            </div>
                        </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" onclick="closeModal()">取消</button>
                <button class="btn-save" onclick="saveRule()">保存</button>
            </div>
        </div>
    </div>
    
    <!-- Toast提示 -->
    <div class="toast" id="toast">
        <span id="toastMessage"></span>
    </div>
    
    <!-- 删除确认弹窗 -->
    <div class="confirm-modal" id="deleteModal">
        <div class="confirm-content">
            <div class="confirm-icon">⚠️</div>
            <h3 class="confirm-title">确认删除</h3>
            <p class="confirm-message">确定要删除该告警规则吗？删除后无法恢复。</p>
            <div class="confirm-buttons">
                <button class="btn btn-secondary" onclick="closeDeleteModal()">取消</button>
                <button class="btn btn-primary" style="background: #dc2626; border-color: #dc2626;" onclick="confirmDelete()">确定删除</button>
            </div>
        </div>
    </div>

    <script>
        // 页面初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化设备类型选项卡，默认显示储能电池
            filterByDeviceType('battery');
            
            // 初始化开关监听
            const ruleStatusSwitch = document.getElementById('ruleStatus');
            const statusLabel = document.getElementById('statusLabel');
            
            if (ruleStatusSwitch) {
                ruleStatusSwitch.addEventListener('change', function() {
                    statusLabel.textContent = this.checked ? '立即启用' : '暂不启用';
                });
            }
        });

        // 创建新规则
        function createRule() {
            document.getElementById('modalTitle').textContent = '新建告警规则';
            document.getElementById('ruleForm').reset();
            openModal();
        }

        // 编辑规则
        function editRule(ruleId) {
            document.getElementById('modalTitle').textContent = '编辑告警规则';
            // TODO: 加载规则数据
            openModal();
        }

        // 复制规则
        function copyRule(ruleId) {
            const originalRow = event.target.closest('tr');
            const newRow = originalRow.cloneNode(true);
            
            // 修改规则名称，添加"副本"后缀
            const ruleName = newRow.cells[0].textContent;
            newRow.cells[0].textContent = ruleName + ' - 副本';
            
            // 重置一些数据
            newRow.cells[5].textContent = '0'; // 触发次数
            newRow.cells[6].textContent = '-'; // 最后触发
            
            // 插入到当前行的下方
            originalRow.parentNode.insertBefore(newRow, originalRow.nextSibling);
            
            showToast('规则已复制');
            updateCounts();
        }

        // 切换规则状态
        function toggleRule(ruleId) {
            const button = event.target;
            const isActive = button.textContent === '禁用';
            const row = button.closest('tr');
            const statusBadge = row.querySelector('.status-badge');
            
            if (isActive) {
                button.textContent = '启用';
                statusBadge.className = 'status-badge inactive';
                statusBadge.textContent = '禁用';
            } else {
                button.textContent = '禁用';
                statusBadge.className = 'status-badge active';
                statusBadge.textContent = '启用';
            }
            
            showToast('规则状态已更新');
        }

        // 删除规则
        let deleteTargetRow = null;
        
        function deleteRule(ruleId) {
            deleteTargetRow = event.target.closest('tr');
            document.getElementById('deleteModal').style.display = 'flex';
        }
        
        // 确认删除
        function confirmDelete() {
            if (deleteTargetRow) {
                deleteTargetRow.remove();
                deleteTargetRow = null;
                showToast('规则已删除');
                updateCounts();
            }
            closeDeleteModal();
        }
        
        // 关闭删除确认弹窗
        function closeDeleteModal() {
            document.getElementById('deleteModal').style.display = 'none';
            deleteTargetRow = null;
        }

        // 导入规则
        function importRules() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json,.csv';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    showToast(`正在导入文件: ${file.name}`);
                }
            };
            input.click();
        }
        
        // 保存规则
        function saveRule() {
            const ruleName = document.getElementById('ruleName').value;
            if (!ruleName) {
                showToast('请填写规则名称');
                return;
            }
            
            showToast('规则保存成功');
            closeModal();
        }
        
        // 打开弹窗
        function openModal() {
            document.getElementById('ruleModal').style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }
        
        // 关闭弹窗
        function closeModal() {
            document.getElementById('ruleModal').style.display = 'none';
            document.body.style.overflow = '';
        }
        
        // 按设备类型筛选
        function filterByDeviceType(type, event) {
            // 更新选中状态
            document.querySelectorAll('.device-type-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // 如果有event参数，使用它；否则尝试获取当前点击的标签
            if (event && event.target) {
                const clickedTab = event.target.closest('.device-type-tab');
                if (clickedTab) {
                    clickedTab.classList.add('active');
                }
            } else {
                // 如果没有event，根据type找到对应的标签
                const targetTab = document.querySelector(`.device-type-tab[onclick*="${type}"]`);
                if (targetTab) {
                    targetTab.classList.add('active');
                }
            }
            
            // 过滤表格行
            const rows = document.querySelectorAll('.rules-table tbody tr');
            rows.forEach(row => {
                if (type === 'all' || row.dataset.deviceType === type || row.dataset.deviceType === 'all') {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }
        
        // 按严重程度筛选
        function filterBySeverity(severity) {
            // TODO: 实现筛选逻辑
            console.log('Filter by severity:', severity);
        }
        
        // 按状态筛选
        function filterByStatus(status) {
            // TODO: 实现筛选逻辑
            console.log('Filter by status:', status);
        }
        
        // 按电站筛选
        function filterByStation(station) {
            // TODO: 实现筛选逻辑
            console.log('Filter by station:', station);
        }
        
        // 全选/取消全选电站
        function toggleAllStations(checked) {
            document.querySelectorAll('.station-checkbox').forEach(checkbox => {
                checkbox.checked = checked;
            });
        }
        
        // 更新统计数量
        function updateCounts() {
            const totalRules = document.querySelectorAll('.rules-table tbody tr').length;
            const activeRules = document.querySelectorAll('.status-badge.active').length;
            const inactiveRules = document.querySelectorAll('.status-badge.inactive').length;
            
            document.querySelector('.stat-card:nth-child(1) .stat-number').textContent = totalRules;
            document.querySelector('.stat-card:nth-child(2) .stat-number').textContent = activeRules;
            document.querySelector('.stat-card:nth-child(3) .stat-number').textContent = inactiveRules;
        }
        
        // Toast提示
        function showToast(message, duration = 3000) {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            toastMessage.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, duration);
        }
        
        // 查询规则
        function searchRules() {
            const severityFilter = document.getElementById('severityFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;
            const stationFilter = document.getElementById('stationFilter').value;
            
            const rows = document.querySelectorAll('.rules-table tbody tr');
            
            rows.forEach(row => {
                let show = true;
                
                // 先获取当前行的设备类型
                const deviceType = row.dataset.deviceType;
                const activeTab = document.querySelector('.device-type-tab.active');
                const activeType = activeTab ? activeTab.onclick.toString().match(/filterByDeviceType\('(\w+)'/)[1] : 'all';
                
                // 如果不符合当前选中的设备类型，隐藏
                if (activeType !== 'all' && deviceType !== activeType && deviceType !== 'all') {
                    show = false;
                }
                
                // 严重程度筛选
                if (severityFilter && show) {
                    const severityBadge = row.querySelector('.severity-badge');
                    const rowSeverity = severityBadge ? severityBadge.className.split('-').pop() : '';
                    if (rowSeverity !== severityFilter) show = false;
                }
                
                // 状态筛选
                if (statusFilter && show) {
                    const statusBadge = row.querySelector('.status-badge');
                    const isActive = statusBadge && statusBadge.classList.contains('active');
                    if ((statusFilter === 'active' && !isActive) || (statusFilter === 'inactive' && isActive)) {
                        show = false;
                    }
                }
                
                // 电站筛选 - 这里简化处理，实际应该根据规则的电站关联来筛选
                if (stationFilter && show) {
                    // TODO: 实际项目中应该根据规则关联的电站来筛选
                }
                
                row.style.display = show ? '' : 'none';
            });
            
            showToast('查询完成');
        }
        
        // 重置筛选条件
        function resetFilters() {
            document.getElementById('severityFilter').value = '';
            document.getElementById('statusFilter').value = '';
            document.getElementById('stationFilter').value = '';
            
            // 重新应用设备类型筛选
            const activeTab = document.querySelector('.device-type-tab.active');
            if (activeTab) {
                const type = activeTab.onclick.toString().match(/filterByDeviceType\('(\w+)'/)[1];
                filterByDeviceType(type);
            }
            
            showToast('筛选条件已重置');
        }
        
        // 切换模态框标签页
        function switchModalTab(tabName) {
            // 切换标签按钮状态
            document.querySelectorAll('.modal-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // 切换内容显示
            document.querySelectorAll('.modal-tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabName + 'Tab').classList.add('active');
        }
        
        // 条件计数器
        let conditionCount = 1;
        
        // 添加条件
        function addCondition() {
            conditionCount++;
            const conditionsList = document.getElementById('conditionsList');
            const newCondition = document.createElement('div');
            newCondition.className = 'condition-item';
            newCondition.innerHTML = `
                <div class="condition-row">
                    <select class="condition-select" id="parameter${conditionCount}">
                        <option value="">监控参数</option>
                        <option value="temperature">温度</option>
                        <option value="current">电流</option>
                        <option value="voltage">电压</option>
                        <option value="soc">SOC</option>
                        <option value="power">功率</option>
                        <option value="communication">通信状态</option>
                        <option value="smoke">烟雾浓度</option>
                    </select>
                    <select class="condition-select" id="condition${conditionCount}">
                        <option value="">判断条件</option>
                        <option value="greater">大于</option>
                        <option value="less">小于</option>
                        <option value="equal">等于</option>
                        <option value="notEqual">不等于</option>
                        <option value="between">区间内</option>
                        <option value="notBetween">区间外</option>
                    </select>
                    <input type="text" class="condition-input" id="threshold${conditionCount}" placeholder="阈值">
                    <button type="button" class="btn-remove-condition" onclick="removeCondition(this)">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                </div>
            `;
            conditionsList.appendChild(newCondition);
            
            // 显示第一个条件的删除按钮
            const firstRemoveBtn = document.querySelector('.btn-remove-condition');
            if (firstRemoveBtn && conditionCount > 1) {
                firstRemoveBtn.style.display = 'flex';
            }
        }
        
        // 删除条件
        function removeCondition(button) {
            const conditionItem = button.closest('.condition-item');
            conditionItem.remove();
            
            // 如果只剩一个条件，隐藏删除按钮
            const conditions = document.querySelectorAll('.condition-item');
            if (conditions.length === 1) {
                const lastRemoveBtn = conditions[0].querySelector('.btn-remove-condition');
                if (lastRemoveBtn) {
                    lastRemoveBtn.style.display = 'none';
                }
            }
        }
        
        // 切换规则状态（表格中的开关）
        function toggleRuleStatus(switchElement, ruleId) {
            const isChecked = switchElement.checked;
            showToast(isChecked ? '规则已启用' : '规则已禁用');
        }
        
    </script>

    <!-- 引入侧边栏脚本 -->
    <script src="../sidebar.js"></script>
    <script src="../navbar.js"></script>

    <style>
        /* 移动端菜单按钮样式 */
        @media (max-width: 768px) {
            .menu-toggle {
                display: block !important;
            }
        }
    
        /* 顶部导航栏 */
        .navbar {
            background: white;
            border-bottom: 1px solid #e2e8f0;
            padding: 0 2rem;
            height: 64px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 50;
        }

        .navbar-left {
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .page-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1e293b;
        }

        .navbar-right {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .nav-button {
            padding: 0.5rem 1rem;
            border: 1px solid #e2e8f0;
            background: white;
            border-radius: 0.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            color: #64748b;
            transition: all 150ms ease;
        }

        .nav-button:hover {
            background: #f8fafc;
            border-color: #cbd5e1;
            color: #1e293b;
        }
    </style>
</body>
</html>