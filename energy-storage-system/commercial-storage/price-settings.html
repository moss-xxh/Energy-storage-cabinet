<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>电价模板 - 能源管理系统</title>
    <link rel="stylesheet" href="./sidebar.css">
    <link rel="stylesheet" href="./navbar.css">
    <link rel="stylesheet" href="./responsive.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #EBEDF5;
            color: #1e293b;
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* 主内容区域 */
        .main-content {
            margin-left: 240px;
            min-height: 100vh;
            background: #EBEDF5;
        }

        /* 内容区域 */
        .content {
            padding: 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* 页面标题 */
        .page-header {
            margin-bottom: 2rem;
        }

        .page-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1e293b;
            margin: 0;
            white-space: nowrap;
        }

        .page-subtitle {
            font-size: 0.875rem;
            color: #64748b;
        }

        /* 顶部导航栏 */
        .navbar {
            background: white;
            border-bottom: 1px solid #e2e8f0;
            padding: 0 2rem;
            min-height: 64px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 50;
        }

        .navbar-left {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        /* 公司选择下拉列表 */
        .company-select {
            padding: 0.5rem 1rem;
            padding-right: 2.5rem;
            border: 1px solid #e2e8f0;
            background: white;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            color: #1e293b;
            cursor: pointer;
            min-width: 250px;
            transition: all 150ms ease;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
        }

        .company-select:hover {
            background-color: #f8fafc;
            border-color: #cbd5e1;
        }

        .company-select:focus {
            outline: none;
            border-color: #3562E3;
            box-shadow: 0 0 0 3px rgba(53, 98, 227, 0.1);
        }

        .company-select option {
            padding: 0.5rem;
            color: #1e293b;
        }

        .navbar-right {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .nav-button {
            padding: 0.5rem 1rem;
            border: 1px solid #e2e8f0;
            background: white;
            border-radius: 0.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            color: #64748b;
            transition: all 150ms ease;
        }

        .nav-button:hover {
            background: #f8fafc;
            border-color: #cbd5e1;
            color: #1e293b;
        }


        /* 电价卡片网格 */
        .price-cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        /* 电价卡片 */
        .price-card-item {
            background: white;
            border-radius: 0.75rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
            position: relative;
        }

        .price-card-item:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transform: translateY(-2px);
        }

        .price-card-item.selected {
            border-color: #3562E3;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1e293b;
        }

        .card-status {
            padding: 0.25rem 0.75rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .status-completed {
            background: #d1fae5;
            color: #059669;
        }

        .status-configuring {
            background: #fef3c7;
            color: #d97706;
        }

        .card-info {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .info-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            color: #64748b;
        }

        .card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 1rem;
            border-top: 1px solid #e2e8f0;
        }

        .card-date {
            font-size: 0.75rem;
            color: #94a3b8;
        }

        .card-actions {
            display: flex;
            gap: 0.5rem;
        }

        .card-btn {
            padding: 0.375rem 0.75rem;
            font-size: 0.75rem;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
        }

        .card-btn-edit {
            background: #e0f2fe;
            color: #0369a1;
        }

        .card-btn-edit:hover {
            background: #7dd3fc;
        }

        .card-btn-delete {
            background: #fee2e2;
            color: #dc2626;
        }

        .card-btn-delete:hover {
            background: #fca5a5;
        }

        /* 添加卡片样式 */
        .add-card {
            background: #f8fafc;
            border: 2px dashed #cbd5e1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            min-height: 200px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .add-card:hover {
            border-color: #3562E3;
            background: #eff6ff;
        }

        .add-icon {
            width: 48px;
            height: 48px;
            background: #3562E3;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .add-text {
            color: #64748b;
            font-weight: 500;
        }

        /* 模态框样式 */
        .modal-backdrop {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 9999;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 0.75rem;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1e293b;
        }

        .modal-close {
            width: 32px;
            height: 32px;
            border: none;
            background: transparent;
            cursor: pointer;
            font-size: 24px;
            color: #64748b;
            transition: color 0.2s;
        }

        .modal-close:hover {
            color: #1e293b;
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-footer {
            padding: 1.5rem;
            border-top: 1px solid #e2e8f0;
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }

        /* 表单样式 */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: #374151;
            margin-bottom: 0.5rem;
        }

        .form-input,
        .form-select {
            width: 100%;
            padding: 0.5rem 1rem;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            transition: all 0.2s;
        }

        .form-input:focus,
        .form-select:focus {
            outline: none;
            border-color: #3562E3;
            box-shadow: 0 0 0 3px rgba(53, 98, 227, 0.1);
        }

        .form-radio-group {
            display: flex;
            gap: 1rem;
        }

        .form-radio-label {
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .form-radio-label input[type="radio"] {
            margin-right: 0.5rem;
        }

        /* 时间段配置 */
        .time-slots-container {
            background: #f8fafc;
            padding: 1rem;
            border-radius: 0.5rem;
        }

        .time-slot-header {
            display: grid;
            grid-template-columns: 2fr 2fr 1.5fr 1fr auto;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            font-size: 0.75rem;
            color: #64748b;
        }

        .time-slot-item {
            display: grid;
            grid-template-columns: 2fr 2fr 1.5fr 1fr auto;
            gap: 0.5rem;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .time-slot-item input {
            padding: 0.375rem;
            border: 1px solid #e2e8f0;
            border-radius: 0.375rem;
            font-size: 0.875rem;
        }

        .time-slot-item select {
            padding: 0.375rem;
            border: 1px solid #e2e8f0;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            background: white;
        }

        .btn-remove {
            padding: 0.25rem 0.5rem;
            background: #fee2e2;
            color: #dc2626;
            border: none;
            border-radius: 0.375rem;
            cursor: pointer;
            font-size: 0.75rem;
        }

        .btn-remove:hover {
            background: #fca5a5;
        }

        .btn-add-slot {
            margin-top: 0.5rem;
            padding: 0.375rem 0.75rem;
            background: #e0f2fe;
            color: #0369a1;
            border: none;
            border-radius: 0.375rem;
            cursor: pointer;
            font-size: 0.875rem;
        }

        .btn-add-slot:hover {
            background: #7dd3fc;
        }

        /* 按钮样式 */
        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #3562E3;
            color: white;
        }

        .btn-primary:hover {
            background: #2850C5;
        }

        .btn-secondary {
            background: white;
            border: 1px solid #e2e8f0;
            color: #64748b;
        }

        .btn-secondary:hover {
            background: #f8fafc;
            border-color: #cbd5e1;
        }

        /* 表单分组样式 */
        .form-section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: #f8fafc;
            border-radius: 0.5rem;
        }

        .section-title {
            font-size: 1rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 1rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        /* 配置标签页样式 */
        .price-config-tabs {
            display: flex;
            gap: 0;
            margin-bottom: 1.5rem;
            border-bottom: 2px solid #e2e8f0;
        }

        .config-tab-btn {
            padding: 0.75rem 1.5rem;
            border: none;
            background: none;
            cursor: pointer;
            color: #64748b;
            font-weight: 500;
            font-size: 0.9rem;
            transition: all 150ms ease;
            border-bottom: 2px solid transparent;
            margin-bottom: -2px;
        }

        .config-tab-btn:hover {
            color: #1e293b;
        }

        .config-tab-btn.active {
            color: #3562E3;
            border-bottom-color: #3562E3;
        }

        .config-tab-content {
            display: none;
        }

        .config-tab-content.active {
            display: block;
        }

        /* 价格表格样式 */
        .time-price-table {
            background: white;
            border-radius: 0.5rem;
            padding: 1rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .price-table {
            width: 100%;
            border-collapse: collapse;
        }

        .price-table th {
            background: #f8fafc;
            padding: 0.75rem;
            text-align: left;
            font-weight: 600;
            font-size: 0.875rem;
            color: #475569;
            border-bottom: 2px solid #e2e8f0;
        }

        .price-table td {
            padding: 0.5rem;
            border-bottom: 1px solid #e2e8f0;
        }

        .price-table input,
        .price-table select {
            width: 100%;
            padding: 0.375rem;
            border: 1px solid #e2e8f0;
            border-radius: 0.375rem;
            font-size: 0.875rem;
        }

        .price-type-section {
            margin-top: 1rem;
        }


        /* 响应式设计 */
        @media (max-width: 768px) {
            .main-content {
                margin-left: 0;
            }

            .content {
                padding: 1rem;
            }

            .price-cards-grid {
                grid-template-columns: 1fr;
            }

            .navbar {
                padding: 0 1rem;
            }

            .navbar-left {
                gap: 0.75rem;
            }

            .page-title {
                font-size: 1.125rem;
            }

            .company-select {
                min-width: 150px;
                font-size: 0.75rem;
                padding: 0.375rem 0.75rem;
            }

            .time-slot-header,
            .time-slot-item {
                font-size: 0.75rem;
            }
        }
    </style>
</head>
<body>
    <!-- 侧边栏容器 -->
    <div id="sidebar-container"></div>

    <!-- 主内容区域 -->
    <main class="main-content">
        <!-- 顶部导航栏 -->
        <nav class="navbar">
            <div class="navbar-left">
                <button class="nav-button" onclick="toggleSidebar()">
                    <span>☰</span>
                </button>
                <h1 class="page-title">电价模板</h1>
                <!-- 公司选择 -->
                <div style="position: relative;">
                    <select class="company-select" onchange="switchCompany(this.value)">
                        <option value="company1">上海新能源科技有限公司</option>
                        <option value="company2">北京储能技术有限公司</option>
                        <option value="company3">深圳光伏储能有限公司</option>
                        <option value="company4">广州能源管理有限公司</option>
                    </select>
                </div>
            </div>
            <div class="navbar-right">
                <button class="nav-button" onclick="toggleLanguage()">
                    <span>🌐</span>
                    <span id="lang-text">中文</span>
                </button>
                <button class="nav-button" onclick="toggleTheme()">
                    <span id="theme-icon">🌙</span>
                </button>
                <button class="nav-button">
                    <span>👤</span>
                    <span>管理员</span>
                </button>
            </div>
        </nav>

        <!-- 内容区域 -->
        <div class="content">

            <!-- 电价卡片内容 -->
            <div class="price-cards-grid">
                    <!-- 已配置的卡片 -->
                    <div class="price-card-item" onclick="selectCard(this, 'feed-1')">
                        <div class="card-header">
                            <h3 class="card-title">上海工业园储能站</h3>
                            <span class="card-status status-completed">配置完成</span>
                        </div>
                        <div class="card-info">
                            <div class="info-item">
                                <span>📍</span>
                                <span>电站位置：上海市浦东新区</span>
                            </div>
                            <div class="info-item">
                                <span>💰</span>
                                <span>峰时电价：0.85元/kWh</span>
                            </div>
                            <div class="info-item">
                                <span>📅</span>
                                <span>电价类型：分时电价</span>
                            </div>
                            <div class="info-item">
                                <span>⏰</span>
                                <span>有效期：永久生效</span>
                            </div>
                        </div>
                        <div class="card-footer">
                            <span class="card-date">更新于 2025-07-20</span>
                            <div class="card-actions">
                                <button class="card-btn card-btn-edit" onclick="editCard(event, 'feed-1')">编辑</button>
                                <button class="card-btn card-btn-delete" onclick="deleteCard(event, 'feed-1')">删除</button>
                            </div>
                        </div>
                    </div>

                    <!-- 配置中的卡片 -->
                    <div class="price-card-item" onclick="selectCard(this, 'feed-2')">
                        <div class="card-header">
                            <h3 class="card-title">北京科技园储能站</h3>
                            <span class="card-status status-configuring">配置中</span>
                        </div>
                        <div class="card-info">
                            <div class="info-item">
                                <span>📍</span>
                                <span>电站位置：北京市海淀区</span>
                            </div>
                            <div class="info-item">
                                <span>💰</span>
                                <span>固定电价：--</span>
                            </div>
                            <div class="info-item">
                                <span>📅</span>
                                <span>电价类型：固定电价</span>
                            </div>
                            <div class="info-item">
                                <span>⏰</span>
                                <span>有效期：--</span>
                            </div>
                        </div>
                        <div class="card-footer">
                            <span class="card-date">创建于 2025-07-25</span>
                            <div class="card-actions">
                                <button class="card-btn card-btn-edit" onclick="editCard(event, 'feed-2')">继续配置</button>
                                <button class="card-btn card-btn-delete" onclick="deleteCard(event, 'feed-2')">删除</button>
                            </div>
                        </div>
                    </div>

                    <!-- 已配置的卡片 -->
                    <div class="price-card-item" onclick="selectCard(this, 'purchase-1')">
                        <div class="card-header">
                            <h3 class="card-title">深圳光伏储能站</h3>
                            <span class="card-status status-completed">配置完成</span>
                        </div>
                        <div class="card-info">
                            <div class="info-item">
                                <span>📍</span>
                                <span>电站位置：深圳市南山区</span>
                            </div>
                            <div class="info-item">
                                <span>💰</span>
                                <span>峰时电价：1.35元/kWh</span>
                            </div>
                            <div class="info-item">
                                <span>📅</span>
                                <span>电价类型：分时电价</span>
                            </div>
                            <div class="info-item">
                                <span>⏰</span>
                                <span>有效期：2025-12-31</span>
                            </div>
                        </div>
                        <div class="card-footer">
                            <span class="card-date">更新于 2025-07-15</span>
                            <div class="card-actions">
                                <button class="card-btn card-btn-edit" onclick="editCard(event, 'purchase-1')">编辑</button>
                                <button class="card-btn card-btn-delete" onclick="deleteCard(event, 'purchase-1')">删除</button>
                            </div>
                        </div>
                    </div>

                    <!-- 添加新卡片 -->
                    <div class="price-card-item add-card" onclick="addNewCard()">
                        <div class="add-icon">+</div>
                        <span class="add-text">添加新电价模板</span>
                    </div>
            </div>
        </div>
    </main>

    <!-- 配置模态框 -->
    <div id="configModal" class="modal-backdrop">
        <div class="modal-content" style="max-width: 1000px;">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">新建电价模板</h2>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <form id="priceForm">
                <div class="modal-body">
                    <!-- 基本信息 -->
                    <div class="form-section">
                        <h3 class="section-title">基本信息</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">模板名称</label>
                                <input type="text" class="form-input" id="templateName" placeholder="请输入模板名称">
                            </div>
                            <div class="form-group">
                                <label class="form-label">关联电站</label>
                                <select class="form-select" id="stationSelect">
                                    <option value="">请选择电站</option>
                                    <option value="sh">上海工业园储能站</option>
                                    <option value="bj">北京科技园储能站</option>
                                    <option value="sz">深圳光伏储能站</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- 电价设置标签页 -->
                    <div class="price-config-tabs">
                        <button type="button" class="config-tab-btn active" onclick="switchConfigTab('feedin')">上网电价</button>
                        <button type="button" class="config-tab-btn" onclick="switchConfigTab('usage')">用电价</button>
                    </div>

                    <!-- 上网电价配置 -->
                    <div id="feedin-config" class="config-tab-content active">
                        <div class="form-section">
                            <div class="form-group">
                                <label class="form-label">电价类型</label>
                                <div class="form-radio-group">
                                    <label class="form-radio-label">
                                        <input type="radio" name="feedinPriceType" value="fixed" checked onchange="toggleFeedinPriceType()">
                                        固定电价
                                    </label>
                                    <label class="form-radio-label">
                                        <input type="radio" name="feedinPriceType" value="time" onchange="toggleFeedinPriceType()">
                                        分时电价
                                    </label>
                                </div>
                            </div>
                            
                            <div id="feedinFixedSection" class="price-type-section">
                                <div class="form-group">
                                    <label class="form-label">固定上网电价（元/kWh）</label>
                                    <input type="number" class="form-input" id="feedinFixedPrice" step="0.01" placeholder="请输入上网电价">
                                </div>
                            </div>
                            
                            <div id="feedinTimeSection" class="price-type-section" style="display: none;">
                                <label class="form-label">分时电价配置</label>
                                <div class="time-price-table">
                                    <table class="price-table">
                                        <thead>
                                            <tr>
                                                <th>时间段</th>
                                                <th>开始时间</th>
                                                <th>结束时间</th>
                                                <th>电价类型</th>
                                                <th>电价(元/kWh)</th>
                                                <th>操作</th>
                                            </tr>
                                        </thead>
                                        <tbody id="feedinTimeSlots">
                                            <tr>
                                                <td>时段1</td>
                                                <td><input type="time" value="00:00"></td>
                                                <td><input type="time" value="08:00"></td>
                                                <td>
                                                    <select>
                                                        <option value="valley">谷时</option>
                                                        <option value="normal">平时</option>
                                                        <option value="peak">峰时</option>
                                                    </select>
                                                </td>
                                                <td><input type="number" step="0.01" placeholder="电价"></td>
                                                <td><button type="button" class="btn-remove" onclick="removeRow(this)">删除</button></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <button type="button" class="btn-add-slot" onclick="addFeedinTimeSlot()">+ 添加时段</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 用电价配置 -->
                    <div id="usage-config" class="config-tab-content">
                        <div class="form-section">
                            <div class="form-group">
                                <label class="form-label">电价类型</label>
                                <div class="form-radio-group">
                                    <label class="form-radio-label">
                                        <input type="radio" name="usagePriceType" value="fixed" checked onchange="toggleUsagePriceType()">
                                        固定电价
                                    </label>
                                    <label class="form-radio-label">
                                        <input type="radio" name="usagePriceType" value="time" onchange="toggleUsagePriceType()">
                                        分时电价
                                    </label>
                                    <label class="form-radio-label">
                                        <input type="radio" name="usagePriceType" value="tiered" onchange="toggleUsagePriceType()">
                                        阶梯电价
                                    </label>
                                </div>
                            </div>
                            
                            <div id="usageFixedSection" class="price-type-section">
                                <div class="form-group">
                                    <label class="form-label">固定用电价（元/kWh）</label>
                                    <input type="number" class="form-input" id="usageFixedPrice" step="0.01" placeholder="请输入用电价">
                                </div>
                            </div>
                            
                            <div id="usageTimeSection" class="price-type-section" style="display: none;">
                                <label class="form-label">分时电价配置</label>
                                <div class="time-price-table">
                                    <table class="price-table">
                                        <thead>
                                            <tr>
                                                <th>时间段</th>
                                                <th>开始时间</th>
                                                <th>结束时间</th>
                                                <th>电价类型</th>
                                                <th>电价(元/kWh)</th>
                                                <th>操作</th>
                                            </tr>
                                        </thead>
                                        <tbody id="usageTimeSlots">
                                            <tr>
                                                <td>时段1</td>
                                                <td><input type="time" value="00:00"></td>
                                                <td><input type="time" value="08:00"></td>
                                                <td>
                                                    <select>
                                                        <option value="valley">谷时</option>
                                                        <option value="normal">平时</option>
                                                        <option value="peak">峰时</option>
                                                    </select>
                                                </td>
                                                <td><input type="number" step="0.01" placeholder="电价"></td>
                                                <td><button type="button" class="btn-remove" onclick="removeRow(this)">删除</button></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <button type="button" class="btn-add-slot" onclick="addUsageTimeSlot()">+ 添加时段</button>
                                </div>
                            </div>
                            
                            <div id="usageTieredSection" class="price-type-section" style="display: none;">
                                <label class="form-label">阶梯电价配置</label>
                                <div class="time-price-table">
                                    <table class="price-table">
                                        <thead>
                                            <tr>
                                                <th>阶梯等级</th>
                                                <th>起始电量(kWh)</th>
                                                <th>结束电量(kWh)</th>
                                                <th>电价(元/kWh)</th>
                                                <th>操作</th>
                                            </tr>
                                        </thead>
                                        <tbody id="usageTierSlots">
                                            <tr>
                                                <td>第一阶梯</td>
                                                <td><input type="number" value="0" readonly></td>
                                                <td><input type="number" placeholder="如：200"></td>
                                                <td><input type="number" step="0.01" placeholder="电价"></td>
                                                <td><button type="button" class="btn-remove" onclick="removeRow(this)">删除</button></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <button type="button" class="btn-add-slot" onclick="addUsageTierSlot()">+ 添加阶梯</button>
                                </div>
                            </div>

                            <!-- 基本电费 -->
                            <div class="form-group" style="margin-top: 2rem;">
                                <label class="form-label">基本电费设置（可选）</label>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">计费方式</label>
                                        <select class="form-select" id="basicFeeType">
                                            <option value="">不收取基本电费</option>
                                            <option value="capacity">按容量计费</option>
                                            <option value="demand">按需量计费</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">基本电价</label>
                                        <input type="number" class="form-input" id="basicFeePrice" step="0.01" placeholder="元/kVA·月 或 元/kW·月">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 有效期设置 -->
                    <div class="form-section" style="margin-top: 2rem;">
                        <h3 class="section-title">有效期设置</h3>
                        <div class="form-group">
                            <label class="form-radio-label">
                                <input type="checkbox" id="permanentCheck" checked onchange="toggleValidity()">
                                永久生效
                            </label>
                            <div id="validityDates" style="display: none; margin-top: 1rem;">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">开始日期</label>
                                        <input type="date" class="form-input" id="startDate">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">结束日期</label>
                                        <input type="date" class="form-input" id="endDate">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">取消</button>
                    <button type="button" class="btn btn-primary" onclick="saveConfig()">保存</button>
                </div>
            </form>
        </div>
    </div>


    <script>
        // 当前选中的卡片
        let selectedCard = null;
        let editingCardId = null;

        // 选择卡片
        function selectCard(element, cardId) {
            // 如果点击的是按钮，不处理选择
            if (event.target.classList.contains('card-btn')) {
                return;
            }
            
            // 移除之前的选中状态
            document.querySelectorAll('.price-card-item').forEach(card => {
                card.classList.remove('selected');
            });
            
            // 添加选中状态
            element.classList.add('selected');
            selectedCard = cardId;
        }

        // 添加新卡片
        function addNewCard() {
            console.log('addNewCard called');
            try {
                editingCardId = null;
                const modalTitle = document.getElementById('modalTitle');
                if (!modalTitle) {
                    console.error('找不到 modalTitle 元素');
                    return;
                }
                modalTitle.textContent = '新建电价模板';
                
                // 重置表单
                const priceForm = document.getElementById('priceForm');
                if (!priceForm) {
                    console.error('找不到 priceForm 元素');
                    return;
                }
                priceForm.reset();
                
                // 默认选中上网电价标签页
                switchConfigTab('feedin');
                
                showModal();
            } catch (error) {
                console.error('addNewCard error:', error);
            }
        }

        // 编辑卡片
        function editCard(event, cardId) {
            console.log('editCard called with cardId:', cardId);
            try {
                event.stopPropagation();
                editingCardId = cardId;
                
                const modalTitle = document.getElementById('modalTitle');
                if (!modalTitle) {
                    console.error('找不到 modalTitle 元素');
                    return;
                }
                modalTitle.textContent = '编辑电价模板';
                
                // 加载现有数据
                loadCardData(cardId);
                
                showModal();
            } catch (error) {
                console.error('editCard error:', error);
            }
        }

        // 删除卡片
        function deleteCard(event, cardId) {
            event.stopPropagation();
            if (confirm('确定要删除这个电价配置吗？')) {
                // 这里添加删除逻辑
                alert('电价配置已删除');
                // 实际应用中需要从DOM中移除卡片或重新加载数据
            }
        }

        // 切换配置标签页
        function switchConfigTab(tab) {
            // 更新标签按钮状态
            document.querySelectorAll('.config-tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // 如果是通过点击调用，event.target存在
            if (event && event.target && event.target.classList.contains('config-tab-btn')) {
                event.target.classList.add('active');
            } else {
                // 否则根据tab参数设置对应的按钮为active
                document.querySelector(`.config-tab-btn:nth-child(${tab === 'feedin' ? 1 : 2})`).classList.add('active');
            }
            
            // 切换内容显示
            document.querySelectorAll('.config-tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`${tab}-config`).classList.add('active');
        }

        // 切换上网电价类型
        function toggleFeedinPriceType() {
            const priceType = document.querySelector('input[name="feedinPriceType"]:checked').value;
            document.getElementById('feedinFixedSection').style.display = priceType === 'fixed' ? 'block' : 'none';
            document.getElementById('feedinTimeSection').style.display = priceType === 'time' ? 'block' : 'none';
        }

        // 切换用电价类型
        function toggleUsagePriceType() {
            const priceType = document.querySelector('input[name="usagePriceType"]:checked').value;
            document.getElementById('usageFixedSection').style.display = priceType === 'fixed' ? 'block' : 'none';
            document.getElementById('usageTimeSection').style.display = priceType === 'time' ? 'block' : 'none';
            document.getElementById('usageTieredSection').style.display = priceType === 'tiered' ? 'block' : 'none';
        }

        // 添加上网电价时间段
        function addFeedinTimeSlot() {
            const tbody = document.getElementById('feedinTimeSlots');
            const rowCount = tbody.children.length + 1;
            const newRow = document.createElement('tr');
            newRow.innerHTML = `
                <td>时段${rowCount}</td>
                <td><input type="time" value="08:00"></td>
                <td><input type="time" value="12:00"></td>
                <td>
                    <select>
                        <option value="valley">谷时</option>
                        <option value="normal" selected>平时</option>
                        <option value="peak">峰时</option>
                    </select>
                </td>
                <td><input type="number" step="0.01" placeholder="电价"></td>
                <td><button type="button" class="btn-remove" onclick="removeRow(this)">删除</button></td>
            `;
            tbody.appendChild(newRow);
        }

        // 添加用电价时间段
        function addUsageTimeSlot() {
            const tbody = document.getElementById('usageTimeSlots');
            const rowCount = tbody.children.length + 1;
            const newRow = document.createElement('tr');
            newRow.innerHTML = `
                <td>时段${rowCount}</td>
                <td><input type="time" value="08:00"></td>
                <td><input type="time" value="12:00"></td>
                <td>
                    <select>
                        <option value="valley">谷时</option>
                        <option value="normal" selected>平时</option>
                        <option value="peak">峰时</option>
                    </select>
                </td>
                <td><input type="number" step="0.01" placeholder="电价"></td>
                <td><button type="button" class="btn-remove" onclick="removeRow(this)">删除</button></td>
            `;
            tbody.appendChild(newRow);
        }

        // 添加阶梯电价
        function addUsageTierSlot() {
            const tbody = document.getElementById('usageTierSlots');
            const rowCount = tbody.children.length;
            const lastRow = tbody.lastElementChild;
            const lastEndValue = lastRow ? lastRow.children[2].querySelector('input').value : '0';
            
            const newRow = document.createElement('tr');
            newRow.innerHTML = `
                <td>第${numberToChinese(rowCount + 1)}阶梯</td>
                <td><input type="number" value="${lastEndValue}" readonly></td>
                <td><input type="number" placeholder="如：${parseInt(lastEndValue) + 200}"></td>
                <td><input type="number" step="0.01" placeholder="电价"></td>
                <td><button type="button" class="btn-remove" onclick="removeRow(this)">删除</button></td>
            `;
            tbody.appendChild(newRow);
        }

        // 删除行
        function removeRow(button) {
            const row = button.parentElement.parentElement;
            const tbody = row.parentElement;
            row.remove();
            
            // 重新编号
            const rows = tbody.querySelectorAll('tr');
            rows.forEach((row, index) => {
                const firstCell = row.children[0];
                if (firstCell.textContent.includes('时段')) {
                    firstCell.textContent = `时段${index + 1}`;
                } else if (firstCell.textContent.includes('阶梯')) {
                    firstCell.textContent = `第${numberToChinese(index + 1)}阶梯`;
                    // 更新阶梯起始值
                    if (index > 0) {
                        const prevEndValue = rows[index - 1].children[2].querySelector('input').value;
                        row.children[1].querySelector('input').value = prevEndValue;
                    }
                }
            });
        }

        // 保存配置
        function saveConfig() {
            // 收集表单数据
            const formData = {
                templateName: document.getElementById('templateName').value,
                station: document.getElementById('stationSelect').value,
                feedinPrice: collectFeedinPrice(),
                usagePrice: collectUsagePrice(),
                isPermanent: document.getElementById('permanentCheck').checked
            };
            
            if (!formData.isPermanent) {
                formData.startDate = document.getElementById('startDate').value;
                formData.endDate = document.getElementById('endDate').value;
            }
            
            console.log('保存配置：', formData);
            alert('电价模板已保存');
            closeModal();
            
            // 实际应用中需要更新卡片列表或重新加载数据
        }

        // 收集上网电价数据
        function collectFeedinPrice() {
            const priceType = document.querySelector('input[name="feedinPriceType"]:checked').value;
            const data = { type: priceType };
            
            if (priceType === 'fixed') {
                data.price = document.getElementById('feedinFixedPrice').value;
            } else if (priceType === 'time') {
                data.timeSlots = [];
                document.querySelectorAll('#feedinTimeSlots tr').forEach(row => {
                    data.timeSlots.push({
                        startTime: row.children[1].querySelector('input').value,
                        endTime: row.children[2].querySelector('input').value,
                        type: row.children[3].querySelector('select').value,
                        price: row.children[4].querySelector('input').value
                    });
                });
            }
            
            return data;
        }

        // 收集用电价数据
        function collectUsagePrice() {
            const priceType = document.querySelector('input[name="usagePriceType"]:checked').value;
            const data = { 
                type: priceType,
                basicFeeType: document.getElementById('basicFeeType').value,
                basicFeePrice: document.getElementById('basicFeePrice').value
            };
            
            if (priceType === 'fixed') {
                data.price = document.getElementById('usageFixedPrice').value;
            } else if (priceType === 'time') {
                data.timeSlots = [];
                document.querySelectorAll('#usageTimeSlots tr').forEach(row => {
                    data.timeSlots.push({
                        startTime: row.children[1].querySelector('input').value,
                        endTime: row.children[2].querySelector('input').value,
                        type: row.children[3].querySelector('select').value,
                        price: row.children[4].querySelector('input').value
                    });
                });
            } else if (priceType === 'tiered') {
                data.tiers = [];
                document.querySelectorAll('#usageTierSlots tr').forEach(row => {
                    data.tiers.push({
                        startAmount: row.children[1].querySelector('input').value,
                        endAmount: row.children[2].querySelector('input').value,
                        price: row.children[3].querySelector('input').value
                    });
                });
            }
            
            return data;
        }

        // 加载卡片数据（编辑时）
        function loadCardData(cardId) {
            // 这里应该根据cardId加载实际数据
            // 示例数据
            if (cardId === 'feed-1') {
                document.getElementById('templateName').value = '上海工业园储能站电价模板';
                document.getElementById('stationSelect').value = 'sh';
                
                // 切换到上网电价标签
                switchConfigTab('feedin');
                
                // 设置分时电价
                document.querySelector('input[name="feedinPriceType"][value="time"]').checked = true;
                toggleFeedinPriceType();
            } else if (cardId === 'purchase-1') {
                document.getElementById('templateName').value = '深圳光伏储能站电价模板';
                document.getElementById('stationSelect').value = 'sz';
                
                // 切换到用电价标签
                switchConfigTab('usage');
                
                // 设置分时电价
                document.querySelector('input[name="usagePriceType"][value="time"]').checked = true;
                toggleUsagePriceType();
            }
        }

        // 数字转中文
        function numberToChinese(num) {
            const chinese = ['一', '二', '三', '四', '五', '六', '七', '八', '九', '十'];
            return num <= 10 ? chinese[num - 1] : num;
        }

        // 切换有效期
        function toggleValidity() {
            const isPermanent = document.getElementById('permanentCheck').checked;
            document.getElementById('validityDates').style.display = isPermanent ? 'none' : 'grid';
        }

        // 显示模态框
        function showModal() {
            console.log('showModal called');
            const modal = document.getElementById('configModal');
            if (!modal) {
                console.error('找不到 configModal 元素');
                return;
            }
            modal.style.display = 'flex';
        }

        // 关闭模态框
        function closeModal() {
            document.getElementById('configModal').style.display = 'none';
            document.getElementById('priceForm').reset();
        }

        // 切换语言
        function toggleLanguage() {
            const langText = document.getElementById('lang-text');
            const currentLang = langText.textContent;
            langText.textContent = currentLang === '中文' ? 'English' : '中文';
        }

        // 切换主题
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            document.getElementById('theme-icon').textContent = newTheme === 'dark' ? '☀️' : '🌙';
            localStorage.setItem('ess_theme', newTheme);
        }

        // 切换侧边栏
        function toggleSidebar() {
            if (window.sidebar) {
                window.sidebar.toggle();
            }
        }

        // 切换公司
        function switchCompany(companyId) {
            console.log('切换到公司:', companyId);
            // 这里可以添加切换公司后的逻辑
            // 例如：重新加载该公司的电价模板数据
            // loadCompanyPriceTemplates(companyId);
            
            // 暂时只显示提示
            const companySelect = document.querySelector('.company-select');
            const companyName = companySelect.options[companySelect.selectedIndex].text;
            console.log('已切换到:', companyName);
            
            // 可以在这里重新加载页面数据或更新卡片列表
            // 示例：清空现有卡片并加载新公司的数据
            // reloadPriceCards(companyId);
        }


        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 应用保存的主题
            const savedTheme = localStorage.getItem('ess_theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            document.getElementById('theme-icon').textContent = savedTheme === 'dark' ? '☀️' : '🌙';
            
            // 点击模态框外部关闭
            document.getElementById('configModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeModal();
                }
            });
        });
    </script>

    <!-- 引入侧边栏和导航栏脚本 -->
    <script src="./sidebar.js"></script>
    <script src="./navbar.js"></script>
</body>
</html>