<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>设备列表 - 工商储能管理系统</title>
    <link rel="stylesheet" href="../sidebar.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.5;
            color: #1e293b;
            background: #EBEDF5;
            min-height: 100vh;
        }

        .main-content {
            margin-left: 240px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .navbar {
            background: white;
            border-bottom: 1px solid #e2e8f0;
            padding: 0 2rem;
            height: 64px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 50;
        }

        .navbar-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .navbar-right {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-button {
            padding: 0.5rem;
            background: none;
            border: none;
            border-radius: 0.375rem;
            cursor: pointer;
            color: #64748b;
            transition: all 150ms ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
        }

        .nav-button:hover {
            background: #f1f5f9;
            color: #1e293b;
        }

        .page-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1e293b;
        }

        .content {
            flex: 1;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
        }

        .main-layout {
            display: flex;
            gap: 2rem;
            height: 100%;
        }

        .left-panel {
            width: 280px;
            flex-shrink: 0;
            overflow: hidden;
        }

        .right-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 2rem;
            min-width: 0;
        }

        /* 搜索过滤区域 */
        .search-filter-section {
            background: white;
            border-radius: 0.75rem;
            padding: 1.5rem;
            border: 1px solid #e2e8f0;
        }

        .search-row {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
            justify-content: space-between;
        }

        .search-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .search-label {
            font-size: 0.875rem;
            font-weight: 500;
            color: #374151;
            white-space: nowrap;
        }

        .search-input {
            padding: 0.5rem 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 0.875rem;
            background: white;
            color: #1e293b;
            min-width: 200px;
        }

        .search-button, .reset-button {
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 150ms ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .search-button {
            background: #3562E3;
            color: white;
            border: 1px solid #3562E3;
        }

        .search-button:hover {
            background: #2951d3;
        }

        .reset-button {
            background: white;
            color: #64748b;
            border: 1px solid #d1d5db;
        }

        .reset-button:hover {
            background: #f8fafc;
        }

        /* 设备列表区域 */
        .device-list {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }

        .device-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.875rem;
        }

        .device-table th {
            padding: 0.625rem;
            text-align: left;
            font-weight: 600;
            color: #374151;
            background: #f9fafb;
            border-bottom: 1px solid #e5e7eb;
            font-size: 0.8125rem;
        }

        .device-table td {
            padding: 0.625rem;
            border-bottom: 1px solid #f3f4f6;
            font-size: 0.8125rem;
        }

        .device-table tbody tr:hover {
            background: #f8fafc;
        }

        .device-name {
            font-weight: 600;
            color: #1f2937;
        }

        .device-type {
            color: #6b7280;
        }

        .device-status {
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
            display: inline-block;
        }

        .device-status.online {
            background: #dcfce7;
            color: #16a34a;
        }

        .device-status.warning {
            background: #fef3c7;
            color: #d97706;
        }

        .device-status.offline {
            background: #fee2e2;
            color: #dc2626;
        }

        /* 表格操作按钮 */
        .table-action {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.375rem;
            border-radius: 0.25rem;
            color: #374151;
            transition: all 0.15s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        .table-action:hover {
            background: #f3f4f6;
            color: #111827;
        }

        .table-action svg {
            width: 16px;
            height: 16px;
        }

        /* 排序功能 */
        .device-table th.sortable {
            cursor: pointer;
            user-select: none;
            transition: background 0.2s ease;
        }
        
        .device-table th.sortable:hover {
            background: #e5e7eb;
        }
        
        .th-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 0.5rem;
        }
        
        .sort-icons {
            display: flex;
            flex-direction: column;
            gap: 0;
            margin-left: 0.5rem;
        }
        
        .sort-icon {
            font-size: 0.75rem;
            opacity: 0.4;
            transition: all 0.2s ease;
            cursor: pointer;
            line-height: 0.75rem;
            padding: 2px 4px;
        }
        
        .sort-icon:hover {
            opacity: 0.8;
        }
        
        .device-table th.sortable:hover .sort-icon {
            opacity: 0.7;
        }
        
        .sort-icon.active {
            opacity: 1;
            color: #3562E3;
            font-weight: bold;
        }

        .station-search-section {
            background: white;
            border-radius: 0.75rem;
            border: 1px solid #e2e8f0;
            height: fit-content;
            margin: 0.5rem;
        }

        .device-section {
            background: white;
            border-radius: 0.75rem;
            border: 1px solid #e2e8f0;
            overflow: hidden;
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 1rem;
        }

        .section-header {
            padding: 0.75rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 0.5rem;
        }



        .collapse-btn {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            cursor: pointer;
            color: #64748b;
            transition: all 0.15s ease;
            flex-shrink: 0;
        }
        
        .collapse-btn:hover {
            background: #f1f5f9;
            border-color: #cbd5e1;
            color: #475569;
        }

        .collapse-icon {
            transition: transform 0.2s ease;
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .collapse-btn.collapsed .collapse-icon {
            transform: rotate(180deg);
        }

        /* 左侧面板收起状态 */
        .left-panel {
            transition: width 0.3s ease;
        }
        
        .left-panel.collapsed {
            width: 50px;
        }
        
        .left-panel.collapsed .station-search-input,
        .left-panel.collapsed .station-search-container {
            display: none;
        }
        
        .table-action-bar {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .action-btn {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.375rem 0.75rem;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 0.8125rem;
            color: #64748b;
            cursor: pointer;
            transition: all 0.15s ease;
        }
        
        .action-btn:hover {
            background: #f8fafc;
            border-color: #cbd5e1;
            color: #1e293b;
        }
        
        .action-btn.primary {
            background: #3562E3;
            color: white;
            border-color: #3562E3;
        }
        
        .action-btn.primary:hover {
            background: #2951d3;
            border-color: #2951d3;
        }
        
        .action-btn.ota {
            background: #10b981;
            color: white;
            border-color: #10b981;
        }
        
        .action-btn.ota:hover {
            background: #059669;
            border-color: #059669;
        }
        
        .action-btn svg {
            width: 14px;
            height: 14px;
        }
        
        .left-panel.collapsed .section-header {
            justify-content: center;
            padding: 1rem 0.5rem;
        }

        .station-search-container {
            padding: 0.75rem;
            padding-left: 1.25rem;
        }
        
        .station-search-input {
            flex: 1;
            padding: 0.375rem 0.75rem;
            font-size: 0.875rem;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background: white;
        }

        .station-cards {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin-top: 0.5rem;
        }

        .station-card {
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.15s ease;
            background: white;
        }

        .station-card:hover {
            border-color: #cbd5e1;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .station-card.selected {
            border-color: #3562E3;
            background: #eff6ff;
            box-shadow: 0 0 0 1px #3562E3;
        }

        .station-card-name {
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }

        .station-card.selected .station-card-name {
            color: #3562E3;
        }

        .station-card-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.875rem;
            color: #6b7280;
        }

        .station-card.selected .station-card-info {
            color: #4f46e5;
        }

        /* 表格容器 - 支持水平滚动 */
        .table-container {
            overflow-x: auto;
            flex: 1;
            margin-top: 1rem;
        }

        .device-table {
            min-width: 1000px; /* 缩小表格最小宽度 */
            position: relative;
        }

        .device-table th,
        .device-table td {
            white-space: nowrap;
        }

        /* 固定列样式 */
        .device-table thead .fixed-left,
        .device-table thead .fixed-right {
            position: sticky;
            background: #f9fafb;
            z-index: 10;
        }

        .device-table tbody .fixed-left,
        .device-table tbody .fixed-right {
            position: sticky;
            background: white;
            z-index: 10;
        }

        .fixed-left {
            border-right: 1px solid #e5e7eb;
        }

        .fixed-left.device-name-col {
            left: 0;
            min-width: 180px;
        }
        
        .device-name-col {
            display: flex;
            align-items: center;
        }

        .fixed-right {
            right: 0;
            border-left: 1px solid #e5e7eb;
            min-width: 120px;
        }

        /* 表格行悬停时固定列背景色调整 */
        .device-table tbody tr:hover .fixed-left,
        .device-table tbody tr:hover .fixed-right {
            background: #f8fafc;
        }

        /* 滚动列样式 */
        .scrollable-col {
            min-width: 100px;
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #6b7280;
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }
        
        /* 开关样式 */
        .switch {
            position: relative;
            display: inline-block;
            width: 36px;
            height: 20px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #cbd5e1;
            transition: .3s;
            border-radius: 20px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 14px;
            width: 14px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .3s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: #3562E3;
        }
        
        input:checked + .slider:before {
            transform: translateX(16px);
        }
        
        /* Toast样式 */
        .toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: #1f2937;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-size: 0.875rem;
            z-index: 1100;
            opacity: 0;
            transition: all 0.3s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }
        
        /* 模态弹窗样式 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        .modal-content h3 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }
        
        .device-list {
            max-height: 300px;
            overflow-y: auto;
            margin: 1rem 0;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 0.5rem;
        }
        
        .device-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem;
            border-bottom: 1px solid #f3f4f6;
        }
        
        .device-item:last-child {
            border-bottom: none;
        }
        
        .text-gray {
            color: #6b7280;
            font-size: 0.875rem;
        }
        
        .modal-footer {
            display: flex;
            gap: 0.75rem;
            justify-content: flex-end;
            margin-top: 1.5rem;
        }
        
        /* 进度弹窗 */
        .progress-popup {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            width: 300px;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s;
            visibility: hidden;
            z-index: 1000;
        }
        
        .progress-popup.show {
            opacity: 1;
            transform: translateY(0);
            visibility: visible;
        }
        
        .progress-header {
            padding: 1rem;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .progress-header h4 {
            font-size: 1rem;
            font-weight: 600;
            margin: 0;
        }
        
        .progress-content {
            padding: 1rem;
        }
        
        .progress-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
        }
        
        /* 结果弹窗 */
        .result-popup {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            width: 320px;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s;
            visibility: hidden;
            z-index: 1000;
        }
        
        .result-popup.show {
            opacity: 1;
            transform: translateY(0);
            visibility: visible;
        }
        
        .result-header {
            padding: 1rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .result-header h4 {
            font-size: 1rem;
            font-weight: 600;
            margin: 0;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 1.25rem;
            color: #6b7280;
            cursor: pointer;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .result-content {
            padding: 1.5rem;
            display: flex;
            gap: 1rem;
        }
        
        .result-item {
            flex: 1;
            background: #f9fafb;
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
        }
        
        .result-item span:first-child {
            display: block;
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        
        .result-item span:last-child {
            display: block;
            font-size: 0.875rem;
            color: #6b7280;
        }
        
        .result-item.success {
            background: #dcfce7;
        }
        
        .result-item.success span:first-child {
            color: #16a34a;
        }
        
        .result-item.fail {
            background: #fee2e2;
        }
        
        .result-item.fail span:first-child {
            color: #dc2626;
        }
        
        .result-footer {
            padding: 1rem;
            border-top: 1px solid #e5e7eb;
            display: flex;
            gap: 0.75rem;
            justify-content: flex-end;
        }
        
        .btn-text {
            background: none;
            border: none;
            color: #6b7280;
            font-size: 0.875rem;
            cursor: pointer;
            padding: 0.375rem 0.75rem;
        }
        
        .btn-primary-sm {
            padding: 0.375rem 0.75rem;
            background: #3562E3;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 0.875rem;
            cursor: pointer;
        }
        
        /* 详情抽屉 */
        .details-drawer {
            width: 900px;
        }
        
        .stats-section {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            flex: 1;
            background: #f9fafb;
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
        }
        
        .stat-card.success {
            background: #dcfce7;
            color: #16a34a;
        }
        
        .stat-card.fail {
            background: #fee2e2;
            color: #dc2626;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        .stat-label {
            font-size: 0.875rem;
            margin-top: 0.25rem;
        }
        
        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding: 0 1rem;
        }
        
        .table-header h4 {
            font-size: 1rem;
            font-weight: 600;
            color: #1f2937;
            margin: 0;
        }
        
        .retry-all-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: #dc2626;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s;
        }
        
        .retry-all-btn:hover {
            background: #b91c1c;
        }
        
        .retry-all-btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }
        
        .device-cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1rem;
            max-height: 500px;
            overflow-y: auto;
            padding: 0.5rem;
        }
        
        .device-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 1rem;
            transition: all 0.15s;
        }
        
        .device-card:hover {
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            border-color: #cbd5e1;
        }
        
        .device-card-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }
        
        .device-card-row:last-child {
            margin-bottom: 0;
        }
        
        .device-card-name {
            font-weight: 600;
            color: #1f2937;
        }
        
        .device-card-sn {
            font-size: 0.875rem;
            color: #6b7280;
        }
        
        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
            display: inline-block;
        }
        
        .status-badge.success {
            background: #dcfce7;
            color: #16a34a;
        }
        
        .status-badge.failed {
            background: #fee2e2;
            color: #dc2626;
        }
        
        .retry-btn {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.25rem 0.5rem;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 4px;
            font-size: 0.75rem;
            color: #6b7280;
            cursor: pointer;
            transition: all 0.15s;
        }
        
        .retry-btn:hover {
            border-color: #3562E3;
            color: #3562E3;
        }
        
        /* 设备列表样式 */
        .device-list-container {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            max-height: 500px;
            overflow-y: auto;
            padding: 0.5rem;
        }
        
        .device-list-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem 1rem;
            background: #f9fafb;
            border-radius: 6px;
            font-size: 0.875rem;
        }
        
        .device-list-item:hover {
            background: #f3f4f6;
        }
        
        .device-name {
            font-weight: 600;
            color: #1f2937;
            flex: 1;
        }
        
        .device-sn {
            color: #6b7280;
            flex: 1;
        }
        
        .device-status {
            font-weight: 500;
        }
        
        .device-status.status-failed {
            color: #dc2626;
        }
        
        /* Tab样式 */
        .details-tabs {
            display: flex;
            gap: 1rem;
            margin: 1rem 0;
            border-bottom: 1px solid #e5e7eb;
            padding-bottom: 0;
        }
        
        .tab-btn {
            padding: 0.75rem 1rem;
            background: none;
            border: none;
            border-bottom: 2px solid transparent;
            font-size: 0.875rem;
            font-weight: 500;
            color: #6b7280;
            cursor: pointer;
            transition: all 0.15s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .tab-btn:hover {
            color: #374151;
        }
        
        .tab-btn.active {
            color: #3562E3;
            border-bottom-color: #3562E3;
        }
        
        .tab-btn span {
            background: #f3f4f6;
            padding: 0.125rem 0.5rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .tab-btn.active span {
            background: #dbeafe;
            color: #3562E3;
        }
        
        /* 抽屉样式 */
        .drawer-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
            z-index: 999;
        }
        
        .drawer-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        
        .drawer {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100%;
            background: white;
            box-shadow: -2px 0 8px rgba(0, 0, 0, 0.1);
            transition: right 0.3s;
            z-index: 1000;
            display: flex;
            flex-direction: column;
        }
        
        .drawer.open {
            right: 0;
        }
        
        .drawer-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .drawer-header h3 {
            font-size: 1.125rem;
            font-weight: 600;
            color: #1f2937;
            margin: 0;
        }
        
        .drawer-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #6b7280;
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: all 0.15s;
        }
        
        .drawer-close:hover {
            background: #f3f4f6;
            color: #1f2937;
        }
        
        .drawer-body {
            flex: 1;
            padding: 1.5rem;
            overflow-y: auto;
        }
        
        .drawer-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid #e5e7eb;
            display: flex;
            gap: 0.75rem;
            justify-content: flex-end;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: #374151;
            margin-bottom: 0.5rem;
        }
        
        .form-input {
            width: 100%;
            padding: 0.625rem 0.875rem;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 0.875rem;
            color: #1f2937;
            background: white;
            transition: all 0.15s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3562E3;
            box-shadow: 0 0 0 3px rgba(53, 98, 227, 0.1);
        }
        
        .required {
            color: #ef4444;
        }
        
        .btn-primary {
            padding: 0.5rem 1rem;
            background: #3562E3;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s;
        }
        
        .btn-primary:hover {
            background: #2951d3;
        }
        
        .btn-cancel {
            padding: 0.5rem 1rem;
            background: white;
            color: #6b7280;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s;
        }
        
        .btn-cancel:hover {
            background: #f9fafb;
            border-color: #9ca3af;
            color: #374151;
        }
        
        /* 详情弹窗样式 */
        .modal-large {
            max-width: 1200px;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1e293b;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #6b7280;
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0.375rem;
            transition: all 0.15s;
        }
        
        .modal-close:hover {
            background: #f3f4f6;
            color: #1f2937;
        }
        
        .modal-body {
            overflow-y: auto;
            max-height: calc(90vh - 150px);
        }
        
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 0.75rem;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid #e5e7eb;
        }
        
        .station-detail-grid {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 2rem;
            min-height: 500px;
        }
        
        .station-detail-info {
            padding-right: 2rem;
            border-right: 1px solid #e2e8f0;
        }
        
        .section-title {
            font-size: 1rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 1rem;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }
        
        .info-item {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }
        
        .info-label {
            font-size: 0.875rem;
            color: #64748b;
        }
        
        .info-value {
            font-size: 1rem;
            color: #1e293b;
            font-weight: 500;
        }
        
        .topology-container {
            background: #f8fafc;
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 300px;
            position: relative;
        }
        
        .topology-image {
            max-width: 100%;
            height: auto;
            border-radius: 4px;
            cursor: zoom-in;
        }
        
        .topology-fullscreen-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: rgba(0, 0, 0, 0.6);
            color: white;
            border: none;
            border-radius: 6px;
            padding: 0.5rem 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            transition: all 0.15s;
        }
        
        .topology-fullscreen-btn:hover {
            background: rgba(0, 0, 0, 0.8);
        }
        
        .station-detail-metrics {
            padding-left: 1rem;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }
        
        .metric-card {
            background: #f8fafc;
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
        }
        
        .metric-label {
            font-size: 0.875rem;
            color: #64748b;
            margin-bottom: 0.5rem;
        }
        
        .metric-value {
            font-size: 1.5rem;
            font-weight: 600;
            color: #3562E3;
        }
        
        .device-status-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin-top: 1rem;
        }
        
        .device-status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            background: #f8fafc;
            border-radius: 6px;
        }
        
        .device-name {
            font-size: 0.875rem;
            color: #374151;
            font-weight: 500;
        }
        
        .device-status {
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .status-online {
            background: #dcfce7;
            color: #16a34a;
        }
        
        .status-offline {
            background: #fee2e2;
            color: #dc2626;
        }
        
        .status-warning {
            background: #fef3c7;
            color: #d97706;
        }
        
        /* 全屏查看模态框 */
        .fullscreen-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            z-index: 1100;
            align-items: center;
            justify-content: center;
        }
        
        .fullscreen-content {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            padding: 2rem;
        }
        
        .fullscreen-image {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            cursor: grab;
        }
        
        .fullscreen-image.grabbing {
            cursor: grabbing;
        }
        
        .fullscreen-close {
            position: absolute;
            top: 2rem;
            right: 2rem;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            font-size: 2rem;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s;
        }
        
        .fullscreen-close:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.5);
        }
        
        .zoom-controls {
            position: absolute;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            border-radius: 8px;
            padding: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .zoom-btn {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            transition: all 0.15s;
        }
        
        .zoom-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .zoom-info {
            color: white;
            font-size: 0.875rem;
            min-width: 60px;
            text-align: center;
        }
        
        .btn {
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s;
            border: none;
        }
        
        .btn-primary {
            background: #3562E3;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2951d3;
        }
        
        .btn-cancel {
            background: white;
            color: #374151;
            border: 1px solid #d1d5db;
        }
        
        .btn-cancel:hover {
            background: #f9fafb;
            border-color: #9ca3af;
        }
        
        /* 超大模态框 */
        .modal-xl {
            width: 90%;
            max-width: 1400px;
            height: 90vh;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
        }
        
        /* Tab样式 */
        .detail-tabs {
            display: flex;
            gap: 0;
            margin-bottom: 0;
        }
        
        .tab-button {
            padding: 0.75rem 1.5rem;
            border: none;
            background: none;
            cursor: pointer;
            color: #64748b;
            font-weight: 500;
            transition: all 150ms ease;
            position: relative;
            border-bottom: 2px solid transparent;
            margin-bottom: -2px;
        }
        
        .tab-button:hover {
            color: #1e293b;
        }
        
        .tab-button.active {
            color: #3562E3;
            border-bottom-color: #3562E3;
        }
        
        /* Tab内容区域 */
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* 能量流图样式 */
        .energy-metrics-container {
            display: flex;
            gap: 24px;
            align-items: stretch;
            padding: 20px;
            background: #f8fafc;
            border-radius: 12px;
            min-height: 500px;
        }
        
        .energy-flow-diagram {
            flex: 1;
            position: relative;
            min-height: 460px;
            background: transparent;
            border-radius: 12px;
            overflow: visible;
        }
        
        .data-metrics-card {
            width: 280px;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .metrics-section {
            margin-bottom: 24px;
        }
        
        .metrics-section:last-child {
            margin-bottom: 0;
        }
        
        .metrics-title {
            font-size: 16px;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .metrics-grid {
            display: grid;
            gap: 8px;
        }
        
        .metrics-item {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            padding: 12px 0;
            text-align: left;
        }
        
        .metrics-label {
            font-size: 13px;
            color: #64748b;
            margin-bottom: 4px;
        }
        
        .metrics-value {
            font-size: 18px;
            font-weight: 700;
            color: #0f172a;
            line-height: 1;
        }
        
        /* 能量流组件 */
        .flow-component {
            position: absolute;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            z-index: 20;
        }
        
        .flow-component:hover {
            transform: scale(1.05);
        }
        
        .flow-component img {
            width: 100%;
            height: auto;
            filter: drop-shadow(0 8px 16px rgba(0,0,0,0.1));
            transition: filter 0.3s ease;
        }
        
        .flow-component.pv {
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 180px;
        }
        
        .flow-component.load {
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 200px;
        }
        
        .flow-component.storage {
            bottom: 20px;
            left: 60px;
            width: 180px;
        }
        
        .flow-component.grid {
            bottom: 20px;
            right: 80px;
            width: 160px;
        }
        
        .component-label {
            position: absolute;
            font-size: 18px;
            font-weight: 600;
            color: #1e293b;
            background: white;
            padding: 10px 24px;
            border-radius: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            display: inline-block;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        
        .flow-component.pv .component-label {
            right: -80px;
            top: calc(50% - 10px);
            transform: translateY(-50%);
        }
        
        .flow-component.load .component-label {
            right: -85px;
            top: 50%;
            transform: translateY(-50%);
        }
        
        .flow-component.storage .component-label,
        .flow-component.grid .component-label {
            position: static;
            margin-top: 15px;
        }
        
        /* 电池指示器 */
        .battery-indicator {
            position: absolute;
            top: 50%;
            left: -60px;
            transform: translateY(-50%);
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 30;
        }
        
        .battery-icon {
            position: relative;
            width: 30px;
            height: 16px;
            border: 2px solid #64748b;
            border-radius: 3px;
            display: flex;
            align-items: center;
            padding: 2px;
        }
        
        .battery-icon::after {
            content: '';
            position: absolute;
            right: -4px;
            top: 50%;
            transform: translateY(-50%);
            width: 3px;
            height: 8px;
            background: #64748b;
            border-radius: 0 2px 2px 0;
        }
        
        .battery-level {
            height: 100%;
            background: #10b981;
            border-radius: 1px;
            transition: width 0.3s ease;
        }
        
        .battery-text {
            font-size: 16px;
            font-weight: 600;
            color: #1e293b;
        }
        
        /* SVG能量流 */
        .energy-flow-svg {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: 10;
        }
        
        /* 概览网格 */
        .overview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }
        
        .overview-card {
            background: white;
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .card {
            background: white;
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .card.energy-flow-card {
            background: #f8fafc;
        }
        
        .card-header {
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .card-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 1rem;
        }
        
        .stat-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }
        
        .stat-item {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
            padding: 0.75rem;
            background: #f8fafc;
            border-radius: 0.5rem;
        }
        
        .stat-label {
            font-size: 0.75rem;
            color: #64748b;
        }
        
        .stat-value {
            font-size: 1.125rem;
            font-weight: 600;
            color: #1e293b;
        }
        
        /* 数据网格 */
        .data-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 1.5rem;
        }
        
        .data-card {
            background: white;
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        /* 告警表格 */
        .alarm-list {
            background: white;
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .alarm-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .alarm-table th {
            text-align: left;
            padding: 0.75rem;
            border-bottom: 1px solid #e5e7eb;
            font-weight: 600;
            color: #374151;
            font-size: 0.875rem;
        }
        
        .alarm-table td {
            padding: 0.75rem;
            border-bottom: 1px solid #f3f4f6;
            font-size: 0.875rem;
            color: #1e293b;
        }
        
        .alarm-level {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.125rem 0.5rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .alarm-level.minor {
            background: #fef3c7;
            color: #d97706;
        }
        
        /* 报表 */
        .report-content {
            background: white;
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        /* 时间选择按钮 */
        .time-btn {
            padding: 6px 16px;
            border: 1px solid #e2e8f0;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            color: #64748b;
            transition: all 0.2s;
        }
        
        .time-btn:hover {
            background: #f8fafc;
            color: #1e293b;
        }
        
        .time-btn.active {
            background: #3562E3;
            color: white;
            border-color: #3562E3;
        }
        
        .chart-placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 300px;
            background: #f3f4f6;
            border-radius: 0.5rem;
            color: #9ca3af;
            font-size: 0.875rem;
        }
        
        /* 馈电状态样式 */
        .power-status-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 999px;
            font-weight: 500;
        }
        
        .power-status-badge.feeding {
            background-color: #dcfce7;
            color: #16a34a;
            border: 1px solid #bbf7d0;
        }
        
        /* 设备列表 */
        .device-list {
            background: white;
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body>
    <!-- 侧边栏容器 -->
    <div id="sidebar-container"></div>

    <!-- 主内容区域 -->
    <main class="main-content">
        <!-- 顶部导航栏 -->
        <nav class="navbar">
            <div class="navbar-left">
                <button class="nav-button" onclick="toggleSidebar()">
                    <span>☰</span>
                </button>
                <button class="nav-button" onclick="goBack()" title="返回场景选择">
                    <span>←</span>
                </button>
                <h1 class="page-title">设备列表</h1>
            </div>
            <div class="navbar-right">
                <button class="nav-button" onclick="toggleLanguage()">
                    <span>🌐</span>
                    <span id="lang-text">中文</span>
                </button>
                <button class="nav-button" onclick="toggleTheme()">
                    <span id="theme-icon">🌙</span>
                </button>
                <button class="nav-button">
                    <span>👤</span>
                    <span>管理员</span>
                </button>
            </div>
        </nav>

        <!-- 内容区域 - 左右布局 -->
        <div class="content">
            <div class="main-layout" id="device-list-section">
                <!-- 左侧电站搜索区域 -->
                <div class="left-panel">
                    <div class="station-search-section">
                        <div class="section-header">
                            <input type="text" class="search-input station-search-input" placeholder="搜索电站名称" id="station-search" oninput="searchStations()">
                            <button class="collapse-btn" onclick="toggleLeftPanel()" id="leftPanelCollapseBtn" title="收起/展开">
                                <svg class="collapse-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M10 12L6 8L10 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </button>
                        </div>
                        <div class="station-search-container">
                            <div class="station-cards" id="stationCards">
                                <!-- 电站卡片将通过JavaScript动态加载 -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 右侧设备区域 -->
                <div class="right-panel">
                    <!-- 查询区域 -->
                    <div class="search-filter-section">
                        <div class="search-row">
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <div class="search-group">
                                    <label class="search-label">设备名称：</label>
                                    <input type="text" class="search-input" placeholder="请输入设备名称" id="device-name-search">
                                </div>
                                <div class="search-group">
                                    <label class="search-label">状态：</label>
                                    <select class="search-input" id="device-status-search">
                                        <option value="">全部状态</option>
                                        <option value="online">在线</option>
                                        <option value="offline">离线</option>
                                        <option value="warning">告警</option>
                                    </select>
                                </div>
                            </div>
                            <div style="display: flex; gap: 0.5rem;">
                                <button class="search-button" onclick="searchDevices()">
                                    <span>搜索</span>
                                </button>
                                <button class="reset-button" onclick="resetSearch()">
                                    <span>重置</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- 设备列表区域 -->
                    <div class="device-section">
                        <div class="table-action-bar">
                            <button class="action-btn primary" onclick="addDevice()">
                                <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M7 1V13M1 7H13" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                <span>新增</span>
                            </button>
                            <button class="action-btn ota" onclick="otaUpgradeDevices()">
                                <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M7 10V1M4 4L7 1L10 4M1 10V12C1 12.5523 1.44772 13 2 13H12C12.5523 13 13 12.5523 13 12V10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                <span>OTA升级</span>
                            </button>
                            <button class="action-btn" onclick="importDevices()">
                                <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M7 1V8M4 5L7 8L10 5M1 10V12C1 12.5523 1.44772 13 2 13H12C12.5523 13 13 12.5523 13 12V10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                <span>导入</span>
                            </button>
                            <button class="action-btn" onclick="exportDevices()">
                                <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M7 8V1M4 4L7 1L10 4M1 10V12C1 12.5523 1.44772 13 2 13H12C12.5523 13 13 12.5523 13 12V10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                <span>导出</span>
                            </button>
                        </div>
                        <div class="table-container">
                            <table class="device-table" id="deviceTable">
                                <thead>
                                    <tr>
                                        <th class="fixed-left device-name-col">
                                            <input type="checkbox" id="selectAllDevices" onchange="toggleAllDevices(this.checked)" style="margin-right: 8px;">
                                            设备名称
                                        </th>
                                        <th class="scrollable-col">编码</th>
                                        <th class="scrollable-col sortable" data-sort="utilization">
                                            <div class="th-content">
                                                <span>利用率</span>
                                                <div class="sort-icons">
                                                    <span class="sort-icon sort-up" onclick="sortTable('utilization', 'asc')">↑</span>
                                                    <span class="sort-icon sort-down" onclick="sortTable('utilization', 'desc')">↓</span>
                                                </div>
                                            </div>
                                        </th>
                                        <th class="scrollable-col sortable" data-sort="realtimePower">
                                            <div class="th-content">
                                                <span>实时功率</span>
                                                <div class="sort-icons">
                                                    <span class="sort-icon sort-up" onclick="sortTable('realtimePower', 'asc')">↑</span>
                                                    <span class="sort-icon sort-down" onclick="sortTable('realtimePower', 'desc')">↓</span>
                                                </div>
                                            </div>
                                        </th>
                                        <th class="scrollable-col sortable" data-sort="installedPower">
                                            <div class="th-content">
                                                <span>装机功率</span>
                                                <div class="sort-icons">
                                                    <span class="sort-icon sort-up" onclick="sortTable('installedPower', 'asc')">↑</span>
                                                    <span class="sort-icon sort-down" onclick="sortTable('installedPower', 'desc')">↓</span>
                                                </div>
                                            </div>
                                        </th>
                                        <th class="scrollable-col sortable" data-sort="soc">
                                            <div class="th-content">
                                                <span>SOC</span>
                                                <div class="sort-icons">
                                                    <span class="sort-icon sort-up" onclick="sortTable('soc', 'asc')">↑</span>
                                                    <span class="sort-icon sort-down" onclick="sortTable('soc', 'desc')">↓</span>
                                                </div>
                                            </div>
                                        </th>
                                        <th class="scrollable-col">状态</th>
                                        <th class="scrollable-col">设置</th>
                                        <th class="scrollable-col">固件版本</th>
                                        <th class="scrollable-col">电站</th>
                                        <th class="fixed-right operation-col">操作</th>
                                    </tr>
                                </thead>
                                <tbody id="deviceTableBody">
                                    <!-- 设备数据将通过JavaScript动态加载 -->
                                </tbody>
                            </table>
                        </div>
                        
                    </div>
                </div>
            </div>
            
            <!-- 设备详情内容区域 -->
            <div id="device-detail-section" style="display: none;">
                <!-- 这里将插入详情内容 -->
            </div>
        </div>
    </main>

    <script src="../sidebar.js"></script>
    <script>
        // 电站数据
        const stations = [
            { id: 'ST001', name: '上海工业园储能站', deviceCount: 12, status: 'online' },
            { id: 'ST002', name: '北京科技园储能站', deviceCount: 8, status: 'online' },
            { id: 'ST003', name: '深圳产业园储能站', deviceCount: 15, status: 'warning' },
            { id: 'ST004', name: '广州智慧园储能站', deviceCount: 6, status: 'online' },
            { id: 'ST005', name: '杭州科创园储能站', deviceCount: 10, status: 'offline' }
        ];

        // 当前显示的电站数据（用于搜索过滤）
        let filteredStations = [...stations];

        // 设备数据（按电站分组）
        const devicesByStation = {
            'ST001': [
                { name: 'INV-001', code: 'INV001', sn: 'SN001', utilization: 85, realtimePower: 450, installedPower: 500, soc: 80, firmware: 'v2.1.3', status: 'online', station: '上海工业园储能站' },
                { name: 'PCS-002', code: 'PCS002', sn: 'SN002', utilization: 92, realtimePower: 920, installedPower: 1000, soc: 95, firmware: 'v1.8.5', status: 'online', station: '上海工业园储能站' },
                { name: 'BMS-003', code: 'BMS003', sn: 'SN003', utilization: 78, realtimePower: 234, installedPower: 300, soc: 68, firmware: 'v3.2.1', status: 'warning', station: '上海工业园储能站' }
            ],
            'ST002': [
                { name: 'INV-004', code: 'INV004', sn: 'SN004', utilization: 88, realtimePower: 704, installedPower: 800, soc: 82, firmware: 'v2.1.3', status: 'online', station: '北京科技园储能站' },
                { name: 'EMS-005', code: 'EMS005', sn: 'SN005', utilization: 75, realtimePower: 450, installedPower: 600, soc: 75, firmware: 'v2.5.7', status: 'online', station: '北京科技园储能站' }
            ],
            'ST003': [
                { name: 'PCS-006', code: 'PCS006', sn: 'SN006', utilization: 0, realtimePower: 0, installedPower: 500, soc: 0, firmware: 'v1.8.5', status: 'offline', station: '深圳产业园储能站' },
                { name: 'BMS-007', code: 'BMS007', sn: 'SN007', utilization: 65, realtimePower: 195, installedPower: 300, soc: 45, firmware: 'v3.2.1', status: 'warning', station: '深圳产业园储能站' }
            ],
            'ST004': [
                { name: 'INV-008', code: 'INV008', sn: 'SN008', utilization: 90, realtimePower: 540, installedPower: 600, soc: 90, firmware: 'v2.1.3', status: 'online', station: '广州智慧园储能站' }
            ],
            'ST005': [
                { name: 'EMS-009', code: 'EMS009', sn: 'SN009', utilization: 0, realtimePower: 0, installedPower: 800, soc: 0, firmware: 'v2.5.7', status: 'offline', station: '杭州科创园储能站' },
                { name: 'PCS-010', code: 'PCS010', sn: 'SN010', utilization: 0, realtimePower: 0, installedPower: 1000, soc: 0, firmware: 'v1.8.5', status: 'offline', station: '杭州科创园储能站' }
            ]
        };

        // 当前选中的电站和排序状态
        let selectedStationId = null;
        let currentSort = { column: null, direction: null };
        
        // 所有设备数据（合并所有电站的设备）
        const allDevices = Object.values(devicesByStation).flat();

        // 渲染电站卡片
        function renderStationCards(stationsToRender = filteredStations) {
            const stationCards = document.getElementById('stationCards');
            stationCards.innerHTML = stationsToRender.map(station => `
                <div class="station-card" data-station-id="${station.id}" onclick="selectStation('${station.id}')">
                    <div class="station-card-name">${station.name}</div>
                    <div class="station-card-info">
                        <span>${station.deviceCount}台设备</span>
                        <span class="device-status ${station.status}">${getStatusText(station.status)}</span>
                    </div>
                </div>
            `).join('');
        }

        // 搜索电站
        function searchStations() {
            const searchInput = document.getElementById('station-search').value.toLowerCase();
            
            if (!searchInput) {
                filteredStations = [...stations];
            } else {
                filteredStations = stations.filter(station => 
                    station.name.toLowerCase().includes(searchInput)
                );
            }
            
            renderStationCards(filteredStations);
        }

        // 选择电站
        function selectStation(stationId) {
            // 更新选中状态
            selectedStationId = stationId;
            
            // 更新卡片选中样式
            document.querySelectorAll('.station-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            if (stationId) {
                document.querySelector(`[data-station-id="${stationId}"]`).classList.add('selected');
                // 渲染该电站的设备
                const devices = devicesByStation[stationId] || [];
                renderDeviceTable(devices);
            } else {
                // 未选择电站时显示所有设备
                renderDeviceTable(allDevices);
            }
        }

        // 渲染设备表格
        function renderDeviceTable(devices) {
            const tbody = document.getElementById('deviceTableBody');
            
            tbody.innerHTML = devices.map(device => `
                <tr>
                    <td class="fixed-left device-name-col">
                        <input type="checkbox" class="device-checkbox" value="${device.sn}" onchange="updateSelectAll()" style="margin-right: 8px;">
                        <span class="device-name">${device.name}</span>
                    </td>
                    <td class="scrollable-col">${device.code}</td>
                    <td class="scrollable-col">${device.utilization}%</td>
                    <td class="scrollable-col">${device.realtimePower}kW</td>
                    <td class="scrollable-col">${device.installedPower}kW</td>
                    <td class="scrollable-col">${device.soc}%</td>
                    <td class="scrollable-col">
                        <span class="device-status ${device.status}">
                            ${getStatusText(device.status)}
                        </span>
                    </td>
                    <td class="scrollable-col">
                        <label class="switch">
                            <input type="checkbox" ${device.enabled !== false ? 'checked' : ''} onchange="toggleDevice('${device.sn}', this.checked)">
                            <span class="slider"></span>
                        </label>
                    </td>
                    <td class="scrollable-col">${device.firmware}</td>
                    <td class="scrollable-col">${device.station}</td>
                    <td class="fixed-right operation-col">
                        <div style="display: flex; gap: 0.25rem; justify-content: center;">
                            <button class="table-action" onclick="viewDetails('${device.sn}')" title="详情">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                    <circle cx="12" cy="12" r="3"></circle>
                                </svg>
                            </button>
                            <button class="table-action" onclick="editDevice('${device.sn}')" title="编辑">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                </svg>
                            </button>
                            <button class="table-action" onclick="deleteDevice('${device.sn}')" title="删除">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="3,6 5,6 21,6"></polyline>
                                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                </svg>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // 获取状态文本
        function getStatusText(status) {
            const statusMap = {
                'online': '在线',
                'offline': '离线',
                'warning': '告警'
            };
            return statusMap[status] || status;
        }

        // 左侧面板收起/展开
        function toggleLeftPanel() {
            const leftPanel = document.querySelector('.left-panel');
            const btn = document.getElementById('leftPanelCollapseBtn');
            
            if (leftPanel.classList.contains('collapsed')) {
                leftPanel.classList.remove('collapsed');
                btn.classList.remove('collapsed');
                btn.title = '收起';
            } else {
                leftPanel.classList.add('collapsed');
                btn.classList.add('collapsed');
                btn.title = '展开';
            }
        }

        // 排序表格
        function sortTable(column, direction) {
            // 更新排序图标
            document.querySelectorAll('.sort-icon').forEach(icon => {
                icon.classList.remove('active');
            });
            
            const sortIcon = document.querySelector(`[data-sort="${column}"] .sort-${direction}`);
            if (sortIcon) {
                sortIcon.classList.add('active');
            }
            
            // 获取当前显示的设备数据
            const devices = selectedStationId ? (devicesByStation[selectedStationId] || []) : allDevices;
            const sortedDevices = [...devices].sort((a, b) => {
                let aVal = a[column];
                let bVal = b[column];
                
                // 处理数值类型
                if (typeof aVal === 'number' && typeof bVal === 'number') {
                    return direction === 'asc' ? aVal - bVal : bVal - aVal;
                }
                
                // 处理字符串类型
                if (typeof aVal === 'string' && typeof bVal === 'string') {
                    return direction === 'asc' ? aVal.localeCompare(bVal) : bVal.localeCompare(aVal);
                }
                
                return 0;
            });
            
            currentSort = { column, direction };
            renderDeviceTable(sortedDevices);
        }

        // 搜索设备
        function searchDevices() {
            const nameInput = document.getElementById('device-name-search').value.toLowerCase();
            const statusInput = document.getElementById('device-status-search').value;
            
            // 如果选中了电站，只搜索该电站的设备；否则搜索所有设备
            const devices = selectedStationId ? (devicesByStation[selectedStationId] || []) : allDevices;
            
            const filteredDevices = devices.filter(device => {
                const nameMatch = !nameInput || device.name.toLowerCase().includes(nameInput);
                const statusMatch = !statusInput || device.status === statusInput;
                
                return nameMatch && statusMatch;
            });
            
            renderDeviceTable(filteredDevices);
        }

        // 重置搜索
        function resetSearch() {
            document.getElementById('device-name-search').value = '';
            document.getElementById('device-status-search').value = '';
            
            // 恢复显示：如果有选中电站显示该电站设备，否则显示所有设备
            const devices = selectedStationId ? (devicesByStation[selectedStationId] || []) : allDevices;
            renderDeviceTable(devices);
        }

        // 设备操作函数
        function viewDetails(sn) {
            // 查找设备信息
            const device = allDevices.find(d => d.sn === sn);
            if (!device) {
                showToast('设备不存在');
                return;
            }
            
            // 隐藏设备列表，显示详情
            document.getElementById('device-list-section').style.display = 'none';
            document.getElementById('device-detail-section').style.display = 'block';
            
            // 构建三部分结构
            const detailHTML = `
                <div style="display: flex; flex-direction: column; min-height: calc(100vh - 100px); background: #f8f9fa;">
                    <!-- 第一部分：顶部信息栏 -->
                    <div class="device-detail-header" style="background: white; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
                        <div style="max-width: 1400px; margin: 0 auto; padding: 20px 24px;">
                            <div style="display: flex; align-items: center; gap: 20px;">
                                <!-- 返回按钮 -->
                                <button class="back-btn" onclick="backToDeviceList()" 
                                    style="padding: 8px 16px; border: 1px solid #e2e8f0; border-radius: 6px; background: white; cursor: pointer; display: flex; align-items: center; gap: 8px; font-size: 14px; color: #374151; transition: all 0.2s;"
                                    onmouseover="this.style.background='#f3f4f6'; this.style.borderColor='#d1d5db'" 
                                    onmouseout="this.style.background='white'; this.style.borderColor='#e2e8f0'">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M10 12L6 8L10 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                    <span>返回</span>
                                </button>
                                
                                <!-- 设备名称 -->
                                <h2 style="margin: 0; font-size: 20px; font-weight: 600; color: #1e293b;">${device.name || device.sn}</h2>
                                
                                <!-- 右侧状态信息 -->
                                <div style="display: flex; align-items: center; gap: 20px; margin-left: auto;">
                                    <!-- 通讯状态 -->
                                    <div style="display: flex; align-items: center; gap: 8px;">
                                        <span style="font-size: 14px; color: #6b7280;">通讯：</span>
                                        <div style="display: flex; align-items: center; gap: 4px;">
                                            <div style="width: 3px; height: 8px; background: #10b981; border-radius: 1px;"></div>
                                            <div style="width: 3px; height: 12px; background: #10b981; border-radius: 1px;"></div>
                                            <div style="width: 3px; height: 16px; background: #10b981; border-radius: 1px;"></div>
                                            <div style="width: 3px; height: 12px; background: #10b981; border-radius: 1px;"></div>
                                            <div style="width: 3px; height: 8px; background: #10b981; border-radius: 1px;"></div>
                                        </div>
                                    </div>
                                    
                                    <!-- 设备状态 -->
                                    <div style="display: flex; align-items: center; gap: 8px;">
                                        <span style="font-size: 14px; color: #6b7280;">状态：</span>
                                        <div style="display: flex; align-items: center; gap: 6px;">
                                            <div style="width: 8px; height: 8px; border-radius: 50%; background: #10b981;"></div>
                                            <span style="font-size: 14px; color: #10b981; font-weight: 500;">在线</span>
                                        </div>
                                    </div>
                                    
                                    <!-- 馈电状态 -->
                                    <div class="power-status-badge feeding" 
                                        style="display: flex; align-items: center; gap: 4px; padding: 6px 12px; border-radius: 999px; background: #dcfce7; border: 1px solid #bbf7d0;">
                                        <div style="width: 6px; height: 6px; border-radius: 50%; background: #16a34a;"></div>
                                        <span style="font-size: 14px; color: #16a34a; font-weight: 500;">馈电</span>
                                    </div>
                                    
                                    <!-- 运行模式选择 -->
                                    <select style="padding: 6px 12px; border: 1px solid #d1d5db; border-radius: 6px; background: white; color: #374151; font-size: 14px; cursor: pointer;" 
                                        onchange="switchDetailMode(this.value)">
                                        <option value="self-consumption">自发自用</option>
                                        <option value="time-plan">时间计划</option>
                                        <option value="backup-mode">备电模式</option>
                                        <option value="force-mode" selected>强制模式</option>
                                        <option value="vpp-dispatch">VPP调度</option>
                                        <option value="ai-mode">AI模式</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 第二部分：Tab导航栏 -->
                    <div class="device-detail-tabs" style="background: white; border-bottom: 2px solid #e2e8f0; position: sticky; top: 0; z-index: 10;">
                        <div style="max-width: 1400px; margin: 0 auto;">
                            <div class="detail-tabs" style="padding: 0 24px;">
                                <button class="tab-button active" onclick="switchInlineDetailTab('overview')">概览</button>
                                <button class="tab-button" onclick="switchInlineDetailTab('devices')">设备</button>
                                <button class="tab-button" onclick="switchInlineDetailTab('operation')">运行数据</button>
                                <button class="tab-button" onclick="switchInlineDetailTab('alarms')">告警</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 第三部分：内容区域 -->
                    <div class="device-detail-content" style="flex: 1; padding: 20px;">
                        <div style="max-width: 1400px; margin: 0 auto; background: white; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                            <div style="padding: 24px;">
                                ${document.querySelector('#device-detail-modal .modal-body > div:last-child').innerHTML}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('device-detail-section').innerHTML = detailHTML;
            
            // 初始化能量流图
            setTimeout(() => {
                createDetailEnergyFlowLines();
                updateDetailEnergyFlow();
            }, 100);
        }
        
        function backToDeviceList() {
            // 显示设备列表，隐藏详情
            document.getElementById('device-list-section').style.display = 'block';
            document.getElementById('device-detail-section').style.display = 'none';
        }
        
        // 为内联详情添加单独的tab切换函数
        function switchInlineDetailTab(tabName) {
            // 更新Tab按钮状态
            document.querySelectorAll('#device-detail-section .detail-tabs .tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // 找到被点击的按钮并激活
            const clickedButton = document.querySelector(`#device-detail-section .detail-tabs button[onclick="switchInlineDetailTab('${tabName}')"]`);
            if (clickedButton) {
                clickedButton.classList.add('active');
            }
            
            // 切换内容
            document.querySelectorAll('#device-detail-section .tab-content').forEach(content => {
                content.classList.remove('active');
            });
            const targetTab = document.getElementById('detail-' + tabName + '-tab');
            if (targetTab) {
                targetTab.classList.add('active');
            }
        }
        
        // 创建详情能量流线
        function createDetailEnergyFlowLines() {
            const svg = document.getElementById('detail-energy-flow-svg');
            if (!svg) {
                return;
            }
            
            // 设置SVG内容 - 调整视图框大小
            svg.setAttribute('viewBox', '0 0 800 500');
            svg.innerHTML = `
                <!-- 定义渐变色 -->
                <defs>
                    <linearGradient id="pvGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" style="stop-color:#3562E3;stop-opacity:0.8" />
                        <stop offset="100%" style="stop-color:#3562E3;stop-opacity:0.3" />
                    </linearGradient>
                    <linearGradient id="gridGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="0%" style="stop-color:#10b981;stop-opacity:0.8" />
                        <stop offset="100%" style="stop-color:#10b981;stop-opacity:0.3" />
                    </linearGradient>
                </defs>
                
                <!-- 光伏到负载 - 垂直线 -->
                <line x1="400" y1="120" x2="400" y2="210" stroke="#EDEDED" stroke-width="10" stroke-linecap="round" />
                <line x1="400" y1="120" x2="400" y2="210" stroke="url(#pvGradient)" stroke-width="10" stroke-linecap="round" 
                      stroke-dasharray="40 10" opacity="0.8">
                    <animate attributeName="stroke-dashoffset" from="0" to="-50" dur="2s" repeatCount="indefinite" />
                </line>
                
                <!-- 储能到光伏 - 左侧曲线 -->
                <path d="M 150 350 L 150 100 Q 150 80 170 80 L 320 80" 
                      stroke="#EDEDED" stroke-width="10" fill="none" stroke-linecap="round" />
                
                <!-- 光伏到电网 - 右侧曲线 -->
                <path d="M 480 80 L 630 80 Q 650 80 650 100 L 650 350" 
                      stroke="#EDEDED" stroke-width="10" fill="none" stroke-linecap="round" />
                
                <!-- 负载到储能 - 左下曲线 -->
                <path d="M 380 290 L 380 380 Q 380 400 360 400 L 200 400" 
                      stroke="#EDEDED" stroke-width="10" fill="none" stroke-linecap="round" />
                
                <!-- 负载到电网 - 右下曲线 -->
                <path d="M 420 290 L 420 380 Q 420 400 440 400 L 600 400" 
                      stroke="#EDEDED" stroke-width="10" fill="none" stroke-linecap="round" />
                <path d="M 420 290 L 420 380 Q 420 400 440 400 L 600 400" 
                      stroke="url(#gridGradient)" stroke-width="10" fill="none" stroke-linecap="round" 
                      stroke-dasharray="40 10" opacity="0.8">
                    <animate attributeName="stroke-dashoffset" from="0" to="-50" dur="2s" repeatCount="indefinite" />
                </path>
                
                <!-- 储能到电网 - 底部横线 -->
                <line x1="200" y1="420" x2="600" y2="420" stroke="#EDEDED" stroke-width="10" stroke-linecap="round" />
                
                <!-- 动画线段 -->
                <line x1="0" y1="-10" x2="0" y2="10" stroke="#5C85FF" stroke-width="4" stroke-linecap="round">
                    <animateMotion dur="2s" repeatCount="indefinite">
                        <mpath href="#pvToLoad"/>
                    </animateMotion>
                </line>
                <path id="pvToLoad" d="M 500 130 L 500 250" style="display:none;" />
                
                <!-- 功率文字 -->
                <text x="515" y="190" fill="#5C85FF" font-size="14" font-weight="600">7.5 kW</text>
            `;
        }
        
        // 更新详情能量流数据
        function updateDetailEnergyFlow() {
            // 模拟动态数据
            const soc = Math.floor(Math.random() * 20 + 75); // 75-95%
            
            // 更新SOC显示
            document.getElementById('detail-soc-display').textContent = soc + '%';
            const batteryLevel = document.getElementById('detail-battery-level');
            if (batteryLevel) {
                batteryLevel.style.width = soc + '%';
                
                // 根据电量设置颜色
                if (soc > 60) {
                    batteryLevel.style.background = '#10b981'; // 绿色
                } else if (soc > 30) {
                    batteryLevel.style.background = '#f59e0b'; // 橙色
                } else {
                    batteryLevel.style.background = '#ef4444'; // 红色
                }
            }
        }
        
        // 切换详情Tab
        function switchDetailTab(tabName) {
            // 更新Tab按钮状态
            document.querySelectorAll('.detail-tabs .tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // 找到被点击的按钮并激活
            const clickedButton = document.querySelector(`.detail-tabs button[onclick="switchDetailTab('${tabName}')"]`);
            if (clickedButton) {
                clickedButton.classList.add('active');
            }
            
            // 切换内容
            document.querySelectorAll('#device-detail-modal .tab-content').forEach(content => {
                content.classList.remove('active');
            });
            const targetTab = document.getElementById('detail-' + tabName + '-tab');
            if (targetTab) {
                targetTab.classList.add('active');
            }
        }
        
        // 切换详情设置面板
        function toggleDetailSettingsPanel() {
            const panel = document.getElementById('detail-settings-panel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }
        
        // 切换详情模式
        function switchDetailMode(mode) {
            console.log('切换设备模式:', mode);
        }

        function editDevice(sn) {
            // 查找设备数据
            const device = allDevices.find(d => d.sn === sn);
            if (!device) {
                showToast('设备不存在');
                return;
            }
            
            // 设置表单标题
            document.querySelector('#deviceDrawer .drawer-header h3').textContent = '编辑设备';
            
            // 填充表单数据
            const form = document.getElementById('addDeviceForm');
            
            // 查找电站ID
            let stationId = '';
            for (const [id, devices] of Object.entries(devicesByStation)) {
                if (devices.some(d => d.sn === sn)) {
                    stationId = id;
                    break;
                }
            }
            
            form.station.value = stationId;
            form.deviceName.value = device.name;
            form.deviceSn.value = device.sn;
            form.deviceSn.readOnly = true; // 编辑时SN不可修改
            form.deviceType.value = device.type || 'inverter';
            form.status.value = device.enabled !== false ? 'enabled' : 'disabled';
            form.description.value = device.description || '';
            
            // 保存编辑状态
            form.dataset.editMode = 'true';
            form.dataset.editSn = sn;
            
            openDrawer();
        }

        let deleteDeviceSn = null;
        
        function deleteDevice(sn) {
            const device = allDevices.find(d => d.sn === sn);
            if (!device) {
                showToast('设备不存在');
                return;
            }
            
            deleteDeviceSn = sn;
            document.getElementById('deleteDeviceName').textContent = device.name;
            document.getElementById('deleteConfirmModal').style.display = 'flex';
        }
        
        function confirmDelete() {
            if (deleteDeviceSn) {
                console.log('删除设备:', deleteDeviceSn);
                showToast('设备删除成功');
                
                // 关闭弹窗
                cancelDelete();
                
                // 刷新表格（实际应该调用API删除后刷新）
                const devices = selectedStationId ? (devicesByStation[selectedStationId] || []) : allDevices;
                renderDeviceTable(devices);
            }
        }
        
        function cancelDelete() {
            deleteDeviceSn = null;
            document.getElementById('deleteConfirmModal').style.display = 'none';
        }
        
        // 关闭设备详情弹窗
        function closeDeviceDetailModal() {
            // 保留原方法以兼容其他调用
            document.getElementById('device-detail-modal').style.display = 'none';
        }
        
        // 选择时间范围
        function selectTimeRange(range) {
            // 更新按钮状态
            document.querySelectorAll('.time-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // 根据选择的时间范围加载数据
            console.log('选择时间范围：', range);
            // 这里可以根据时间范围重新加载数据
        }
        
        // 查看设备详情
        function viewDeviceDetail(deviceName) {
            console.log('查看设备详情：', deviceName);
            // 可以跳转到具体设备页面或显示详情弹窗
        }
        
        // 确认告警
        function acknowledgeAlarm(alarmCode) {
            console.log('确认告警：', alarmCode);
            // 更新告警状态
            showToast('告警已确认');
        }
        
        // 进入设备监控页面
        function goToDeviceMonitoring() {
            const deviceSn = document.getElementById('detail-sn').textContent;
            const deviceName = document.getElementById('detail-name').textContent;
            // 跳转到监控页面
            window.location.href = `./device-detail.html?deviceId=${encodeURIComponent(deviceSn)}&name=${encodeURIComponent(deviceName)}`;
        }
        
        // 全屏查看图片
        let currentScale = 1;
        let isDragging = false;
        let currentX;
        let currentY;
        let initialX;
        let initialY;
        let xOffset = 0;
        let yOffset = 0;
        
        function openFullscreenImage() {
            const modal = document.getElementById('fullscreen-modal');
            const fullscreenImage = document.getElementById('fullscreen-image');
            const topologyImage = document.getElementById('topology-image');
            
            fullscreenImage.src = topologyImage.src;
            modal.style.display = 'flex';
            
            // 重置缩放和位置
            currentScale = 1;
            xOffset = 0;
            yOffset = 0;
            updateImageTransform();
            updateZoomInfo();
        }
        
        function closeFullscreenImage() {
            document.getElementById('fullscreen-modal').style.display = 'none';
        }
        
        function zoomIn() {
            currentScale = Math.min(currentScale * 1.2, 5);
            updateImageTransform();
            updateZoomInfo();
        }
        
        function zoomOut() {
            currentScale = Math.max(currentScale * 0.8, 0.5);
            updateImageTransform();
            updateZoomInfo();
        }
        
        function resetZoom() {
            currentScale = 1;
            xOffset = 0;
            yOffset = 0;
            updateImageTransform();
            updateZoomInfo();
        }
        
        function updateImageTransform() {
            const image = document.getElementById('fullscreen-image');
            image.style.transform = `translate(${xOffset}px, ${yOffset}px) scale(${currentScale})`;
        }
        
        function updateZoomInfo() {
            document.getElementById('zoom-info').textContent = Math.round(currentScale * 100) + '%';
        }
        
        // 拖拽功能
        document.addEventListener('DOMContentLoaded', function() {
            const fullscreenImage = document.getElementById('fullscreen-image');
            
            fullscreenImage.addEventListener('mousedown', dragStart);
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', dragEnd);
            
            // 鼠标滚轮缩放
            fullscreenImage.addEventListener('wheel', function(e) {
                e.preventDefault();
                const delta = e.deltaY > 0 ? 0.9 : 1.1;
                currentScale = Math.min(Math.max(currentScale * delta, 0.5), 5);
                updateImageTransform();
                updateZoomInfo();
            });
        });
        
        function dragStart(e) {
            if (currentScale > 1) {
                initialX = e.clientX - xOffset;
                initialY = e.clientY - yOffset;
                
                if (e.target === document.getElementById('fullscreen-image')) {
                    isDragging = true;
                    e.target.classList.add('grabbing');
                }
            }
        }
        
        function dragEnd(e) {
            initialX = currentX;
            initialY = currentY;
            
            isDragging = false;
            document.getElementById('fullscreen-image').classList.remove('grabbing');
        }
        
        function drag(e) {
            if (isDragging) {
                e.preventDefault();
                currentX = e.clientX - initialX;
                currentY = e.clientY - initialY;
                
                xOffset = currentX;
                yOffset = currentY;
                
                updateImageTransform();
            }
        }
        
        // 切换设备启用/禁用状态
        function toggleDevice(sn, enabled) {
            console.log(`设备 ${sn} 状态切换为: ${enabled ? '启用' : '禁用'}`);
            // 这里可以添加实际的API调用来更新设备状态
        }

        // 导航函数
        function toggleSidebar() {
            console.log('切换侧边栏');
        }

        function goBack() {
            window.history.back();
        }

        function toggleLanguage() {
            console.log('切换语言');
        }

        function toggleTheme() {
            console.log('切换主题');
        }

        // 设备操作函数
        function addDevice() {
            console.log('新增设备');
            openDrawer();
        }
        
        function otaUpgradeDevices() {
            const selectedDevices = getSelectedDevices();
            if (selectedDevices.length === 0) {
                showToast('请先选择要升级的设备');
                return;
            }
            
            // 显示确认弹窗
            const modal = document.getElementById('otaConfirmModal');
            const deviceList = document.getElementById('confirmDeviceList');
            const deviceCount = document.getElementById('deviceCount');
            
            // 获取选中的设备信息
            const devices = selectedDevices.map(sn => {
                // 从所有设备中找到对应的设备信息
                return allDevices.find(d => d.sn === sn);
            }).filter(Boolean);
            
            deviceCount.textContent = devices.length;
            deviceList.innerHTML = devices.map(device => `
                <div class="device-item">
                    <span>${device.name}</span>
                    <span class="text-gray">${device.sn}</span>
                </div>
            `).join('');
            
            modal.style.display = 'flex';
        }
        
        function importDevices() {
            console.log('导入设备');
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.xlsx,.xls,.csv';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    showToast(`已选择文件: ${file.name}`);
                }
            };
            input.click();
        }
        
        function exportDevices() {
            console.log('导出设备');
            showToast('导出设备数据成功');
        }
        
        // 多选功能
        function toggleAllDevices(checked) {
            const checkboxes = document.querySelectorAll('.device-checkbox');
            checkboxes.forEach(cb => cb.checked = checked);
        }
        
        function updateSelectAll() {
            const checkboxes = document.querySelectorAll('.device-checkbox');
            const selectAll = document.getElementById('selectAllDevices');
            const checkedCount = Array.from(checkboxes).filter(cb => cb.checked).length;
            
            selectAll.checked = checkedCount === checkboxes.length && checkboxes.length > 0;
            selectAll.indeterminate = checkedCount > 0 && checkedCount < checkboxes.length;
        }
        
        function getSelectedDevices() {
            const checkboxes = document.querySelectorAll('.device-checkbox:checked');
            return Array.from(checkboxes).map(cb => cb.value);
        }
        
        // 抽屉功能
        function openDrawer() {
            const drawer = document.getElementById('deviceDrawer');
            const overlay = document.getElementById('drawerOverlay');
            drawer.classList.add('open');
            overlay.classList.add('show');
            document.body.style.overflow = 'hidden';
        }
        
        function closeDrawer() {
            const drawer = document.getElementById('deviceDrawer');
            const overlay = document.getElementById('drawerOverlay');
            const form = document.getElementById('addDeviceForm');
            
            drawer.classList.remove('open');
            overlay.classList.remove('show');
            document.body.style.overflow = '';
            
            // 清空表单
            form.reset();
            
            // 重置编辑状态
            delete form.dataset.editMode;
            delete form.dataset.editSn;
            form.deviceSn.readOnly = false;
            
            // 重置标题
            document.querySelector('#deviceDrawer .drawer-header h3').textContent = '新增设备';
        }
        
        function saveDevice() {
            const form = document.getElementById('addDeviceForm');
            const formData = new FormData(form);
            
            const deviceData = {
                station: formData.get('station'),
                name: formData.get('deviceName'),
                sn: formData.get('deviceSn'),
                type: formData.get('deviceType'),
                status: formData.get('status'),
                description: formData.get('description')
            };
            
            const isEditMode = form.dataset.editMode === 'true';
            
            console.log(isEditMode ? '更新设备:' : '保存设备:', deviceData);
            showToast(isEditMode ? '设备更新成功' : '设备添加成功');
            closeDrawer();
        }

        // Toast提示功能
        function showToast(message, duration = 3000) {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            toastMessage.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, duration);
        }
        
        // OTA升级相关函数
        function confirmOTA() {
            const modal = document.getElementById('otaConfirmModal');
            modal.style.display = 'none';
            
            // 开始升级
            startOTAUpgrade();
        }
        
        function cancelOTA() {
            const modal = document.getElementById('otaConfirmModal');
            modal.style.display = 'none';
        }
        
        let upgradeInterval = null;
        let upgradeProgress = 0;
        let totalDevices = 0;
        
        function startOTAUpgrade() {
            const selectedDevices = getSelectedDevices();
            totalDevices = selectedDevices.length;
            upgradeProgress = 0;
            
            // 显示进度弹窗
            const progressPopup = document.getElementById('otaProgressPopup');
            progressPopup.classList.add('show');
            
            updateProgress();
            
            // 模拟升级过程
            upgradeInterval = setInterval(() => {
                upgradeProgress++;
                updateProgress();
                
                if (upgradeProgress >= totalDevices) {
                    clearInterval(upgradeInterval);
                    completeUpgrade();
                }
            }, 1000); // 每秒升级一个设备
        }
        
        function updateProgress() {
            document.getElementById('totalCount').textContent = totalDevices;
            document.getElementById('completedCount').textContent = upgradeProgress;
            document.getElementById('remainingCount').textContent = totalDevices - upgradeProgress;
        }
        
        function completeUpgrade() {
            // 隐藏进度弹窗
            document.getElementById('otaProgressPopup').classList.remove('show');
            
            // 显示结果弹窗
            const resultPopup = document.getElementById('otaResultPopup');
            resultPopup.classList.add('show');
            
            // 模拟结果数据
            const successCount = Math.floor(totalDevices * 0.8);
            const failCount = totalDevices - successCount;
            
            document.getElementById('totalResult').textContent = totalDevices;
            document.getElementById('successCount').textContent = successCount;
            document.getElementById('failCount').textContent = failCount;
        }
        
        function closeResult() {
            document.getElementById('otaResultPopup').classList.remove('show');
        }
        
        function showUpgradeDetails() {
            document.getElementById('upgradeDetailsDrawer').classList.add('open');
            document.getElementById('drawerOverlay2').classList.add('show');
            document.body.style.overflow = 'hidden';
            
            // 加载详情数据
            loadUpgradeDetails();
        }
        
        function closeDetailsDrawer() {
            document.getElementById('upgradeDetailsDrawer').classList.remove('open');
            document.getElementById('drawerOverlay2').classList.remove('show');
            document.body.style.overflow = '';
        }
        
        
        function retryAllFailed() {
            const failedDevices = document.querySelectorAll('.status-badge.failed').length;
            showToast(`正在重试 ${failedDevices} 个失败设备的升级`);
            closeDetailsDrawer();
            // 可以重新启动升级流程
        }
        
        // 全局变量存储升级详情数据
        let upgradeDetailsData = [];
        
        // Tab切换函数
        function switchTab(tab) {
            // 更新active tab
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // 显示/隐藏失败重试按钮
            const retryButtonContainer = document.getElementById('retryButtonContainer');
            if (tab === 'failed') {
                retryButtonContainer.style.display = 'flex';
            } else {
                retryButtonContainer.style.display = 'none';
            }
            
            // 显示过滤后的设备
            showDeviceCards(tab);
        }
        
        // 重试单个设备
        function retryUpgrade(sn) {
            showToast(`正在重试设备 ${sn} 的升级...`);
            // 模拟重试
            setTimeout(() => {
                showToast('重试已启动');
            }, 1000);
        }
        
        // 显示设备列表
        function showDeviceCards(filter) {
            const cardsGrid = document.getElementById('deviceCardsGrid');
            let filteredDevices = upgradeDetailsData;
            
            if (filter === 'success') {
                filteredDevices = upgradeDetailsData.filter(d => d.upgradeStatus === 'success');
            } else if (filter === 'failed') {
                filteredDevices = upgradeDetailsData.filter(d => d.upgradeStatus === 'failed');
            }
            
            // 改为简单的列表显示
            cardsGrid.innerHTML = `
                <div class="device-list-container">
                    ${filteredDevices.map(device => `
                        <div class="device-list-item">
                            <span class="device-name">${device.name}</span>
                            <span class="device-sn">${device.sn}</span>
                            <span class="device-status ${device.upgradeStatus === 'failed' ? 'status-failed' : ''}">
                                ${device.upgradeStatus === 'success' ? '成功' : '失败'}
                            </span>
                        </div>
                    `).join('')}
                </div>
            `;
        }
        
        // 更新loadUpgradeDetails函数以保存数据并更新Tab计数
        function loadUpgradeDetails() {
            const statsSection = document.getElementById('statsSection');
            const retryAllBtn = document.getElementById('retryAllBtn');
            const selectedDevices = getSelectedDevices();
            
            // 模拟详情数据
            upgradeDetailsData = selectedDevices.map((sn, index) => {
                const device = allDevices.find(d => d.sn === sn);
                const status = index < Math.floor(selectedDevices.length * 0.8) ? 'success' : 'failed';
                return {
                    ...device,
                    upgradeStatus: status,
                    message: status === 'success' ? '升级成功' : '升级失败：网络超时'
                };
            });
            
            // 统计数据
            const successCount = upgradeDetailsData.filter(d => d.upgradeStatus === 'success').length;
            const failCount = upgradeDetailsData.filter(d => d.upgradeStatus === 'failed').length;
            
            // 更新Tab计数
            document.getElementById('successTabCount').textContent = `(${successCount})`;
            document.getElementById('failedTabCount').textContent = `(${failCount})`;
            
            // 控制重试按钮状态
            retryAllBtn.disabled = failCount === 0;
            
            // 更新统计卡片
            statsSection.innerHTML = `
                <div class="stat-card">
                    <div class="stat-value">${selectedDevices.length}</div>
                    <div class="stat-label">总计</div>
                </div>
                <div class="stat-card success">
                    <div class="stat-value">${successCount}</div>
                    <div class="stat-label">成功</div>
                </div>
                <div class="stat-card fail">
                    <div class="stat-value">${failCount}</div>
                    <div class="stat-label">失败</div>
                </div>
            `;
            
            // 默认显示成功设备
            showDeviceCards('success');
            
            // 确保成功tab是激活状态
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('successTab').classList.add('active');
            
            // 隐藏失败重试按钮（因为默认显示成功tab）
            document.getElementById('retryButtonContainer').style.display = 'none';
        }

        // 页面加载时初始化
        document.addEventListener('DOMContentLoaded', () => {
            renderStationCards();
            // 默认显示所有设备
            renderDeviceTable(allDevices);
            
            // 初始化详情设置面板复选框事件
            const detailCheckboxes = document.querySelectorAll('#detail-settings-panel input[type="checkbox"]');
            detailCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const metricItemName = this.getAttribute('data-detail-metric-item');
                    if (metricItemName) {
                        const metricItem = document.querySelector(`[data-detail-metric-item="${metricItemName}"]`);
                        if (metricItem) {
                            metricItem.style.display = this.checked ? 'flex' : 'none';
                        }
                    }
                });
            });
            
            // 点击外部关闭详情设置面板
            document.addEventListener('click', function(event) {
                const settingsBtn = document.getElementById('detail-settings-btn');
                const settingsPanel = document.getElementById('detail-settings-panel');
                
                if (settingsBtn && settingsPanel && 
                    !settingsBtn.contains(event.target) && 
                    !settingsPanel.contains(event.target)) {
                    settingsPanel.style.display = 'none';
                }
            });
        });
    </script>
    <!-- 右侧抽屉 -->
    <div class="drawer-overlay" id="drawerOverlay" onclick="closeDrawer()"></div>
    <div class="drawer" id="deviceDrawer">
        <div class="drawer-header">
            <h3>新增设备</h3>
            <button class="drawer-close" onclick="closeDrawer()">×</button>
        </div>
        <div class="drawer-body">
            <form id="addDeviceForm">
                <div class="form-group">
                    <label>电站 <span class="required">*</span></label>
                    <select name="station" class="form-input" required>
                        <option value="">请选择电站</option>
                        <option value="ST001">上海工业园储能站</option>
                        <option value="ST002">北京科技园储能站</option>
                        <option value="ST003">深圳产业园储能站</option>
                        <option value="ST004">广州智慧园储能站</option>
                        <option value="ST005">杭州科创园储能站</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>设备名称 <span class="required">*</span></label>
                    <input type="text" name="deviceName" class="form-input" placeholder="请输入设备名称" required>
                </div>
                <div class="form-group">
                    <label>设备SN <span class="required">*</span></label>
                    <input type="text" name="deviceSn" class="form-input" placeholder="请输入设备SN" required>
                </div>
                <div class="form-group">
                    <label>设备类型 <span class="required">*</span></label>
                    <select name="deviceType" class="form-input" required>
                        <option value="">请选择设备类型</option>
                        <option value="inverter">逆变器</option>
                        <option value="pcs">储能变流器</option>
                        <option value="bms">电池管理系统</option>
                        <option value="ems">能量管理系统</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>状态 <span class="required">*</span></label>
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <label style="display: flex; align-items: center; gap: 0.5rem; margin: 0;">
                            <input type="radio" name="status" value="enabled" checked>
                            <span>启用</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem; margin: 0;">
                            <input type="radio" name="status" value="disabled">
                            <span>禁用</span>
                        </label>
                    </div>
                </div>
                <div class="form-group">
                    <label>描述</label>
                    <textarea name="description" class="form-input" rows="3" placeholder="请输入设备描述（选填）"></textarea>
                </div>
            </form>
        </div>
        <div class="drawer-footer">
            <button class="btn-cancel" onclick="closeDrawer()">取消</button>
            <button class="btn-primary" onclick="saveDevice()">保存</button>
        </div>
    </div>
    <!-- Toast提示 -->
    <div class="toast" id="toast">
        <span id="toastMessage"></span>
    </div>
    
    <!-- OTA升级确认弹窗 -->
    <div class="modal" id="otaConfirmModal">
        <div class="modal-content">
            <h3>确认升级</h3>
            <p>确认要对以下 <span id="deviceCount">0</span> 个设备进行OTA升级吗？</p>
            <div class="device-list" id="confirmDeviceList">
                <!-- 设备列表 -->
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" onclick="cancelOTA()">取消</button>
                <button class="btn-primary" onclick="confirmOTA()">确定</button>
            </div>
        </div>
    </div>
    
    <!-- OTA升级进度弹窗 -->
    <div class="progress-popup" id="otaProgressPopup">
        <div class="progress-header">
            <h4>OTA升级中</h4>
        </div>
        <div class="progress-content">
            <div class="progress-item">
                <span>总计：</span>
                <span id="totalCount">0</span>个
            </div>
            <div class="progress-item">
                <span>已完成：</span>
                <span id="completedCount">0</span>个
            </div>
            <div class="progress-item">
                <span>剩余：</span>
                <span id="remainingCount">0</span>个
            </div>
        </div>
    </div>
    
    <!-- OTA升级结果弹窗 -->
    <div class="result-popup" id="otaResultPopup">
        <div class="result-header">
            <h4>升级完成</h4>
            <button class="close-btn" onclick="closeResult()">×</button>
        </div>
        <div class="result-content">
            <div class="result-item">
                <span id="totalResult">0</span>
                <span>总计</span>
            </div>
            <div class="result-item success">
                <span id="successCount">0</span>
                <span>成功</span>
            </div>
            <div class="result-item fail">
                <span id="failCount">0</span>
                <span>失败</span>
            </div>
        </div>
        <div class="result-footer">
            <button class="btn-text" onclick="closeResult()">取消</button>
            <button class="btn-primary-sm" onclick="showUpgradeDetails()">查看详情</button>
        </div>
    </div>
    
    <!-- 升级详情抽屉 -->
    <div class="drawer-overlay" id="drawerOverlay2" onclick="closeDetailsDrawer()"></div>
    <div class="drawer details-drawer" id="upgradeDetailsDrawer">
        <div class="drawer-header">
            <h3>OTA升级详情</h3>
            <button class="drawer-close" onclick="closeDetailsDrawer()">×</button>
        </div>
        <div class="drawer-body">
            <div class="stats-section" id="statsSection">
                <!-- 统计卡片将通过JS动态生成 -->
            </div>
            <div class="details-tabs">
                <button class="tab-btn active" onclick="switchTab('success')" id="successTab">
                    成功 <span id="successTabCount"></span>
                </button>
                <button class="tab-btn" onclick="switchTab('failed')" id="failedTab">
                    失败 <span id="failedTabCount"></span>
                </button>
            </div>
            <div class="table-header" id="retryButtonContainer" style="display: none;">
                <button class="retry-all-btn" id="retryAllBtn" onclick="retryAllFailed()">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M13.333 2.667V6.667H9.333M2.667 13.333V9.333H6.667M12.68 6C11.893 3.373 9.333 1.333 6.467 1.333C3.173 1.333 0.453 4.053 0.453 7.333C0.453 9.12 1.173 10.773 2.32 12.073M3.32 10C4.107 12.627 6.667 14.667 9.533 14.667C12.827 14.667 15.547 11.947 15.547 8.667C15.547 6.88 14.827 5.227 13.68 3.927" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>失败重试</span>
                </button>
            </div>
            <div class="device-cards-grid" id="deviceCardsGrid">
                <!-- 设备卡片将通过JS动态生成 -->
            </div>
        </div>
    </div>
    
    <!-- 删除确认弹窗 -->
    <div class="modal" id="deleteConfirmModal">
        <div class="modal-content">
            <h3>确认删除</h3>
            <p>确认要删除设备 <span id="deleteDeviceName" style="font-weight: 600"></span> 吗？</p>
            <p style="color: #dc2626; font-size: 0.875rem; margin-top: 0.5rem;">删除后无法恢复</p>
            <div class="modal-footer">
                <button class="btn-cancel" onclick="cancelDelete()">取消</button>
                <button class="btn-primary" onclick="confirmDelete()" style="background: #dc2626; border-color: #dc2626;">确认删除</button>
            </div>
        </div>
    </div>
    
    <!-- 设备详情弹窗 -->
    <div class="modal" id="device-detail-modal">
        <div class="modal-content modal-xl">
            <div class="modal-header">
                <div style="display: flex; align-items: center; gap: 20px; flex: 1;">
                    <h3 class="modal-title" id="device-detail-title">设备详情</h3>
                    
                    <!-- 设备状态信息 -->
                    <div style="display: flex; align-items: center; gap: 16px;">
                        <!-- 通讯状态 -->
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span style="font-size: 14px; color: #6b7280;">通讯：</span>
                            <div style="display: flex; align-items: center; gap: 4px;">
                                <div style="width: 3px; height: 8px; background: #10b981; border-radius: 1px;"></div>
                                <div style="width: 3px; height: 12px; background: #10b981; border-radius: 1px;"></div>
                                <div style="width: 3px; height: 16px; background: #10b981; border-radius: 1px;"></div>
                                <div style="width: 3px; height: 12px; background: #10b981; border-radius: 1px;"></div>
                                <div style="width: 3px; height: 8px; background: #10b981; border-radius: 1px;"></div>
                            </div>
                        </div>
                        
                        <!-- 状态 -->
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span style="font-size: 14px; color: #6b7280;">状态：</span>
                            <div style="display: flex; align-items: center; gap: 6px;">
                                <div style="width: 8px; height: 8px; border-radius: 50%; background: #10b981;"></div>
                                <span style="font-size: 14px; color: #10b981; font-weight: 500;">在线</span>
                            </div>
                        </div>
                        
                        <!-- 馈电状态 -->
                        <div class="power-status-badge feeding" style="display: flex; align-items: center; gap: 4px; padding: 6px 12px; border-radius: 999px; background: #dcfce7; border: 1px solid #bbf7d0;">
                            <div style="width: 6px; height: 6px; border-radius: 50%; background: #16a34a;"></div>
                            <span style="font-size: 14px; color: #16a34a; font-weight: 500;">馈电</span>
                        </div>
                        
                        <!-- 运行模式 -->
                        <select style="padding: 6px 12px; border: 1px solid #d1d5db; border-radius: 6px; background: white; color: #374151; font-size: 14px; cursor: pointer;" onchange="switchDetailMode(this.value)">
                            <option value="self-consumption">自发自用</option>
                            <option value="time-plan">时间计划</option>
                            <option value="backup-mode">备电模式</option>
                            <option value="force-mode" selected>强制模式</option>
                            <option value="vpp-dispatch">VPP调度</option>
                            <option value="ai-mode">AI模式</option>
                        </select>
                    </div>
                </div>
                <button class="modal-close" onclick="closeDeviceDetailModal()">×</button>
            </div>
            <div class="modal-body" style="padding: 0;">
                <!-- Tab切换 -->
                <div class="detail-tabs" style="padding: 0 24px; border-bottom: 2px solid #e2e8f0;">
                    <button class="tab-button active" onclick="switchDetailTab('overview')">概览</button>
                    <button class="tab-button" onclick="switchDetailTab('devices')">设备</button>
                    <button class="tab-button" onclick="switchDetailTab('operation')">运行数据</button>
                    <button class="tab-button" onclick="switchDetailTab('alarms')">告警</button>
                </div>
                
                <!-- Tab内容 -->
                <div style="padding: 24px;">
                    <!-- 概览 -->
                    <div class="tab-content active" id="detail-overview-tab">
                        <!-- 能量流图 -->
                        <div class="card energy-flow-card" style="margin-bottom: 1.5rem; padding: 1rem;">
                            <div class="card-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem; padding-bottom: 0.5rem;">
                                <h3 class="card-title" style="margin: 0;">能量图</h3>
                                <div style="position: relative;">
                                    <button id="detail-settings-btn" style="padding: 8px; background: white; border: 1px solid #e0e0e0; border-radius: 6px; cursor: pointer; font-size: 14px; color: #666; display: flex; align-items: center;" onclick="toggleDetailSettingsPanel()">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <circle cx="12" cy="12" r="3"></circle>
                                            <path d="m12 1 0 6m0 6 0 6"></path>
                                            <path d="m1 12 6 0m6 0 6 0"></path>
                                        </svg>
                                        <span style="margin-left: 4px;">设置</span>
                                    </button>
                                    <div id="detail-settings-panel" style="display: none; position: absolute; top: 100%; right: 0; background: white; border: 1px solid #e0e0e0; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); padding: 16px; min-width: 200px; z-index: 1000;">
                                        <div style="font-size: 14px; font-weight: 600; margin-bottom: 12px; color: #333;">显示指标选择</div>
                                        <div style="display: flex; flex-direction: column; gap: 6px;">
                                            <label style="display: flex; align-items: center; gap: 6px; cursor: pointer;">
                                                <input type="checkbox" checked data-detail-metric-item="pv-daily">
                                                <span style="font-size: 13px; color: #666;">日发电量</span>
                                            </label>
                                            <label style="display: flex; align-items: center; gap: 6px; cursor: pointer;">
                                                <input type="checkbox" checked data-detail-metric-item="pv-total">
                                                <span style="font-size: 13px; color: #666;">总发电量</span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card-content">
                                <!-- 能量图和数据指标容器 -->
                                <div class="energy-metrics-container">
                                    <!-- 能量流向图 -->
                                    <div class="energy-flow-diagram">
                                        <!-- SVG 能量流向连线 -->
                                        <svg class="energy-flow-svg" id="detail-energy-flow-svg"></svg>
                                        
                                        <!-- 光伏 -->
                                        <div class="flow-component pv">
                                            <img src="../../光伏.png" alt="光伏面板">
                                            <div class="component-label">光伏</div>
                                        </div>
                                        
                                        <!-- 负载 -->
                                        <div class="flow-component load">
                                            <img src="../../负载.png" alt="负载">
                                            <div class="component-label">负载</div>
                                        </div>
                                        
                                        <!-- 储能 -->
                                        <div class="flow-component storage">
                                            <img src="../../储能柜.png" alt="储能系统">
                                            <div class="component-label">储能</div>
                                            <div class="battery-indicator">
                                                <div class="battery-icon">
                                                    <div class="battery-level" id="detail-battery-level" style="width: 82%"></div>
                                                </div>
                                                <span class="battery-text" id="detail-soc-display">82%</span>
                                            </div>
                                        </div>
                                        
                                        <!-- 电网 -->
                                        <div class="flow-component grid">
                                            <img src="../../电网.png" alt="电网">
                                            <div class="component-label">电网</div>
                                        </div>
                                    </div>
                                    
                                    <!-- 数据指标卡片 -->
                                    <div class="data-metrics-card">
                                        <div class="metrics-section">
                                            <h4 class="metrics-title">光伏</h4>
                                            <div class="metrics-grid">
                                                <div class="metrics-item" data-detail-metric-item="pv-daily">
                                                    <span class="metrics-label">日发电量</span>
                                                    <span class="metrics-value">46.1 kWh</span>
                                                </div>
                                                <div class="metrics-item" data-detail-metric-item="pv-total">
                                                    <span class="metrics-label">总发电量</span>
                                                    <span class="metrics-value">12622 kWh</span>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="metrics-section">
                                            <h4 class="metrics-title">储能</h4>
                                            <div class="metrics-grid">
                                                <div class="metrics-item">
                                                    <span class="metrics-label">日充电量</span>
                                                    <span class="metrics-value">39.8 kWh</span>
                                                </div>
                                                <div class="metrics-item">
                                                    <span class="metrics-label">累计充电量</span>
                                                    <span class="metrics-value">8774 kWh</span>
                                                </div>
                                                <div class="metrics-item">
                                                    <span class="metrics-label">日放电量</span>
                                                    <span class="metrics-value">25.7 kWh</span>
                                                </div>
                                                <div class="metrics-item">
                                                    <span class="metrics-label">累计放电量</span>
                                                    <span class="metrics-value">7347 kWh</span>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="metrics-section">
                                            <h4 class="metrics-title">收益</h4>
                                            <div class="metrics-grid">
                                                <div class="metrics-item">
                                                    <span class="metrics-label">昨日收益</span>
                                                    <span class="metrics-value">¥141.72</span>
                                                </div>
                                                <div class="metrics-item">
                                                    <span class="metrics-label">今日收益</span>
                                                    <span class="metrics-value">¥81.12</span>
                                                </div>
                                                <div class="metrics-item">
                                                    <span class="metrics-label">当月收益</span>
                                                    <span class="metrics-value">¥2518.65</span>
                                                </div>
                                                <div class="metrics-item">
                                                    <span class="metrics-label">累计收益</span>
                                                    <span class="metrics-value">¥40772.62</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                    </div>
                    
                    <!-- 设备 -->
                    <div class="tab-content" id="detail-devices-tab">
                        <div class="device-list">
                            <!-- 设备统计信息 -->
                            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 24px;">
                                <div style="background: #f8fafc; padding: 16px; border-radius: 8px; border: 1px solid #e2e8f0;">
                                    <div style="font-size: 14px; color: #64748b; margin-bottom: 8px;">总设备数</div>
                                    <div style="font-size: 24px; font-weight: 600; color: #1e293b;">5</div>
                                </div>
                                <div style="background: #f8fafc; padding: 16px; border-radius: 8px; border: 1px solid #e2e8f0;">
                                    <div style="font-size: 14px; color: #64748b; margin-bottom: 8px;">在线设备</div>
                                    <div style="font-size: 24px; font-weight: 600; color: #10b981;">4</div>
                                </div>
                                <div style="background: #f8fafc; padding: 16px; border-radius: 8px; border: 1px solid #e2e8f0;">
                                    <div style="font-size: 14px; color: #64748b; margin-bottom: 8px;">告警设备</div>
                                    <div style="font-size: 24px; font-weight: 600; color: #f59e0b;">1</div>
                                </div>
                                <div style="background: #f8fafc; padding: 16px; border-radius: 8px; border: 1px solid #e2e8f0;">
                                    <div style="font-size: 14px; color: #64748b; margin-bottom: 8px;">离线设备</div>
                                    <div style="font-size: 24px; font-weight: 600; color: #ef4444;">0</div>
                                </div>
                            </div>
                            
                            <!-- 设备列表 -->
                            <table class="device-table" style="width: 100%;">
                                <thead>
                                    <tr>
                                        <th>设备名称</th>
                                        <th>设备类型</th>
                                        <th>设备SN</th>
                                        <th>状态</th>
                                        <th>通讯状态</th>
                                        <th>当前功率</th>
                                        <th>额定功率</th>
                                        <th>温度</th>
                                        <th>更新时间</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>PCS-01</td>
                                        <td>储能变流器</td>
                                        <td>PCS2024001234</td>
                                        <td><span class="device-status online">正常</span></td>
                                        <td><span style="color: #10b981;">● 在线</span></td>
                                        <td>225 kW</td>
                                        <td>250 kW</td>
                                        <td>38.5°C</td>
                                        <td>2024-01-20 15:32:45</td>
                                        <td>
                                            <button style="padding: 4px 12px; border: 1px solid #d1d5db; border-radius: 4px; background: white; cursor: pointer; font-size: 12px;" onclick="viewDeviceDetail('PCS-01')">详情</button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>BMS-01</td>
                                        <td>电池管理系统</td>
                                        <td>BMS2024001235</td>
                                        <td><span class="device-status online">正常</span></td>
                                        <td><span style="color: #10b981;">● 在线</span></td>
                                        <td>-</td>
                                        <td>-</td>
                                        <td>28.3°C</td>
                                        <td>2024-01-20 15:32:45</td>
                                        <td>
                                            <button style="padding: 4px 12px; border: 1px solid #d1d5db; border-radius: 4px; background: white; cursor: pointer; font-size: 12px;" onclick="viewDeviceDetail('BMS-01')">详情</button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Battery-01</td>
                                        <td>电池簇</td>
                                        <td>BAT2024001236</td>
                                        <td><span class="device-status online">正常</span></td>
                                        <td><span style="color: #10b981;">● 在线</span></td>
                                        <td>-</td>
                                        <td>215 kWh</td>
                                        <td>26.5°C</td>
                                        <td>2024-01-20 15:32:45</td>
                                        <td>
                                            <button style="padding: 4px 12px; border: 1px solid #d1d5db; border-radius: 4px; background: white; cursor: pointer; font-size: 12px;" onclick="viewDeviceDetail('Battery-01')">详情</button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>EMS-01</td>
                                        <td>能量管理系统</td>
                                        <td>EMS2024001237</td>
                                        <td><span class="device-status online">正常</span></td>
                                        <td><span style="color: #10b981;">● 在线</span></td>
                                        <td>-</td>
                                        <td>-</td>
                                        <td>22.0°C</td>
                                        <td>2024-01-20 15:32:45</td>
                                        <td>
                                            <button style="padding: 4px 12px; border: 1px solid #d1d5db; border-radius: 4px; background: white; cursor: pointer; font-size: 12px;" onclick="viewDeviceDetail('EMS-01')">详情</button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Meter-01</td>
                                        <td>电能表</td>
                                        <td>MTR2024001238</td>
                                        <td><span class="device-status warning">告警</span></td>
                                        <td><span style="color: #f59e0b;">● 通讯异常</span></td>
                                        <td>-</td>
                                        <td>-</td>
                                        <td>-</td>
                                        <td>2024-01-20 15:30:12</td>
                                        <td>
                                            <button style="padding: 4px 12px; border: 1px solid #d1d5db; border-radius: 4px; background: white; cursor: pointer; font-size: 12px;" onclick="viewDeviceDetail('Meter-01')">详情</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- 运行数据 -->
                    <div class="tab-content" id="detail-operation-tab">
                        <!-- 设备选择和刷新 -->
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding: 16px; background: #f8fafc; border-radius: 8px;">
                            <div style="display: flex; gap: 16px; align-items: center;">
                                <label style="font-size: 14px; color: #64748b;">选择设备：</label>
                                <select style="padding: 8px 16px; border: 1px solid #d1d5db; border-radius: 6px; background: white; font-size: 14px; min-width: 200px;">
                                    <option>PCS-01 (储能变流器)</option>
                                    <option>BMS-01 (电池管理系统)</option>
                                    <option>Battery-01 (电池簇)</option>
                                    <option>EMS-01 (能量管理系统)</option>
                                    <option>Meter-01 (电能表)</option>
                                </select>
                            </div>
                            <div style="display: flex; gap: 12px; align-items: center;">
                                <span style="font-size: 13px; color: #94a3b8;">最后更新：<span id="last-update-time">2024-01-20 15:32:45</span></span>
                                <button style="padding: 6px 16px; border: 1px solid #d1d5db; background: white; border-radius: 6px; cursor: pointer; font-size: 14px; display: flex; align-items: center; gap: 6px;">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M23 4v6h-6M1 20v-6h6M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
                                    </svg>
                                    刷新
                                </button>
                            </div>
                        </div>
                        
                        <!-- 设备实时数据 -->
                        <div style="background: white; border-radius: 8px; padding: 24px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                            <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 20px; display: flex; align-items: center; gap: 8px;">
                                <span style="width: 4px; height: 20px; background: #3562E3; border-radius: 2px;"></span>
                                设备实时数据
                            </h3>
                            
                            <!-- PV输入数据 -->
                            <div style="margin-bottom: 24px;">
                                <h4 style="font-size: 16px; font-weight: 600; color: #1e293b; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid #e2e8f0;">组串</h4>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                                    <div>
                                        <table style="width: 100%; font-size: 14px;">
                                            <thead>
                                                <tr style="background: #f8fafc;">
                                                    <th style="padding: 8px 12px; text-align: left; font-weight: 500; color: #64748b;"></th>
                                                    <th style="padding: 8px 12px; text-align: center; font-weight: 500; color: #64748b;">PV1</th>
                                                    <th style="padding: 8px 12px; text-align: center; font-weight: 500; color: #64748b;">PV2</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td style="padding: 8px 12px; color: #64748b;">输入电压(V)</td>
                                                    <td style="padding: 8px 12px; text-align: center; font-weight: 600;">326.6</td>
                                                    <td style="padding: 8px 12px; text-align: center; font-weight: 600;">392.4</td>
                                                </tr>
                                                <tr style="background: #f8fafc;">
                                                    <td style="padding: 8px 12px; color: #64748b;">输入电流(A)</td>
                                                    <td style="padding: 8px 12px; text-align: center; font-weight: 600;">3.39</td>
                                                    <td style="padding: 8px 12px; text-align: center; font-weight: 600;">3.23</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 逆变器状态 -->
                            <div style="margin-bottom: 24px;">
                                <h4 style="font-size: 16px; font-weight: 600; color: #1e293b; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid #e2e8f0;">逆变器状态</h4>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                                    <div style="padding: 12px; background: #f8fafc; border-radius: 6px;">
                                        <div style="font-size: 13px; color: #64748b; margin-bottom: 4px;">状态</div>
                                        <div style="font-size: 15px; font-weight: 600; color: #10b981;">并网</div>
                                    </div>
                                    <div style="padding: 12px; background: #f8fafc; border-radius: 6px;">
                                        <div style="font-size: 13px; color: #64748b; margin-bottom: 4px;">当日发电量</div>
                                        <div style="font-size: 15px; font-weight: 600;">18.66 度</div>
                                    </div>
                                    <div style="padding: 12px; background: #f8fafc; border-radius: 6px;">
                                        <div style="font-size: 13px; color: #64748b; margin-bottom: 4px;">累计发电量</div>
                                        <div style="font-size: 15px; font-weight: 600;">16,270.92 度</div>
                                    </div>
                                    <div style="padding: 12px; background: #f8fafc; border-radius: 6px;">
                                        <div style="font-size: 13px; color: #64748b; margin-bottom: 4px;">有功功率</div>
                                        <div style="font-size: 15px; font-weight: 600;">2.293 kW</div>
                                    </div>
                                    <div style="padding: 12px; background: #f8fafc; border-radius: 6px;">
                                        <div style="font-size: 13px; color: #64748b; margin-bottom: 4px;">无功功率</div>
                                        <div style="font-size: 15px; font-weight: 600;">-0.001 kvar</div>
                                    </div>
                                    <div style="padding: 12px; background: #f8fafc; border-radius: 6px;">
                                        <div style="font-size: 13px; color: #64748b; margin-bottom: 4px;">逆变器额定功率</div>
                                        <div style="font-size: 15px; font-weight: 600;">10.000 kW</div>
                                    </div>
                                    <div style="padding: 12px; background: #f8fafc; border-radius: 6px;">
                                        <div style="font-size: 13px; color: #64748b; margin-bottom: 4px;">功率因数</div>
                                        <div style="font-size: 15px; font-weight: 600;">1.000</div>
                                    </div>
                                    <div style="padding: 12px; background: #f8fafc; border-radius: 6px;">
                                        <div style="font-size: 13px; color: #64748b; margin-bottom: 4px;">电网频率</div>
                                        <div style="font-size: 15px; font-weight: 600;">50.02 Hz</div>
                                    </div>
                                    <div style="padding: 12px; background: #f8fafc; border-radius: 6px;">
                                        <div style="font-size: 13px; color: #64748b; margin-bottom: 4px;">输出方式</div>
                                        <div style="font-size: 15px; font-weight: 600;">三相四线制</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 电网参数 -->
                            <div style="margin-bottom: 24px;">
                                <h4 style="font-size: 16px; font-weight: 600; color: #1e293b; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid #e2e8f0;">电网参数</h4>
                                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px;">
                                    <div>
                                        <div style="font-size: 13px; color: #64748b; margin-bottom: 8px;">电网A相电流</div>
                                        <div style="font-size: 20px; font-weight: 600;">3.329 A</div>
                                    </div>
                                    <div>
                                        <div style="font-size: 13px; color: #64748b; margin-bottom: 8px;">电网B相电流</div>
                                        <div style="font-size: 20px; font-weight: 600;">3.326 A</div>
                                    </div>
                                    <div>
                                        <div style="font-size: 13px; color: #64748b; margin-bottom: 8px;">电网C相电流</div>
                                        <div style="font-size: 20px; font-weight: 600;">3.349 A</div>
                                    </div>
                                    <div>
                                        <div style="font-size: 13px; color: #64748b; margin-bottom: 8px;">电网A相电压</div>
                                        <div style="font-size: 20px; font-weight: 600;">227.3 V</div>
                                    </div>
                                    <div>
                                        <div style="font-size: 13px; color: #64748b; margin-bottom: 8px;">电网B相电压</div>
                                        <div style="font-size: 20px; font-weight: 600;">228.9 V</div>
                                    </div>
                                    <div>
                                        <div style="font-size: 13px; color: #64748b; margin-bottom: 8px;">电网C相电压</div>
                                        <div style="font-size: 20px; font-weight: 600;">229.5 V</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 其他参数 -->
                            <div>
                                <h4 style="font-size: 16px; font-weight: 600; color: #1e293b; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid #e2e8f0;">其他参数</h4>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px;">
                                    <div style="display: flex; justify-content: space-between; padding: 12px; background: #f8fafc; border-radius: 6px;">
                                        <span style="font-size: 13px; color: #64748b;">逆变器开机时间</span>
                                        <span style="font-size: 14px; font-weight: 600;">2025-07-25 05:45:32</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; padding: 12px; background: #f8fafc; border-radius: 6px;">
                                        <span style="font-size: 13px; color: #64748b;">逆变器关机时间</span>
                                        <span style="font-size: 14px; font-weight: 600;">2025-07-24 19:23:18</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; padding: 12px; background: #f8fafc; border-radius: 6px;">
                                        <span style="font-size: 13px; color: #64748b;">内部温度</span>
                                        <span style="font-size: 14px; font-weight: 600;">69.9°C</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; padding: 12px; background: #f8fafc; border-radius: 6px;">
                                        <span style="font-size: 13px; color: #64748b;">绝缘阻值</span>
                                        <span style="font-size: 14px; font-weight: 600;">3.000 MΩ</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; padding: 12px; background: #f8fafc; border-radius: 6px;">
                                        <span style="font-size: 13px; color: #64748b;">有功调节状态</span>
                                        <span style="font-size: 14px; font-weight: 600;">P=59.2% (有功百分比调节)</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; padding: 12px; background: #f8fafc; border-radius: 6px;">
                                        <span style="font-size: 13px; color: #64748b;">无功调节状态</span>
                                        <span style="font-size: 14px; font-weight: 600;">PF=1.000(功率因数)</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; padding: 12px; background: #f8fafc; border-radius: 6px;">
                                        <span style="font-size: 13px; color: #64748b;">RS485-2端口模式</span>
                                        <span style="font-size: 14px; font-weight: 600;">主机模式</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 基础信息 -->
                        <div style="background: white; border-radius: 8px; padding: 24px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); margin-top: 20px;">
                            <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 20px; display: flex; align-items: center; gap: 8px;">
                                <span style="width: 4px; height: 20px; background: #3562E3; border-radius: 2px;"></span>
                                基础信息
                            </h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                                <div style="display: flex; justify-content: space-between; padding: 12px; background: #f8fafc; border-radius: 6px;">
                                    <span style="font-size: 13px; color: #64748b;">设备名称</span>
                                    <span style="font-size: 14px; font-weight: 600;">********88039852</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 12px; background: #f8fafc; border-radius: 6px;">
                                    <span style="font-size: 13px; color: #64748b;">设备类型</span>
                                    <span style="font-size: 14px; font-weight: 600;">逆变器</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 12px; background: #f8fafc; border-radius: 6px;">
                                    <span style="font-size: 13px; color: #64748b;">SN号</span>
                                    <span style="font-size: 14px; font-weight: 600;">******039852</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 12px; background: #f8fafc; border-radius: 6px;">
                                    <span style="font-size: 13px; color: #64748b;">型号</span>
                                    <span style="font-size: 14px; font-weight: 600;">SUN2000-10KTL-M1</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 12px; background: #f8fafc; border-radius: 6px;">
                                    <span style="font-size: 13px; color: #64748b;">软件版本号</span>
                                    <span style="font-size: 14px; font-weight: 600;">V100R001C00SPC152</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 12px; background: #f8fafc; border-radius: 6px;">
                                    <span style="font-size: 13px; color: #64748b;">换机历史</span>
                                    <span style="font-size: 14px; font-weight: 600;">--</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 12px; background: #f8fafc; border-radius: 6px;">
                                    <span style="font-size: 13px; color: #64748b;">软件包名称</span>
                                    <span style="font-size: 14px; font-weight: 600;">--</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 告警 -->
                    <div class="tab-content" id="detail-alarms-tab">
                        <!-- 告警统计 -->
                        <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 16px; margin-bottom: 24px;">
                            <div style="background: #fee2e2; padding: 16px; border-radius: 8px; border: 1px solid #fecaca;">
                                <div style="font-size: 14px; color: #dc2626; margin-bottom: 8px;">紧急告警</div>
                                <div style="font-size: 24px; font-weight: 600; color: #dc2626;">0</div>
                            </div>
                            <div style="background: #fef3c7; padding: 16px; border-radius: 8px; border: 1px solid #fde68a;">
                                <div style="font-size: 14px; color: #d97706; margin-bottom: 8px;">主要告警</div>
                                <div style="font-size: 24px; font-weight: 600; color: #d97706;">1</div>
                            </div>
                            <div style="background: #fef9c3; padding: 16px; border-radius: 8px; border: 1px solid #fef08a;">
                                <div style="font-size: 14px; color: #ca8a04; margin-bottom: 8px;">次要告警</div>
                                <div style="font-size: 24px; font-weight: 600; color: #ca8a04;">3</div>
                            </div>
                            <div style="background: #dbeafe; padding: 16px; border-radius: 8px; border: 1px solid #bfdbfe;">
                                <div style="font-size: 14px; color: #2563eb; margin-bottom: 8px;">提示告警</div>
                                <div style="font-size: 24px; font-weight: 600; color: #2563eb;">5</div>
                            </div>
                            <div style="background: #f0f9ff; padding: 16px; border-radius: 8px; border: 1px solid #e0f2fe;">
                                <div style="font-size: 14px; color: #0284c7; margin-bottom: 8px;">已清除</div>
                                <div style="font-size: 24px; font-weight: 600; color: #0284c7;">12</div>
                            </div>
                        </div>
                        
                        <!-- 筛选器 -->
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <div style="display: flex; gap: 12px; align-items: center;">
                                <select style="padding: 6px 12px; border: 1px solid #d1d5db; border-radius: 6px; background: white; font-size: 14px;">
                                    <option>全部级别</option>
                                    <option>紧急</option>
                                    <option>主要</option>
                                    <option>次要</option>
                                    <option>提示</option>
                                </select>
                                <select style="padding: 6px 12px; border: 1px solid #d1d5db; border-radius: 6px; background: white; font-size: 14px;">
                                    <option>全部状态</option>
                                    <option>活动</option>
                                    <option>已清除</option>
                                </select>
                                <select style="padding: 6px 12px; border: 1px solid #d1d5db; border-radius: 6px; background: white; font-size: 14px;">
                                    <option>全部设备</option>
                                    <option>PCS-01</option>
                                    <option>BMS-01</option>
                                    <option>Battery-01</option>
                                    <option>EMS-01</option>
                                    <option>Meter-01</option>
                                </select>
                                <input type="date" style="padding: 6px 12px; border: 1px solid #d1d5db; border-radius: 6px; background: white; font-size: 14px;" value="2024-01-20">
                            </div>
                            <button style="padding: 6px 16px; background: #3562E3; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px;">导出告警</button>
                        </div>
                        
                        <!-- 告警列表 -->
                        <div class="alarm-list">
                            <table class="alarm-table" style="width: 100%;">
                                <thead>
                                    <tr>
                                        <th style="width: 160px;">告警时间</th>
                                        <th style="width: 100px;">设备</th>
                                        <th style="width: 80px;">级别</th>
                                        <th style="width: 100px;">告警代码</th>
                                        <th>告警内容</th>
                                        <th style="width: 100px;">当前值</th>
                                        <th style="width: 100px;">阈值</th>
                                        <th style="width: 80px;">状态</th>
                                        <th style="width: 160px;">清除时间</th>
                                        <th style="width: 100px;">操作</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>2024-01-20 15:28:45</td>
                                        <td>Meter-01</td>
                                        <td><span class="alarm-level" style="background: #fef3c7; color: #d97706;">主要</span></td>
                                        <td>MTR_COMM_01</td>
                                        <td>电能表通讯异常</td>
                                        <td>-</td>
                                        <td>-</td>
                                        <td><span style="color: #dc2626;">活动</span></td>
                                        <td>-</td>
                                        <td>
                                            <button style="padding: 4px 12px; border: 1px solid #d1d5db; border-radius: 4px; background: white; cursor: pointer; font-size: 12px;" onclick="acknowledgeAlarm('MTR_COMM_01')">确认</button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>2024-01-20 14:52:30</td>
                                        <td>PCS-01</td>
                                        <td><span class="alarm-level" style="background: #fef9c3; color: #ca8a04;">次要</span></td>
                                        <td>PCS_TEMP_01</td>
                                        <td>PCS温度过高</td>
                                        <td>42.5°C</td>
                                        <td>40°C</td>
                                        <td><span style="color: #dc2626;">活动</span></td>
                                        <td>-</td>
                                        <td>
                                            <button style="padding: 4px 12px; border: 1px solid #d1d5db; border-radius: 4px; background: white; cursor: pointer; font-size: 12px;" onclick="acknowledgeAlarm('PCS_TEMP_01')">确认</button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>2024-01-20 14:23:15</td>
                                        <td>PCS-01</td>
                                        <td><span class="alarm-level" style="background: #fef9c3; color: #ca8a04;">次要</span></td>
                                        <td>PCS_VOL_01</td>
                                        <td>直流侧电压偏高</td>
                                        <td>765V</td>
                                        <td>760V</td>
                                        <td><span style="color: #10b981;">已清除</span></td>
                                        <td>2024-01-20 14:25:30</td>
                                        <td>-</td>
                                    </tr>
                                    <tr>
                                        <td>2024-01-20 13:45:20</td>
                                        <td>Battery-01</td>
                                        <td><span class="alarm-level" style="background: #dbeafe; color: #2563eb;">提示</span></td>
                                        <td>BAT_SOC_01</td>
                                        <td>电池SOC低</td>
                                        <td>15%</td>
                                        <td>20%</td>
                                        <td><span style="color: #10b981;">已清除</span></td>
                                        <td>2024-01-20 14:10:15</td>
                                        <td>-</td>
                                    </tr>
                                    <tr>
                                        <td>2024-01-20 12:30:45</td>
                                        <td>BMS-01</td>
                                        <td><span class="alarm-level" style="background: #fef9c3; color: #ca8a04;">次要</span></td>
                                        <td>BMS_TEMP_02</td>
                                        <td>电池温度差异过大</td>
                                        <td>5.2°C</td>
                                        <td>5°C</td>
                                        <td><span style="color: #dc2626;">活动</span></td>
                                        <td>-</td>
                                        <td>
                                            <button style="padding: 4px 12px; border: 1px solid #d1d5db; border-radius: 4px; background: white; cursor: pointer; font-size: 12px;" onclick="acknowledgeAlarm('BMS_TEMP_02')">确认</button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>2024-01-20 11:15:30</td>
                                        <td>EMS-01</td>
                                        <td><span class="alarm-level" style="background: #dbeafe; color: #2563eb;">提示</span></td>
                                        <td>EMS_COMM_01</td>
                                        <td>与云平台通讯中断</td>
                                        <td>-</td>
                                        <td>-</td>
                                        <td><span style="color: #10b981;">已清除</span></td>
                                        <td>2024-01-20 11:18:45</td>
                                        <td>-</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="goToDeviceMonitoring()">进入监控</button>
                <button class="btn btn-cancel" onclick="closeDeviceDetailModal()">关闭</button>
            </div>
        </div>
    </div>
    
    <!-- 全屏查看模态框 -->
    <div class="fullscreen-modal" id="fullscreen-modal">
        <div class="fullscreen-content">
            <img src="" alt="全屏查看" class="fullscreen-image" id="fullscreen-image">
            <button class="fullscreen-close" onclick="closeFullscreenImage()">×</button>
            <div class="zoom-controls">
                <button class="zoom-btn" onclick="zoomOut()" title="缩小">-</button>
                <button class="zoom-btn" onclick="resetZoom()" title="重置">⌖</button>
                <div class="zoom-info" id="zoom-info">100%</div>
                <button class="zoom-btn" onclick="zoomIn()" title="放大">+</button>
            </div>
        </div>
    </div>
</body>
</html>
