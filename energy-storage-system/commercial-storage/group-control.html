<!DOCTYPE html>
<html lang="zh-CN" id="html-root">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ËÆæÂ§áÁæ§Êéß - Â∑•ÂïÜÂÇ®ËÉΩÁÆ°ÁêÜÁ≥ªÁªü</title>
    <link rel="stylesheet" href="./sidebar.css">
    <style>
        /* ÂÖ®Â±ÄÊ†∑Âºè */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #EBEDF4;
            color: #1e293b;
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* ‰∏ªÂÜÖÂÆπÂå∫Âüü */
        .main-content {
            margin-left: 240px;
            min-height: 100vh;
            background: #EBEDF4;
        }

        /* È°∂ÈÉ®ÂØºËà™Ê†è */
        .navbar {
            background: white;
            border-bottom: 1px solid #e2e8f0;
            padding: 0 2rem;
            height: 64px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 50;
        }

        .navbar-left {
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .page-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1e293b;
        }

        .navbar-right {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .nav-button {
            padding: 0.5rem 1rem;
            border: 1px solid #e2e8f0;
            background: white;
            border-radius: 0.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            color: #64748b;
            transition: all 150ms ease;
        }

        .nav-button:hover {
            background: #f8fafc;
            border-color: #cbd5e1;
            color: #1e293b;
        }

        /* ÂÜÖÂÆπÂå∫Âüü */
        .content {
            padding: 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* È°µÈù¢Â§¥ÈÉ® */
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .page-header-left h2 {
            font-size: 1.5rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 0.5rem;
        }

        .page-subtitle {
            color: #64748b;
            font-size: 0.875rem;
        }

        .page-header-right {
            display: flex;
            gap: 1rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: #3562E3;
            color: white;
        }

        .btn-primary:hover {
            background: #2951d9;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        /* ËÆæÂ§áÂàÜÁªÑÂç°ÁâáÁΩëÊ†º */
        .group-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .group-card {
            background: white;
            border-radius: 0.75rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }

        .group-card:hover {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        .group-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            position: relative;
        }

        .group-name {
            font-size: 1.125rem;
            font-weight: 600;
            color: #1e293b;
        }
        
        /* Âà†Èô§ÊåâÈíÆÊ†∑Âºè */
        .delete-btn {
            position: absolute;
            right: 0;
            top: 0;
            background: none;
            border: none;
            color: #94a3b8;
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 0.375rem;
            transition: all 0.2s ease;
        }
        
        .delete-btn:hover {
            color: #ef4444;
            background: #fee2e2;
        }
        
        .delete-btn svg {
            width: 16px;
            height: 16px;
        }

        .group-status {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .group-status.active {
            background: #d1fae5;
            color: #059669;
        }

        .group-status.inactive {
            background: #fee2e2;
            color: #dc2626;
        }

        .group-status.partial {
            background: #fef3c7;
            color: #d97706;
        }

        .status-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: currentColor;
        }

        .group-info {
            margin-bottom: 1.5rem;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid #f3f4f6;
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            font-size: 0.875rem;
            color: #64748b;
        }

        .info-value {
            font-size: 0.875rem;
            font-weight: 500;
            color: #374151;
        }

        .device-names {
            font-size: 0.75rem;
            color: #64748b;
            white-space: normal;
            line-height: 1.3;
        }

        .group-actions {
            display: flex;
            gap: 0.75rem;
            margin-top: 1rem;
        }

        .action-btn {
            flex: 1;
            padding: 0.5rem 1rem;
            border: 1px solid #e2e8f0;
            background: white;
            color: #374151;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .action-btn:hover {
            background: #f9fafb;
            border-color: #d1d5db;
        }

        .action-btn.primary {
            background: #3562E3;
            color: white;
            border-color: #3562E3;
        }

        .action-btn.primary:hover {
            background: #2951d9;
        }

        /* ÊéßÂà∂ÂºπÁ™ó */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 0.75rem;
            width: 90%;
            max-width: 1200px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1e293b;
        }

        .modal-close {
            width: 32px;
            height: 32px;
            border: none;
            background: transparent;
            color: #6b7280;
            font-size: 1.5rem;
            cursor: pointer;
            border-radius: 0.375rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            background: #f3f4f6;
            color: #1f2937;
        }

        .modal-body {
            padding: 1.5rem;
        }

        /* ÊéßÂà∂Èù¢ÊùøÊ†∑Âºè - Â§çÁî®control.htmlÁöÑÊ†∑Âºè */
        .control-sections {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .control-section {
            background: #f8fafc;
            border-radius: 0.5rem;
            padding: 1.5rem;
            border: 1px solid #e2e8f0;
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }

        .section-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #1e293b;
        }

        /* Â∑•‰ΩúÊ®°ÂºèÁΩëÊ†º */
        .work-mode-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .mode-card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            padding: 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .mode-card:hover {
            border-color: #3562E3;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .mode-card.active {
            border-color: #3562E3;
            background: #eff6ff;
        }

        .mode-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .mode-title {
            font-size: 1rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 0.25rem;
        }

        .mode-desc {
            font-size: 0.875rem;
            color: #64748b;
        }

        .mode-check {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            width: 1.5rem;
            height: 1.5rem;
            background: #3562E3;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .mode-card.active .mode-check {
            opacity: 1;
        }

        /* ÊéßÂà∂ÁΩëÊ†º */
        .control-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .control-item {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .control-label {
            font-size: 0.875rem;
            color: #64748b;
            font-weight: 500;
        }

        .control-value {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .control-input {
            flex: 1;
            padding: 0.5rem 0.75rem;
            border: 1px solid #e2e8f0;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            transition: all 0.2s ease;
        }

        .control-input:focus {
            outline: none;
            border-color: #3562E3;
            box-shadow: 0 0 0 2px rgba(53, 98, 227, 0.1);
        }

        .control-unit {
            font-size: 0.875rem;
            color: #64748b;
        }

        /* ÂºÄÂÖ≥Êéß‰ª∂ */
        .switch {
            position: relative;
            width: 44px;
            height: 24px;
            background: #e2e8f0;
            border-radius: 12px;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .switch.active {
            background: #3562E3;
        }

        .switch-handle {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: left 0.2s ease;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .switch.active .switch-handle {
            left: 22px;
        }

        /* ÊªëÂùóÊéß‰ª∂ */
        .slider-container {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            flex: 1;
        }

        .control-slider {
            flex: 1;
            height: 6px;
            border-radius: 3px;
            background: #e2e8f0;
            outline: none;
            -webkit-appearance: none;
        }

        .control-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #3562E3;
            cursor: pointer;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .slider-value-input {
            width: 70px;
            padding: 0.25rem 0.5rem;
            border: 1px solid #e2e8f0;
            border-radius: 0.25rem;
            font-size: 0.875rem;
            text-align: center;
        }

        /* ÊåâÈíÆÊ†∑Âºè */
        .control-btn {
            padding: 0.5rem 1rem;
            border: 1px solid #3562E3;
            background: white;
            color: #3562E3;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .control-btn:hover {
            background: #3562E3;
            color: white;
        }

        .control-btn.primary {
            background: #3562E3;
            color: white;
        }

        .control-btn.primary:hover {
            background: #2951d9;
        }

        /* ÂìçÂ∫îÂºèËÆæËÆ° */
        @media (max-width: 768px) {
            .main-content {
                margin-left: 0;
            }
            
            .group-grid {
                grid-template-columns: 1fr;
            }
            
            .control-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Ë°®ÂçïÊ†∑Âºè */
        .form-section {
            margin-bottom: 2rem;
        }

        .form-section-title {
            font-size: 1rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 1rem;
        }

        .form-grid {
            display: grid;
            gap: 1rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-label {
            font-size: 0.875rem;
            font-weight: 500;
            color: #374151;
        }

        .form-input {
            padding: 0.5rem 0.75rem;
            border: 1px solid #e2e8f0;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            transition: all 0.2s ease;
            width: 100%;
        }

        .form-input:focus {
            outline: none;
            border-color: #3562E3;
            box-shadow: 0 0 0 2px rgba(53, 98, 227, 0.1);
        }

        .form-select {
            padding: 0.5rem 0.75rem;
            border: 1px solid #e2e8f0;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            background: white;
            cursor: pointer;
        }

        textarea.form-input {
            resize: vertical;
            min-height: 80px;
        }

        /* ËÆæÂ§áÈÄâÊã©Ê†∑Âºè */
        .device-selection-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .device-filter {
            display: flex;
            gap: 0.75rem;
            align-items: center;
        }

        .selection-summary {
            font-size: 0.875rem;
            color: #3562E3;
            font-weight: 500;
        }

        .device-selection-list {
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            max-height: 300px;
            overflow-y: auto;
        }

        .device-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            border-bottom: 1px solid #f3f4f6;
            transition: background 0.2s ease;
        }

        .device-item:last-child {
            border-bottom: none;
        }

        .device-item:hover {
            background: #f8fafc;
        }

        .device-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .device-info {
            flex: 1;
        }

        .device-name {
            font-size: 0.875rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 0.25rem;
        }

        .device-details {
            display: flex;
            gap: 1rem;
            font-size: 0.75rem;
        }

        .device-type {
            color: #64748b;
        }

        .device-capacity {
            color: #3562E3;
        }

        .device-status {
            padding: 0.125rem 0.5rem;
            border-radius: 0.75rem;
            font-weight: 500;
        }

        .device-status.online {
            background: #d1fae5;
            color: #059669;
        }

        .device-status.offline {
            background: #fee2e2;
            color: #dc2626;
        }

        /* Ë°®ÂçïÊìç‰ΩúÊåâÈíÆ */
        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 0.75rem;
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid #e2e8f0;
        }

        .btn-secondary {
            background: white;
            color: #374151;
            border: 1px solid #d1d5db;
        }

        .btn-secondary:hover {
            background: #f9fafb;
            border-color: #9ca3af;
        }

        /* ÊöóËâ≤‰∏ªÈ¢ò */
        [data-theme="dark"] body {
            background: #0f172a;
            color: #e2e8f0;
        }

        [data-theme="dark"] .navbar {
            background: #1e293b;
            border-color: #334155;
        }

        [data-theme="dark"] .group-card {
            background: #1e293b;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
        }

        [data-theme="dark"] .modal-content {
            background: #1e293b;
        }

        [data-theme="dark"] .modal-header {
            border-color: #334155;
        }

        [data-theme="dark"] .control-section {
            background: #334155;
            border-color: #475569;
        }

        [data-theme="dark"] .mode-card {
            background: #334155;
            border-color: #475569;
        }

        [data-theme="dark"] .control-input {
            background: #1e293b;
            border-color: #475569;
            color: #f1f5f9;
        }
        
        /* Êó∂ÊÆµËÆæÁΩÆÊ†∑Âºè */
        .time-period-settings {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        
        .period-type-selector {
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .period-type {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
        }
        
        .period-type input[type="radio"] {
            cursor: pointer;
        }
        
        .period-label {
            padding: 0.25rem 0.75rem;
            border-radius: 0.25rem;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .period-label.peak {
            background: #fee2e2;
            color: #dc2626;
        }
        
        .period-label.valley {
            background: #dbeafe;
            color: #2563eb;
        }
        
        .period-label.normal {
            background: #f3f4f6;
            color: #4b5563;
        }
        
        /* 24Â∞èÊó∂ÈÄâÊã©Âô®Ê†∑Âºè */
        .hour-selector {
            display: grid;
            grid-template-columns: repeat(24, 1fr);
            gap: 2px;
            background: #e5e7eb;
            padding: 2px;
            border-radius: 0.5rem;
            margin-top: 1rem;
            user-select: none;
        }
        
        .hour-cell {
            background: white;
            border: 1px solid #e5e7eb;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 50px;
        }
        
        .hour-cell:hover {
            border-color: #9ca3af;
        }
        
        .hour-cell.peak {
            background: #fee2e2;
            border-color: #fecaca;
        }
        
        .hour-cell.valley {
            background: #dbeafe;
            border-color: #bfdbfe;
        }
        
        .hour-cell.normal {
            background: #f3f4f6;
            border-color: #e5e7eb;
        }
        
        .hour-number {
            font-size: 0.75rem;
            color: #6b7280;
            margin-bottom: 2px;
        }
        
        .period-text {
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .hour-cell.peak .period-text {
            color: #dc2626;
        }
        
        .hour-cell.valley .period-text {
            color: #2563eb;
        }
        
        .hour-cell.normal .period-text {
            color: #4b5563;
        }
        
        .period-statistics {
            display: flex;
            gap: 1.5rem;
            margin-top: 1rem;
            font-size: 0.875rem;
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }
        
        .stat-item.peak {
            color: #dc2626;
        }
        
        .stat-item.valley {
            color: #2563eb;
        }
        
        .stat-item.normal {
            color: #4b5563;
        }
        
        .preset-buttons {
            display: flex;
            gap: 0.75rem;
            margin-top: 1rem;
        }
        
        .preset-btn {
            padding: 0.5rem 1rem;
            border: 1px solid #e5e7eb;
            background: white;
            color: #374151;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .preset-btn:hover {
            background: #f9fafb;
            border-color: #d1d5db;
        }
    </style>
</head>
<body>
    <!-- ‰æßËæπÊ†èÂÆπÂô® -->
    <div id="sidebar-container"></div>
    
    <!-- ‰∏ªÂÜÖÂÆπÂå∫ -->
    <div class="main-content">
        <!-- È°∂ÈÉ®ÂØºËà™Ê†è -->
        <nav class="navbar">
            <div class="navbar-left">
                <button class="nav-button" onclick="toggleSidebar()">
                    <span>‚ò∞</span>
                </button>
                <button class="nav-button" onclick="goBack()" title="ËøîÂõûÂú∫ÊôØÈÄâÊã©">
                    <span>‚Üê</span>
                </button>
                <h1 class="page-title">ËÆæÂ§áÁæ§Êéß</h1>
            </div>
            <div class="navbar-right">
                <button class="nav-button" onclick="toggleLanguage()">
                    <span>üåê</span>
                    <span id="lang-text">‰∏≠Êñá</span>
                </button>
                <button class="nav-button" onclick="toggleTheme()">
                    <span id="theme-icon">üåô</span>
                </button>
                <button class="nav-button">
                    <span>üë§</span>
                    <span>ÁÆ°ÁêÜÂëò</span>
                </button>
            </div>
        </nav>

        <!-- È°µÈù¢ÂÜÖÂÆπ -->
        <div class="content">
            <!-- È°µÈù¢Â§¥ÈÉ® -->
            <div class="page-header">
                <div class="page-header-left">
                    <h2>ËÆæÂ§áÂàÜÁªÑÁÆ°ÁêÜ</h2>
                    <p class="page-subtitle">ÁÆ°ÁêÜÂíåÊéßÂà∂ËÆæÂ§áÂàÜÁªÑÔºåÊâπÈáèÊâßË°åÊéßÂà∂Êåá‰ª§</p>
                </div>
                <div class="page-header-right">
                    <button class="btn btn-primary" onclick="createNewGroup()">
                        <span>+</span>
                        <span>Êñ∞Âª∫ÂàÜÁªÑ</span>
                    </button>
                </div>
            </div>

            <!-- ËÆæÂ§áÂàÜÁªÑÂç°Áâá -->
            <div class="group-grid">
                <!-- ÂàÜÁªÑ1: AÂå∫ÂÇ®ËÉΩÁ≥ªÁªü -->
                <div class="group-card" data-group-id="group1">
                    <div class="group-header">
                        <h3 class="group-name">AÂå∫ÂÇ®ËÉΩÁ≥ªÁªü</h3>
                        <button class="delete-btn" onclick="deleteGroup('group1')" title="Âà†Èô§ÂàÜÁªÑ">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M3 6h18"></path>
                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                <line x1="10" y1="11" x2="10" y2="17"></line>
                                <line x1="14" y1="11" x2="14" y2="17"></line>
                            </svg>
                        </button>
                    </div>
                    <div class="group-info">
                        <div class="info-row">
                            <span class="info-label">ËÆæÂ§áÂêçÁß∞</span>
                            <span class="info-value device-names">ÂÇ®ËÉΩÊüú#001, ÂÇ®ËÉΩÊüú#002, ÂÇ®ËÉΩÊüú#004, PCS#001</span>
                        </div>
                    </div>
                    <div class="group-actions">
                        <button class="action-btn" onclick="editGroup('group1')">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                            </svg>
                            <span>ÁºñËæë</span>
                        </button>
                        <button class="action-btn primary" onclick="openGroupControl('group1', 'AÂå∫ÂÇ®ËÉΩÁ≥ªÁªü')">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                                <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                            </svg>
                            <span>ÊéßÂà∂</span>
                        </button>
                    </div>
                </div>

                <!-- ÂàÜÁªÑ2: BÂå∫ÂÇ®ËÉΩÁ≥ªÁªü -->
                <div class="group-card" data-group-id="group2">
                    <div class="group-header">
                        <h3 class="group-name">BÂå∫ÂÇ®ËÉΩÁ≥ªÁªü</h3>
                        <button class="delete-btn" onclick="deleteGroup('group2')" title="Âà†Èô§ÂàÜÁªÑ">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M3 6h18"></path>
                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                <line x1="10" y1="11" x2="10" y2="17"></line>
                                <line x1="14" y1="11" x2="14" y2="17"></line>
                            </svg>
                        </button>
                    </div>
                    <div class="group-info">
                        <div class="info-row">
                            <span class="info-label">ËÆæÂ§áÂêçÁß∞</span>
                            <span class="info-value device-names">ÂÇ®ËÉΩÊüú#003, PCS#002</span>
                        </div>
                    </div>
                    <div class="group-actions">
                        <button class="action-btn" onclick="editGroup('group2')">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                            </svg>
                            <span>ÁºñËæë</span>
                        </button>
                        <button class="action-btn primary" onclick="openGroupControl('group2', 'BÂå∫ÂÇ®ËÉΩÁ≥ªÁªü')">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                                <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                            </svg>
                            <span>ÊéßÂà∂</span>
                        </button>
                    </div>
                </div>

                <!-- ÂàÜÁªÑ3: Â∫îÊÄ•Â§áÁî®ÁªÑ -->
                <div class="group-card" data-group-id="group3">
                    <div class="group-header">
                        <h3 class="group-name">Â∫îÊÄ•Â§áÁî®ÁªÑ</h3>
                        <button class="delete-btn" onclick="deleteGroup('group3')" title="Âà†Èô§ÂàÜÁªÑ">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M3 6h18"></path>
                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                <line x1="10" y1="11" x2="10" y2="17"></line>
                                <line x1="14" y1="11" x2="14" y2="17"></line>
                            </svg>
                        </button>
                    </div>
                    <div class="group-info">
                        <div class="info-row">
                            <span class="info-label">ËÆæÂ§áÂêçÁß∞</span>
                            <span class="info-value device-names">ÂÇ®ËÉΩÊüú#001, ÂÇ®ËÉΩÊüú#002</span>
                        </div>
                    </div>
                    <div class="group-actions">
                        <button class="action-btn" onclick="editGroup('group3')">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                            </svg>
                            <span>ÁºñËæë</span>
                        </button>
                        <button class="action-btn primary" onclick="openGroupControl('group3', 'Â∫îÊÄ•Â§áÁî®ÁªÑ')">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                                <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                            </svg>
                            <span>ÊéßÂà∂</span>
                        </button>
                    </div>
                </div>

                <!-- ÂàÜÁªÑ4: ÂÖâ‰ºèÂçèÂêåÁªÑ -->
                <div class="group-card" data-group-id="group4">
                    <div class="group-header">
                        <h3 class="group-name">ÂÖâ‰ºèÂçèÂêåÁªÑ</h3>
                        <button class="delete-btn" onclick="deleteGroup('group4')" title="Âà†Èô§ÂàÜÁªÑ">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M3 6h18"></path>
                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                <line x1="10" y1="11" x2="10" y2="17"></line>
                                <line x1="14" y1="11" x2="14" y2="17"></line>
                            </svg>
                        </button>
                    </div>
                    <div class="group-info">
                        <div class="info-row">
                            <span class="info-label">ËÆæÂ§áÂêçÁß∞</span>
                            <span class="info-value device-names">ÂÇ®ËÉΩÊüú#004, PCS#001, PCS#002</span>
                        </div>
                    </div>
                    <div class="group-actions">
                        <button class="action-btn" onclick="editGroup('group4')">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                            </svg>
                            <span>ÁºñËæë</span>
                        </button>
                        <button class="action-btn primary" onclick="openGroupControl('group4', 'ÂÖâ‰ºèÂçèÂêåÁªÑ')">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                                <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                            </svg>
                            <span>ÊéßÂà∂</span>
                        </button>
                    </div>
                </div>

                <!-- ÂàÜÁªÑ5: ÊµãËØïÂàÜÁªÑ -->
                <div class="group-card" data-group-id="group5">
                    <div class="group-header">
                        <h3 class="group-name">ÊµãËØïÂàÜÁªÑ</h3>
                        <button class="delete-btn" onclick="deleteGroup('group5')" title="Âà†Èô§ÂàÜÁªÑ">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M3 6h18"></path>
                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                <line x1="10" y1="11" x2="10" y2="17"></line>
                                <line x1="14" y1="11" x2="14" y2="17"></line>
                            </svg>
                        </button>
                    </div>
                    <div class="group-info">
                        <div class="info-row">
                            <span class="info-label">ËÆæÂ§áÂêçÁß∞</span>
                            <span class="info-value device-names">ÂÇ®ËÉΩÊüú#003</span>
                        </div>
                    </div>
                    <div class="group-actions">
                        <button class="action-btn" onclick="editGroup('group5')">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                            </svg>
                            <span>ÁºñËæë</span>
                        </button>
                        <button class="action-btn primary" onclick="openGroupControl('group5', 'ÊµãËØïÂàÜÁªÑ')">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                                <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                            </svg>
                            <span>ÊéßÂà∂</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Êñ∞Âª∫/ÁºñËæëÂàÜÁªÑÂºπÁ™ó -->
    <div class="modal" id="create-group-modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3 class="modal-title" id="modal-form-title">Êñ∞Âª∫ËÆæÂ§áÂàÜÁªÑ</h3>
                <button class="modal-close" onclick="closeCreateGroupModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-section">
                    <h4 class="form-section-title">Âü∫Êú¨‰ø°ÊÅØ</h4>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">ÂàÜÁªÑÂêçÁß∞</label>
                            <input type="text" class="form-input" id="new-group-name" placeholder="ËØ∑ËæìÂÖ•ÂàÜÁªÑÂêçÁß∞">
                        </div>
                        <div class="form-group">
                            <label class="form-label">ÂàÜÁªÑÊèèËø∞</label>
                            <textarea class="form-input" id="new-group-desc" rows="3" placeholder="ËØ∑ËæìÂÖ•ÂàÜÁªÑÊèèËø∞ÔºàÈÄâÂ°´Ôºâ"></textarea>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h4 class="form-section-title">ÈÄâÊã©ËÆæÂ§á</h4>
                    <div class="device-selection-header">
                        <div class="device-filter">
                            <input type="text" class="form-input" placeholder="ÊêúÁ¥¢ËÆæÂ§á..." style="width: 200px;" oninput="filterDeviceList(this.value)">
                            <select class="form-select" style="width: 150px;" onchange="filterDeviceByType(this.value)">
                                <option value="all">ÂÖ®ÈÉ®Á±ªÂûã</option>
                                <option value="cabinet">ÂÇ®ËÉΩÊüú</option>
                                <option value="pcs">PCS</option>
                                <option value="battery">ÁîµÊ±†ÁªÑ</option>
                            </select>
                        </div>
                        <div class="selection-summary">
                            Â∑≤ÈÄâÊã©: <span id="selected-device-count">0</span> Âè∞ËÆæÂ§á
                        </div>
                    </div>
                    
                    <div class="device-selection-list">
                        <div class="device-item" data-device-id="cab001" data-type="cabinet">
                            <input type="checkbox" class="device-checkbox" onchange="updateDeviceSelection()">
                            <div class="device-info">
                                <div class="device-name">ÂÇ®ËÉΩÊüú#001</div>
                                <div class="device-details">
                                    <span class="device-type">ÂÇ®ËÉΩÊüú</span>
                                    <span class="device-capacity">500 kWh</span>
                                    <span class="device-status online">Âú®Á∫ø</span>
                                </div>
                            </div>
                        </div>
                        <div class="device-item" data-device-id="cab002" data-type="cabinet">
                            <input type="checkbox" class="device-checkbox" onchange="updateDeviceSelection()">
                            <div class="device-info">
                                <div class="device-name">ÂÇ®ËÉΩÊüú#002</div>
                                <div class="device-details">
                                    <span class="device-type">ÂÇ®ËÉΩÊüú</span>
                                    <span class="device-capacity">500 kWh</span>
                                    <span class="device-status online">Âú®Á∫ø</span>
                                </div>
                            </div>
                        </div>
                        <div class="device-item" data-device-id="cab003" data-type="cabinet">
                            <input type="checkbox" class="device-checkbox" onchange="updateDeviceSelection()">
                            <div class="device-info">
                                <div class="device-name">ÂÇ®ËÉΩÊüú#003</div>
                                <div class="device-details">
                                    <span class="device-type">ÂÇ®ËÉΩÊüú</span>
                                    <span class="device-capacity">500 kWh</span>
                                    <span class="device-status offline">Á¶ªÁ∫ø</span>
                                </div>
                            </div>
                        </div>
                        <div class="device-item" data-device-id="cab004" data-type="cabinet">
                            <input type="checkbox" class="device-checkbox" onchange="updateDeviceSelection()">
                            <div class="device-info">
                                <div class="device-name">ÂÇ®ËÉΩÊüú#004</div>
                                <div class="device-details">
                                    <span class="device-type">ÂÇ®ËÉΩÊüú</span>
                                    <span class="device-capacity">500 kWh</span>
                                    <span class="device-status online">Âú®Á∫ø</span>
                                </div>
                            </div>
                        </div>
                        <div class="device-item" data-device-id="pcs001" data-type="pcs">
                            <input type="checkbox" class="device-checkbox" onchange="updateDeviceSelection()">
                            <div class="device-info">
                                <div class="device-name">PCS#001</div>
                                <div class="device-details">
                                    <span class="device-type">PCS</span>
                                    <span class="device-capacity">250 kW</span>
                                    <span class="device-status online">Âú®Á∫ø</span>
                                </div>
                            </div>
                        </div>
                        <div class="device-item" data-device-id="pcs002" data-type="pcs">
                            <input type="checkbox" class="device-checkbox" onchange="updateDeviceSelection()">
                            <div class="device-info">
                                <div class="device-name">PCS#002</div>
                                <div class="device-details">
                                    <span class="device-type">PCS</span>
                                    <span class="device-capacity">250 kW</span>
                                    <span class="device-status online">Âú®Á∫ø</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <button class="btn btn-secondary" onclick="closeCreateGroupModal()">ÂèñÊ∂à</button>
                    <button class="btn btn-primary" id="submit-group-btn" onclick="submitGroup()">ÂàõÂª∫ÂàÜÁªÑ</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ÊéßÂà∂ÂºπÁ™ó -->
    <div class="modal" id="control-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modal-title">ËÆæÂ§áÁæ§Êéß - <span id="group-name"></span></h3>
                <button class="modal-close" onclick="closeControlModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="control-sections">
                    <!-- Â∑•‰ΩúÊ®°ÂºèËÆæÁΩÆ -->
                    <section class="control-section">
                        <div class="section-header">
                            <h3 class="section-title">Â∑•‰ΩúÊ®°ÂºèËÆæÁΩÆ</h3>
                        </div>
                        <div class="work-mode-grid">
                            <div class="mode-card active" onclick="selectWorkMode(this, 'self-consumption')">
                                <div class="mode-check">‚úì</div>
                                <div class="mode-icon">üè†</div>
                                <div class="mode-title">Ëá™ÂèëËá™Áî®</div>
                                <div class="mode-desc">‰ºòÂÖàËá™Áî®Ôºå‰ΩôÁîµ‰∏äÁΩë</div>
                            </div>
                            <div class="mode-card" onclick="selectWorkMode(this, 'economic')">
                                <div class="mode-check">‚úì</div>
                                <div class="mode-icon">üí∞</div>
                                <div class="mode-title">ÁªèÊµéÊ®°Âºè</div>
                                <div class="mode-desc">Â≥∞Ë∞∑Â•óÂà©ÔºåÈôç‰ΩéÁîµË¥π</div>
                            </div>
                            <div class="mode-card" onclick="selectWorkMode(this, 'emergency')">
                                <div class="mode-check">‚úì</div>
                                <div class="mode-icon">‚ö°</div>
                                <div class="mode-title">Â∫îÊÄ•Ê®°Âºè</div>
                                <div class="mode-desc">‰øùÊåÅÈ´òÁîµÈáèÔºåÂ∫îÊÄ•‰æõÁîµ</div>
                            </div>
                            <div class="mode-card" onclick="selectWorkMode(this, 'vpp')">
                                <div class="mode-check">‚úì</div>
                                <div class="mode-icon">üîó</div>
                                <div class="mode-title">VPPÊ®°Âºè</div>
                                <div class="mode-desc">ËôöÊãüÁîµÂéÇËÅöÂêà</div>
                            </div>
                        </div>
                    </section>

                    <!-- ÁªèÊµéÊ®°ÂºèÊó∂ÊÆµËÆæÁΩÆÔºà‰ªÖÂú®ÁªèÊµéÊ®°Âºè‰∏ãÊòæÁ§∫Ôºâ -->
                    <section class="control-section" id="economic-time-settings" style="display: none;">
                        <div class="section-header">
                            <h3 class="section-title">Êó∂ÊÆµËÆæÁΩÆ</h3>
                        </div>
                        <div class="time-period-settings">
                            <div class="period-type-selector">
                                <label class="period-type">
                                    <input type="radio" name="period-type" value="peak" onchange="setPeriodType('peak')">
                                    <span class="period-label peak">Â≥∞Êó∂ÊÆµ</span>
                                </label>
                                <label class="period-type">
                                    <input type="radio" name="period-type" value="valley" onchange="setPeriodType('valley')">
                                    <span class="period-label valley">Ë∞∑Êó∂ÊÆµ</span>
                                </label>
                                <label class="period-type">
                                    <input type="radio" name="period-type" value="normal" onchange="setPeriodType('normal')" checked>
                                    <span class="period-label normal">Âπ≥Êó∂ÊÆµ</span>
                                </label>
                            </div>
                            <div class="time-slots-grid">
                                <!-- 24Â∞èÊó∂Êó∂ÊÆµÈÄâÊã©Âô® -->
                                <div class="hour-selector" id="hour-selector">
                                    <!-- Âä®ÊÄÅÁîüÊàê24‰∏™Â∞èÊó∂Ê†ºÂ≠ê -->
                                </div>
                                <div class="period-statistics">
                                    <span class="stat-item peak">Â≥∞Êó∂ÊÆµ: <span id="peak-hours">0</span>Â∞èÊó∂</span>
                                    <span class="stat-item valley">Ë∞∑Êó∂ÊÆµ: <span id="valley-hours">0</span>Â∞èÊó∂</span>
                                    <span class="stat-item normal">Âπ≥Êó∂ÊÆµ: <span id="normal-hours">0</span>Â∞èÊó∂</span>
                                </div>
                                <div class="preset-buttons">
                                    <button class="preset-btn" onclick="loadPreset('commercial')">Â∑•ÂïÜ‰∏öÈ¢ÑËÆæ</button>
                                    <button class="preset-btn" onclick="loadPreset('industrial')">Â∑•‰∏öÈ¢ÑËÆæ</button>
                                    <button class="preset-btn" onclick="clearAllHours()">Ê∏ÖÈô§ÂÖ®ÈÉ®</button>
                                </div>
                                <div class="time-slot-row">
                                    <span class="time-label">17:00-22:00</span>
                                    <div class="time-slot normal" data-hours="17-21">Âπ≥</div>
                                </div>
                                <div class="time-slot-row">
                                    <span class="time-label">22:00-24:00</span>
                                    <div class="time-slot valley" data-hours="22-23">Ë∞∑</div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Âü∫Á°ÄÂèÇÊï∞ËÆæÁΩÆ -->
                    <section class="control-section">
                        <div class="section-header">
                            <h3 class="section-title">Âü∫Á°ÄÂèÇÊï∞ËÆæÁΩÆ</h3>
                        </div>
                        <div class="control-grid">
                            <div class="control-item">
                                <label class="control-label">ÂÖÖÁîµÂÅúÊ≠¢SOC</label>
                                <div class="control-value">
                                    <div class="slider-container">
                                        <input type="range" class="control-slider" value="95" min="80" max="100" id="charge-stop-soc-slider" oninput="updateSliderValue(this, 'charge-stop-soc-value')">
                                        <input type="number" class="slider-value-input" id="charge-stop-soc-value" value="95" min="80" max="100" oninput="updateSliderFromInput(this, 'charge-stop-soc-slider')">
                                        <span class="control-unit">%</span>
                                    </div>
                                </div>
                            </div>
                            <div class="control-item">
                                <label class="control-label">ÊîæÁîµÂÅúÊ≠¢SOC</label>
                                <div class="control-value">
                                    <div class="slider-container">
                                        <input type="range" class="control-slider" value="20" min="5" max="50" id="discharge-stop-soc-slider" oninput="updateSliderValue(this, 'discharge-stop-soc-value')">
                                        <input type="number" class="slider-value-input" id="discharge-stop-soc-value" value="20" min="5" max="50" oninput="updateSliderFromInput(this, 'discharge-stop-soc-slider')">
                                        <span class="control-unit">%</span>
                                    </div>
                                </div>
                            </div>
                            <div class="control-item">
                                <label class="control-label">ÂÖÖÁîµÂäüÁéáÈôêÂà∂</label>
                                <div class="control-value">
                                    <input type="number" class="control-input" value="500" min="0" max="1000" id="charge-power-limit">
                                    <span class="control-unit">kW</span>
                                </div>
                            </div>
                            <div class="control-item">
                                <label class="control-label">ÊîæÁîµÂäüÁéáÈôêÂà∂</label>
                                <div class="control-value">
                                    <input type="number" class="control-input" value="500" min="0" max="1000" id="discharge-power-limit">
                                    <span class="control-unit">kW</span>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- È´òÁ∫ßÂèÇÊï∞ËÆæÁΩÆ -->
                    <section class="control-section">
                        <div class="section-header">
                            <h3 class="section-title">È´òÁ∫ßÂèÇÊï∞ËÆæÁΩÆ</h3>
                        </div>
                        <div class="control-grid">
                            <div class="control-item">
                                <label class="control-label">ÈúÄÈáèÊéßÂà∂</label>
                                <div class="control-value">
                                    <div class="switch" onclick="toggleSwitch(this)">
                                        <div class="switch-handle"></div>
                                    </div>
                                    <span>ÂêØÁî®</span>
                                </div>
                            </div>
                            <div class="control-item">
                                <label class="control-label">ÂêàÂêåÂÆπÈáè</label>
                                <div class="control-value">
                                    <input type="number" class="control-input" value="1000" min="100" max="10000" id="contract-capacity">
                                    <span class="control-unit">kW</span>
                                </div>
                            </div>
                            <div class="control-item">
                                <label class="control-label">È¢ÑË≠¶ÁôæÂàÜÊØî</label>
                                <div class="control-value">
                                    <input type="number" class="control-input" value="90" min="50" max="100" id="warning-percentage">
                                    <span class="control-unit">%</span>
                                </div>
                            </div>
                            <div class="control-item">
                                <label class="control-label">‰ΩôÁîµ‰∏äÁΩë</label>
                                <div class="control-value">
                                    <div class="switch active" onclick="toggleSwitch(this)">
                                        <div class="switch-handle"></div>
                                    </div>
                                    <span>ÂÖÅËÆ∏</span>
                                </div>
                            </div>
                            <div class="control-item">
                                <label class="control-label">Ê∏©Â∫¶‰øùÊä§</label>
                                <div class="control-value">
                                    <div class="switch active" onclick="toggleSwitch(this)">
                                        <div class="switch-handle"></div>
                                    </div>
                                    <span>ÂêØÁî®</span>
                                </div>
                            </div>
                            <div class="control-item">
                                <label class="control-label">ËøáËΩΩ‰øùÊä§</label>
                                <div class="control-value">
                                    <div class="switch active" onclick="toggleSwitch(this)">
                                        <div class="switch-handle"></div>
                                    </div>
                                    <span>ÂêØÁî®</span>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Ë∞ÉÂ∫¶Á≠ñÁï•ËÆæÁΩÆ -->
                    <section class="control-section">
                        <div class="section-header">
                            <h3 class="section-title">Ë∞ÉÂ∫¶Á≠ñÁï•ËÆæÁΩÆ</h3>
                        </div>
                        <div class="control-grid">
                            <div class="control-item">
                                <label class="control-label">Ë∞ÉÂ∫¶Ê®°Âºè</label>
                                <div class="control-value">
                                    <select class="control-input">
                                        <option value="auto">Ëá™Âä®Ë∞ÉÂ∫¶</option>
                                        <option value="manual">ÊâãÂä®ÊéßÂà∂</option>
                                        <option value="remote">ËøúÁ®ãË∞ÉÂ∫¶</option>
                                        <option value="local">Êú¨Âú∞ÊéßÂà∂</option>
                                    </select>
                                </div>
                            </div>
                            <div class="control-item">
                                <label class="control-label">ÂìçÂ∫îÈÄüÂ∫¶</label>
                                <div class="control-value">
                                    <select class="control-input">
                                        <option value="fast">Âø´ÈÄüÂìçÂ∫î</option>
                                        <option value="standard" selected>Ê†áÂáÜÂìçÂ∫î</option>
                                        <option value="slow">ÁºìÊÖ¢ÂìçÂ∫î</option>
                                    </select>
                                </div>
                            </div>
                            <div class="control-item">
                                <label class="control-label">‰ºòÂÖàÁ∫ß</label>
                                <div class="control-value">
                                    <select class="control-input">
                                        <option value="high">È´ò</option>
                                        <option value="medium" selected>‰∏≠</option>
                                        <option value="low">‰Ωé</option>
                                    </select>
                                </div>
                            </div>
                            <div class="control-item">
                                <label class="control-label">Ëá™Âä®‰ºòÂåñ</label>
                                <div class="control-value">
                                    <div class="switch active" onclick="toggleSwitch(this)">
                                        <div class="switch-handle"></div>
                                    </div>
                                    <span>ÂêØÁî®</span>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Á≥ªÁªü‰øùÊä§ËÆæÁΩÆ -->
                    <section class="control-section">
                        <div class="section-header">
                            <h3 class="section-title">Á≥ªÁªü‰øùÊä§ËÆæÁΩÆ</h3>
                        </div>
                        <div class="control-grid">
                            <div class="control-item">
                                <label class="control-label">ÂÖÖÁîµÁîµÊµÅÈôêÂà∂</label>
                                <div class="control-value">
                                    <input type="number" class="control-input" value="100" min="0" max="500" id="charge-current-limit">
                                    <span class="control-unit">A</span>
                                </div>
                            </div>
                            <div class="control-item">
                                <label class="control-label">ÊîæÁîµÁîµÊµÅÈôêÂà∂</label>
                                <div class="control-value">
                                    <input type="number" class="control-input" value="100" min="0" max="500" id="discharge-current-limit">
                                    <span class="control-unit">A</span>
                                </div>
                            </div>
                            <div class="control-item">
                                <label class="control-label">ÊúÄÈ´òÊ∏©Â∫¶ÈôêÂà∂</label>
                                <div class="control-value">
                                    <input type="number" class="control-input" value="45" min="20" max="60" id="max-temp-limit">
                                    <span class="control-unit">¬∞C</span>
                                </div>
                            </div>
                            <div class="control-item">
                                <label class="control-label">ÊúÄ‰ΩéÊ∏©Â∫¶ÈôêÂà∂</label>
                                <div class="control-value">
                                    <input type="number" class="control-input" value="-10" min="-30" max="10" id="min-temp-limit">
                                    <span class="control-unit">¬∞C</span>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Êìç‰ΩúÊåâÈíÆ -->
                    <div style="display: flex; justify-content: flex-end; gap: 0.75rem; margin-top: 1.5rem;">
                        <button class="control-btn" onclick="resetParameters()">ÈáçÁΩÆÂèÇÊï∞</button>
                        <button class="control-btn primary" onclick="applyGroupSettings()">Â∫îÁî®ËÆæÁΩÆ</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Âà†Èô§Á°ÆËÆ§ÂºπÁ™ó -->
    <div id="delete-confirm-modal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3 class="modal-title">Á°ÆËÆ§Âà†Èô§</h3>
            </div>
            <div class="modal-body" style="padding: 1.5rem;">
                <p style="margin: 0; color: #4b5563;">Á°ÆÂÆöË¶ÅÂà†Èô§ÂàÜÁªÑ"<span id="delete-group-name" style="font-weight: 600; color: #1f2937;"></span>"ÂêóÔºü</p>
                <p style="margin: 0.5rem 0 0 0; color: #dc2626; font-size: 0.875rem;">Âà†Èô§ÂêéÊó†Ê≥ïÊÅ¢Â§ç</p>
            </div>
            <div class="modal-footer" style="display: flex; justify-content: flex-end; gap: 0.75rem; padding: 1rem 1.5rem; border-top: 1px solid #e5e7eb;">
                <button class="btn" onclick="cancelDeleteGroup()">ÂèñÊ∂à</button>
                <button class="btn" style="background: #dc2626; color: white;" onclick="confirmDeleteGroup()">Á°ÆËÆ§Âà†Èô§</button>
            </div>
        </div>
    </div>

    <!-- ‰æßËæπÊ†èËÑöÊú¨ -->
    <script src="./sidebar.js"></script>
    
    <script>
        // ÂÖ®Â±ÄÂèòÈáè
        let currentGroup = null;
        let currentWorkMode = 'self-consumption';
        let editMode = false;
        let editingGroupId = null;

        // Â≠òÂÇ®ÂàÜÁªÑÊï∞ÊçÆÔºàÊ®°ÊãüÂêéÁ´ØÊï∞ÊçÆÔºâ
        const groupsData = {
            'group1': {
                name: 'AÂå∫ÂÇ®ËÉΩÁ≥ªÁªü',
                description: 'AÂå∫ÊâÄÊúâÂÇ®ËÉΩËÆæÂ§á',
                devices: ['cab001', 'cab002', 'cab004', 'pcs001']
            },
            'group2': {
                name: 'BÂå∫ÂÇ®ËÉΩÁ≥ªÁªü',
                description: 'BÂå∫ÊâÄÊúâÂÇ®ËÉΩËÆæÂ§á',
                devices: ['cab003', 'pcs002']
            },
            'group3': {
                name: 'Â∫îÊÄ•Â§áÁî®ÁªÑ',
                description: 'Áî®‰∫éÂ∫îÊÄ•‰æõÁîµÁöÑÂÇ®ËÉΩËÆæÂ§á',
                devices: ['cab001', 'cab002']
            },
            'group4': {
                name: 'ÂÖâ‰ºèÂçèÂêåÁªÑ',
                description: '‰∏éÂÖâ‰ºèÁ≥ªÁªüÂçèÂêåÂ∑•‰ΩúÁöÑÂÇ®ËÉΩËÆæÂ§á',
                devices: ['cab004', 'pcs001', 'pcs002']
            },
            'group5': {
                name: 'ÊµãËØïÂàÜÁªÑ',
                description: 'ÊµãËØïÁî®ÈÄî',
                devices: ['cab003']
            }
        };

        // ÂàõÂª∫Êñ∞ÂàÜÁªÑ
        function createNewGroup() {
            editMode = false;
            editingGroupId = null;
            openGroupModal('Êñ∞Âª∫ËÆæÂ§áÂàÜÁªÑ', 'ÂàõÂª∫ÂàÜÁªÑ');
            // ÈáçÁΩÆË°®Âçï
            document.getElementById('new-group-name').value = '';
            document.getElementById('new-group-desc').value = '';
            document.querySelectorAll('#create-group-modal .device-checkbox').forEach(cb => cb.checked = false);
            updateDeviceSelection();
        }

        // ÁºñËæëÂàÜÁªÑ
        function editGroup(groupId) {
            editMode = true;
            editingGroupId = groupId;
            const groupData = groupsData[groupId];
            
            if (!groupData) {
                alert('ÂàÜÁªÑÊï∞ÊçÆ‰∏çÂ≠òÂú®');
                return;
            }

            openGroupModal('ÁºñËæëËÆæÂ§áÂàÜÁªÑ', '‰øùÂ≠ò‰øÆÊîπ');
            
            // Â°´ÂÖÖË°®ÂçïÊï∞ÊçÆ
            document.getElementById('new-group-name').value = groupData.name;
            document.getElementById('new-group-desc').value = groupData.description || '';
            
            // ÈÄâ‰∏≠Â∑≤ÊúâËÆæÂ§á
            document.querySelectorAll('#create-group-modal .device-checkbox').forEach(cb => {
                const deviceId = cb.closest('.device-item').dataset.deviceId;
                cb.checked = groupData.devices.includes(deviceId);
            });
            
            updateDeviceSelection();
        }

        // ÊâìÂºÄÂàÜÁªÑÂºπÁ™ó
        function openGroupModal(title, buttonText) {
            document.getElementById('modal-form-title').textContent = title;
            document.getElementById('submit-group-btn').textContent = buttonText;
            document.getElementById('create-group-modal').classList.add('active');
        }

        // ÂÖ≥Èó≠Êñ∞Âª∫ÂàÜÁªÑÂºπÁ™ó
        function closeCreateGroupModal() {
            document.getElementById('create-group-modal').classList.remove('active');
            editMode = false;
            editingGroupId = null;
        }

        // Êõ¥Êñ∞ËÆæÂ§áÈÄâÊã©ËÆ°Êï∞
        function updateDeviceSelection() {
            const checkedCount = document.querySelectorAll('#create-group-modal .device-checkbox:checked').length;
            document.getElementById('selected-device-count').textContent = checkedCount;
        }

        // ËøáÊª§ËÆæÂ§áÂàóË°®
        function filterDeviceList(searchText) {
            const devices = document.querySelectorAll('#create-group-modal .device-item');
            devices.forEach(device => {
                const name = device.querySelector('.device-name').textContent.toLowerCase();
                if (name.includes(searchText.toLowerCase())) {
                    device.style.display = 'flex';
                } else {
                    device.style.display = 'none';
                }
            });
        }

        // ÊåâÁ±ªÂûãËøáÊª§ËÆæÂ§á
        function filterDeviceByType(type) {
            const devices = document.querySelectorAll('#create-group-modal .device-item');
            devices.forEach(device => {
                if (type === 'all' || device.dataset.type === type) {
                    device.style.display = 'flex';
                } else {
                    device.style.display = 'none';
                }
            });
        }

        // Êèê‰∫§ÂàÜÁªÑÔºàÂàõÂª∫ÊàñÊõ¥Êñ∞Ôºâ
        function submitGroup() {
            const groupName = document.getElementById('new-group-name').value.trim();
            const groupDesc = document.getElementById('new-group-desc').value.trim();
            const selectedDevices = document.querySelectorAll('#create-group-modal .device-checkbox:checked');

            if (!groupName) {
                alert('ËØ∑ËæìÂÖ•ÂàÜÁªÑÂêçÁß∞');
                return;
            }

            if (selectedDevices.length === 0) {
                alert('ËØ∑Ëá≥Â∞ëÈÄâÊã©‰∏Ä‰∏™ËÆæÂ§á');
                return;
            }

            const selectedDeviceIds = Array.from(selectedDevices).map(cb => 
                cb.closest('.device-item').dataset.deviceId
            );

            if (editMode) {
                // Êõ¥Êñ∞Áé∞ÊúâÂàÜÁªÑ
                updateExistingGroup(editingGroupId, {
                    name: groupName,
                    description: groupDesc,
                    devices: selectedDeviceIds
                });
                alert(`ÂàÜÁªÑ"${groupName}"Â∑≤Êõ¥Êñ∞ÔºÅ`);
            } else {
                // ÂàõÂª∫Êñ∞ÂàÜÁªÑ
                // Ëé∑ÂèñËÆæÂ§áÂêçÁß∞
                const deviceNames = Array.from(selectedDevices).map(cb => {
                    const deviceItem = cb.closest('.device-item');
                    return deviceItem.querySelector('.device-name').textContent;
                }).join(', ');

                const newGroupData = {
                    name: groupName,
                    description: groupDesc,
                    deviceNames: deviceNames,
                    devices: selectedDeviceIds
                };

                // ÂàõÂª∫Êñ∞ÁöÑÂàÜÁªÑÂç°Áâá
                createGroupCard(newGroupData);
                alert(`ÂàÜÁªÑ"${groupName}"ÂàõÂª∫ÊàêÂäüÔºÅ`);
            }
            
            // ÂÖ≥Èó≠ÂºπÁ™ó
            closeCreateGroupModal();
        }

        // Êõ¥Êñ∞Áé∞ÊúâÂàÜÁªÑ
        function updateExistingGroup(groupId, data) {
            // Êõ¥Êñ∞Êï∞ÊçÆÂ≠òÂÇ®
            groupsData[groupId] = {
                ...groupsData[groupId],
                ...data
            };

            // Êõ¥Êñ∞È°µÈù¢‰∏äÁöÑÂç°Áâá
            const groupCard = document.querySelector(`[data-group-id="${groupId}"]`);
            if (groupCard) {
                groupCard.querySelector('.group-name').textContent = data.name;
                
                // Êõ¥Êñ∞ËÆæÂ§áÂêçÁß∞
                const deviceNamesElement = groupCard.querySelector('.device-names');
                if (deviceNamesElement) {
                    const deviceNames = data.devices.map(deviceId => {
                        const deviceItem = document.querySelector(`[data-device-id="${deviceId}"]`);
                        return deviceItem ? deviceItem.querySelector('.device-name').textContent : deviceId;
                    }).join(', ');
                    deviceNamesElement.textContent = deviceNames;
                }
                
                // Âè™ÈúÄË¶ÅÊõ¥Êñ∞ËÆæÂ§áÂêçÁß∞ÔºåÂÖ∂‰ªñÂ≠óÊÆµÂ∑≤ÁßªÈô§
            }
        }

        // ÂàõÂª∫ÂàÜÁªÑÂç°Áâá
        function createGroupCard(groupData) {
            const groupGrid = document.querySelector('.group-grid');
            const newCard = document.createElement('div');
            newCard.className = 'group-card';
            const groupId = 'group-new-' + Date.now();
            newCard.setAttribute('data-group-id', groupId);
            newCard.innerHTML = `
                <div class="group-header">
                    <h3 class="group-name">${groupData.name}</h3>
                    <button class="delete-btn" onclick="deleteGroup('${groupId}')" title="Âà†Èô§ÂàÜÁªÑ">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 6h18"></path>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                            <line x1="10" y1="11" x2="10" y2="17"></line>
                            <line x1="14" y1="11" x2="14" y2="17"></line>
                        </svg>
                    </button>
                </div>
                <div class="group-info">
                    <div class="info-row">
                        <span class="info-label">ËÆæÂ§áÂêçÁß∞</span>
                        <span class="info-value device-names">${groupData.deviceNames || '--'}</span>
                    </div>
                </div>
                <div class="group-actions">
                    <button class="action-btn" onclick="editGroup('${groupId}')">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                        </svg>
                        <span>ÁºñËæë</span>
                    </button>
                    <button class="action-btn primary" onclick="openGroupControl('${groupId}', '${groupData.name}')">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                            <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                        </svg>
                        <span>ÊéßÂà∂</span>
                    </button>
                </div>
            `;
            groupGrid.appendChild(newCard);
            
            // ‰øùÂ≠òÊñ∞ÁöÑÂàÜÁªÑÊï∞ÊçÆ
            groupsData[groupId] = {
                name: groupData.name,
                description: groupData.description || '',
                devices: groupData.devices || []
            };
        }

        // Âà†Èô§ÂàÜÁªÑÁõ∏ÂÖ≥ÂèòÈáè
        let deletingGroupId = null;
        
        // Âà†Èô§ÂàÜÁªÑ
        function deleteGroup(groupId) {
            const groupCard = document.querySelector(`[data-group-id="${groupId}"]`);
            const groupName = groupCard ? groupCard.querySelector('.group-name').textContent : '';
            
            // ‰øùÂ≠òË¶ÅÂà†Èô§ÁöÑÂàÜÁªÑID
            deletingGroupId = groupId;
            
            // ÊòæÁ§∫ÂàÜÁªÑÂêçÁß∞
            document.getElementById('delete-group-name').textContent = groupName;
            
            // ÊòæÁ§∫Á°ÆËÆ§ÂºπÁ™ó
            document.getElementById('delete-confirm-modal').classList.add('active');
        }
        
        // Á°ÆËÆ§Âà†Èô§
        function confirmDeleteGroup() {
            if (deletingGroupId) {
                const groupCard = document.querySelector(`[data-group-id="${deletingGroupId}"]`);
                
                // ‰ªéDOM‰∏≠ÁßªÈô§Âç°Áâá
                if (groupCard) {
                    groupCard.remove();
                }
                
                // ‰ªéÊï∞ÊçÆ‰∏≠Âà†Èô§
                delete groupsData[deletingGroupId];
                
                // ÂÖ≥Èó≠ÂºπÁ™ó
                cancelDeleteGroup();
            }
        }
        
        // ÂèñÊ∂àÂà†Èô§
        function cancelDeleteGroup() {
            deletingGroupId = null;
            document.getElementById('delete-confirm-modal').classList.remove('active');
        }

        // ÊâìÂºÄÁæ§ÊéßÂºπÁ™ó
        function openGroupControl(groupId, groupName) {
            currentGroup = groupId;
            document.getElementById('group-name').textContent = groupName;
            document.getElementById('control-modal').classList.add('active');
        }

        // ÂÖ≥Èó≠ÊéßÂà∂ÂºπÁ™ó
        function closeControlModal() {
            document.getElementById('control-modal').classList.remove('active');
            currentGroup = null;
        }

        // ÈÄâÊã©Â∑•‰ΩúÊ®°Âºè
        function selectWorkMode(element, mode) {
            document.querySelectorAll('.mode-card').forEach(card => {
                card.classList.remove('active');
            });
            element.classList.add('active');
            currentWorkMode = mode;
            
            // ÊòæÁ§∫/ÈöêËóèÁªèÊµéÊ®°ÂºèÊó∂ÊÆµËÆæÁΩÆ
            const economicTimeSettings = document.getElementById('economic-time-settings');
            if (economicTimeSettings) {
                if (mode === 'economic') {
                    economicTimeSettings.style.display = 'block';
                    // ÂàùÂßãÂåñÊó∂ÊÆµÈÄâÊã©Âô®ÔºàÂ¶ÇÊûúËøòÊú™ÂàùÂßãÂåñÔºâ
                    if (!document.querySelector('.hour-cell')) {
                        initHourSelector();
                        loadPreset('commercial');
                    }
                } else {
                    economicTimeSettings.style.display = 'none';
                }
            }
        }

        // ÊªëÂùóÊéßÂà∂
        function updateSliderValue(slider, valueInputId) {
            document.getElementById(valueInputId).value = slider.value;
        }

        function updateSliderFromInput(input, sliderId) {
            document.getElementById(sliderId).value = input.value;
        }

        // ÂºÄÂÖ≥ÊéßÂà∂
        function toggleSwitch(switchElement) {
            switchElement.classList.toggle('active');
        }

        // Â∫îÁî®Áæ§ÁªÑËÆæÁΩÆ
        function applyGroupSettings() {
            const groupName = document.getElementById('group-name').textContent;
            if (confirm(`Á°ÆÂÆöË¶ÅÂ∞ÜËøô‰∫õËÆæÁΩÆÂ∫îÁî®Âà∞"${groupName}"ÁöÑÊâÄÊúâËÆæÂ§áÂêóÔºü`)) {
                // Ê®°ÊãüÂ∫îÁî®ËÆæÁΩÆ
                setTimeout(() => {
                    alert('ËÆæÁΩÆÂ∑≤ÊàêÂäüÂ∫îÁî®ÔºÅ');
                    closeControlModal();
                }, 1000);
            }
        }

        // ÈáçÁΩÆÂèÇÊï∞
        function resetParameters() {
            document.getElementById('charge-stop-soc-slider').value = 95;
            document.getElementById('charge-stop-soc-value').value = 95;
            document.getElementById('discharge-stop-soc-slider').value = 20;
            document.getElementById('discharge-stop-soc-value').value = 20;
            document.getElementById('charge-power-limit').value = 500;
            document.getElementById('discharge-power-limit').value = 500;
            document.getElementById('contract-capacity').value = 1000;
            document.getElementById('warning-percentage').value = 90;
        }

        // È°µÈù¢ÂØºËà™ÂáΩÊï∞
        function goBack() {
            window.history.back();
        }

        function toggleLanguage() {
            const langText = document.getElementById('lang-text');
            if (langText.textContent === '‰∏≠Êñá') {
                langText.textContent = 'EN';
            } else {
                langText.textContent = '‰∏≠Êñá';
            }
        }

        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            document.getElementById('theme-icon').textContent = newTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
            localStorage.setItem('ess_theme', newTheme);
        }

        function toggleSidebar() {
            const sidebar = document.querySelector('.sidebar');
            if (sidebar) {
                sidebar.classList.toggle('collapsed');
            }
        }

        // ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            // Â∫îÁî®‰øùÂ≠òÁöÑ‰∏ªÈ¢ò
            const savedTheme = localStorage.getItem('ess_theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            document.getElementById('theme-icon').textContent = savedTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
        });

        // ÁÇπÂáªÊ®°ÊÄÅÊ°ÜÂ§ñÈÉ®ÂÖ≥Èó≠
        document.getElementById('control-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeControlModal();
            }
        });

        // ÁÇπÂáªÂàõÂª∫ÂàÜÁªÑÊ®°ÊÄÅÊ°ÜÂ§ñÈÉ®ÂÖ≥Èó≠
        document.getElementById('create-group-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeCreateGroupModal();
            }
        });
        
        // ÁÇπÂáªÂà†Èô§Á°ÆËÆ§Ê®°ÊÄÅÊ°ÜÂ§ñÈÉ®ÂÖ≥Èó≠
        document.getElementById('delete-confirm-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                cancelDeleteGroup();
            }
        });
        
        // ÁªèÊµéÊ®°ÂºèÊó∂ÊÆµÈÄâÊã©ÂäüËÉΩ
        let currentPeriodType = 'normal'; // ÂΩìÂâçÈÄâ‰∏≠ÁöÑÊó∂ÊÆµÁ±ªÂûã
        let hourData = new Array(24).fill(''); // Â≠òÂÇ®ÊØè‰∏™Â∞èÊó∂ÁöÑÊó∂ÊÆµÁ±ªÂûã
        let isDragging = false;
        let dragStartHour = null;
        
        // Êó∂ÊÆµÁ±ªÂûãÊ†áÁ≠æ
        const periodTypeLabels = {
            'peak': 'Â≥∞',
            'valley': 'Ë∞∑',
            'normal': 'Âπ≥'
        };
        
        // ÂàùÂßãÂåñ24Â∞èÊó∂ÈÄâÊã©Âô®
        function initHourSelector() {
            const hourSelector = document.getElementById('hour-selector');
            if (!hourSelector) return;
            
            // Ê∏ÖÁ©∫Áé∞ÊúâÂÜÖÂÆπÔºåÈÅøÂÖçÈáçÂ§ç
            hourSelector.innerHTML = '';
            
            // ÁîüÊàê24‰∏™Â∞èÊó∂Ê†ºÂ≠ê
            for (let hour = 0; hour < 24; hour++) {
                const cell = document.createElement('div');
                cell.className = 'hour-cell';
                cell.dataset.hour = hour;
                
                // Ê∑ªÂä†Â∞èÊó∂Êï∞Â≠ó
                const hourNumber = document.createElement('div');
                hourNumber.className = 'hour-number';
                hourNumber.textContent = hour.toString();
                cell.appendChild(hourNumber);
                
                // Ê∑ªÂä†Êó∂ÊÆµÊñáÂ≠óÔºàÂàùÂßã‰∏∫Á©∫Ôºâ
                const periodText = document.createElement('div');
                periodText.className = 'period-text';
                cell.appendChild(periodText);
                
                hourSelector.appendChild(cell);
                
                // Èº†Ê†á‰∫ã‰ª∂Â§ÑÁêÜ
                cell.addEventListener('mousedown', (e) => {
                    e.preventDefault();
                    isDragging = true;
                    dragStartHour = hour;
                    
                    // Â∫îÁî®ÂΩìÂâçÊó∂ÊÆµÁ±ªÂûãÂà∞Ëµ∑ÂßãÊ†ºÂ≠ê
                    setHourPeriod(hour, currentPeriodType);
                });
                
                cell.addEventListener('mouseenter', () => {
                    if (isDragging && dragStartHour !== null) {
                        // ËÆ°ÁÆóÊãñÂä®ËåÉÂõ¥
                        const start = Math.min(dragStartHour, hour);
                        const end = Math.max(dragStartHour, hour);
                        
                        // ÊâπÈáèËÆæÁΩÆÊó∂ÊÆµ
                        for (let h = start; h <= end; h++) {
                            setHourPeriod(h, currentPeriodType);
                        }
                    }
                });
                
                cell.addEventListener('click', () => {
                    if (!isDragging) {
                        toggleHour(hour);
                    }
                });
            }
            
            // ÂÖ®Â±ÄÈº†Ê†á‰∫ã‰ª∂
            document.addEventListener('mouseup', () => {
                isDragging = false;
                dragStartHour = null;
            });
            
            // Èò≤Ê≠¢ÊñáÊú¨ÈÄâÊã©
            hourSelector.addEventListener('selectstart', (e) => {
                e.preventDefault();
            });
        }
        
        // ËÆæÁΩÆÂ∞èÊó∂ÁöÑÊó∂ÊÆµÁ±ªÂûã
        function setHourPeriod(hour, periodType) {
            const cell = document.querySelector(`[data-hour="${hour}"]`);
            if (!cell) return;
            
            hourData[hour] = periodType;
            
            // Ê∏ÖÈô§ÂéüÊúâÁ±ªÂπ∂Â∫îÁî®Êñ∞Á±ª
            cell.classList.remove('peak', 'valley', 'normal');
            if (periodType) {
                cell.classList.add(periodType);
                const periodText = cell.querySelector('.period-text');
                if (periodText) {
                    periodText.textContent = periodTypeLabels[periodType] || '';
                }
            } else {
                const periodText = cell.querySelector('.period-text');
                if (periodText) {
                    periodText.textContent = '';
                }
            }
            
            updatePeriodStatistics();
        }
        
        // ÈÄâÊã©Êó∂ÊÆµÁ±ªÂûã
        function setPeriodType(type) {
            currentPeriodType = type;
        }
        
        // ÂàáÊç¢Â∞èÊó∂ÁöÑÊó∂ÊÆµÁ±ªÂûãÔºàÂçïÂáªÔºâ
        function toggleHour(hour) {
            const cell = document.querySelector(`[data-hour="${hour}"]`);
            if (!cell) return;
            
            // Â¶ÇÊûúÁÇπÂáªÁöÑÊòØÁõ∏ÂêåÁ±ªÂûãÔºåÂàôÊ∏ÖÈô§
            if (hourData[hour] === currentPeriodType) {
                hourData[hour] = '';
                cell.className = 'hour-cell';
                cell.querySelector('.period-text').textContent = '';
            } else {
                // ËÆæÁΩÆÊñ∞ÁöÑÊó∂ÊÆµÁ±ªÂûã
                setHourPeriod(hour, currentPeriodType);
            }
        }
        
        // Ê∏ÖÈô§ÊâÄÊúâÊó∂ÊÆµ
        function clearAllHours() {
            hourData.fill('');
            document.querySelectorAll('.hour-cell').forEach(cell => {
                cell.className = 'hour-cell';
                const periodText = cell.querySelector('.period-text');
                if (periodText) {
                    periodText.textContent = '';
                }
            });
            updatePeriodStatistics();
        }
        
        // Âä†ËΩΩÈ¢ÑËÆæÈÖçÁΩÆ
        function loadPreset(presetType) {
            clearAllHours();
            
            if (presetType === 'commercial') {
                // Â∑•ÂïÜ‰∏öÈ¢ÑËÆæÔºöÂ≥∞Êó∂ÊÆµ 8-11, 18-22ÔºõË∞∑Êó∂ÊÆµ 23-7
                for (let h = 8; h <= 11; h++) hourData[h] = 'peak';
                for (let h = 18; h <= 22; h++) hourData[h] = 'peak';
                for (let h = 23; h <= 23; h++) hourData[h] = 'valley';
                for (let h = 0; h <= 7; h++) hourData[h] = 'valley';
                // ÂÖ∂‰Ωô‰∏∫Âπ≥Êó∂ÊÆµ
                for (let h = 0; h < 24; h++) {
                    if (!hourData[h]) hourData[h] = 'normal';
                }
            } else if (presetType === 'industrial') {
                // Â∑•‰∏öÈ¢ÑËÆæÔºöÂ≥∞Êó∂ÊÆµ 9-12, 17-21ÔºõË∞∑Êó∂ÊÆµ 0-6
                for (let h = 9; h <= 12; h++) hourData[h] = 'peak';
                for (let h = 17; h <= 21; h++) hourData[h] = 'peak';
                for (let h = 0; h <= 6; h++) hourData[h] = 'valley';
                // ÂÖ∂‰Ωô‰∏∫Âπ≥Êó∂ÊÆµ
                for (let h = 0; h < 24; h++) {
                    if (!hourData[h]) hourData[h] = 'normal';
                }
            }
            
            // Êõ¥Êñ∞ÊòæÁ§∫
            hourData.forEach((type, hour) => {
                const cell = document.querySelector(`[data-hour="${hour}"]`);
                if (cell && type) {
                    cell.className = `hour-cell ${type}`;
                    const periodText = cell.querySelector('.period-text');
                    if (periodText) {
                        periodText.textContent = periodTypeLabels[type] || '';
                    }
                }
            });
            
            updatePeriodStatistics();
        }
        
        // Êõ¥Êñ∞Êó∂ÊÆµÁªüËÆ°
        function updatePeriodStatistics() {
            const stats = {
                peak: 0,
                valley: 0,
                normal: 0
            };
            
            hourData.forEach(type => {
                if (type && stats.hasOwnProperty(type)) {
                    stats[type]++;
                }
            });
            
            // Êõ¥Êñ∞ÊòæÁ§∫
            document.getElementById('peak-hours').textContent = stats.peak;
            document.getElementById('valley-hours').textContent = stats.valley;
            document.getElementById('normal-hours').textContent = stats.normal;
        }
        
        // Âú®ÊâìÂºÄÊéßÂà∂Ê®°ÊÄÅÊ°ÜÊó∂ÂàùÂßãÂåñÊó∂ÊÆµÈÄâÊã©Âô®
        const originalOpenControlModal = openControlModal;
        openControlModal = function(groupId) {
            originalOpenControlModal(groupId);
            // Âª∂ËøüÂàùÂßãÂåñÔºåÁ°Æ‰øùDOMÂ∑≤Ê∏≤Êüì
            setTimeout(() => {
                initHourSelector();
                // Âä†ËΩΩÈªòËÆ§È¢ÑËÆæ
                loadPreset('commercial');
            }, 100);
        };
    </script>
</body>
</html>